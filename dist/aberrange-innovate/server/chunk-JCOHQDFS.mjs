import './polyfills.server.mjs';
import{$ as $f,A as De,Aa as Kf,B as ie,Ba as nb,C as Rn,D as be,Da as Lc,E as ki,Ea as Ra,F as Wt,Fa as Ir,G as kc,Ga as rb,H as K0,Ha as Hf,I as zf,J as H0,Ja as ib,K as Q0,Ka as Dr,L as xc,La as Ds,M as wa,Ma as Bc,N as Gf,Na as Ht,O as Ta,Oa as Vc,P as Ar,Pa as sb,Q as Y0,Qa as ob,R as Nc,Ra as ab,S as te,T as ge,U as jf,Ua as lb,V as Kt,W as Aa,X as ir,Y as rt,Ya as qc,Z as J0,Za as cb,_ as he,a as wr,aa as N,ab as Rs,b as wc,ba as D,bb as ub,c as Tc,ca as ye,d as U0,da as X0,e as Tr,ea as Ia,f as Ii,fa as Ts,g as Dn,ga as Oc,h as Bt,ha as xi,i as Ne,ia as V,j as z0,ja as dn,k as G0,ka as As,l as Ea,la as Is,m as Ca,ma as Ee,n as j0,na as Da,o as $0,oa as Z0,p as Ac,pa as Mc,q as Ic,qa as Pc,r as qf,ra as Wf,s as Dc,sa as Fc,t as Di,u as Uf,ua as eb,v as W0,w as Rc,x as ws,y as Vt,ya as tb,z as Ri}from"./chunk-ORW7NN2T.mjs";import{a as db,b as hb,c as Qf,d as fb,e as ka,f as Yf,g as Uc,h as pb,i as mb,j as Jf,k as Le,l as Ni,m as kn,n as zc,o as xa,p as Xf,q as gb,r as yb,s as Na,t as Gc,u as Et,v as Ct,w as qR}from"./chunk-EULAVVKA.mjs";import{a as pt,b as Lt,c as me,f as k,h as Bf,i as Vf,j as E}from"./chunk-EXD34EPT.mjs";var pe=k(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Qt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Qt.Propagate=Qt.LogVerbosity=Qt.Status=void 0;var Vb=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(Vb||(Qt.Status=Vb={})),qb=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(qb||(Qt.LogVerbosity=qb={})),Ub=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(Ub||(Qt.Propagate=Ub={}));Qt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Qt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var yp=k((h$,Nk)=>{Nk.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ue=k(Tt=>{"use strict";var vp,_p,Sp,bp;Object.defineProperty(Tt,"__esModule",{value:!0});Tt.isTracerEnabled=Tt.trace=Tt.log=Tt.setLoggerVerbosity=Tt.setLogger=Tt.getLogger=void 0;var xr=pe(),Ok=me("process"),Mk=yp().version,Pk={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Pi=Pk,Os=xr.LogVerbosity.ERROR,Fk=(_p=(vp=process.env.GRPC_NODE_VERBOSITY)!==null&&vp!==void 0?vp:process.env.GRPC_VERBOSITY)!==null&&_p!==void 0?_p:"";switch(Fk.toUpperCase()){case"DEBUG":Os=xr.LogVerbosity.DEBUG;break;case"INFO":Os=xr.LogVerbosity.INFO;break;case"ERROR":Os=xr.LogVerbosity.ERROR;break;case"NONE":Os=xr.LogVerbosity.NONE;break;default:}var Lk=()=>Pi;Tt.getLogger=Lk;var Bk=n=>{Pi=n};Tt.setLogger=Bk;var Vk=n=>{Os=n};Tt.setLoggerVerbosity=Vk;var qk=(n,...e)=>{let t;if(n>=Os){switch(n){case xr.LogVerbosity.DEBUG:t=Pi.debug;break;case xr.LogVerbosity.INFO:t=Pi.info;break;case xr.LogVerbosity.ERROR:t=Pi.error;break}t||(t=Pi.error),t&&t.bind(Pi)(...e)}};Tt.log=qk;var Uk=(bp=(Sp=process.env.GRPC_NODE_TRACE)!==null&&Sp!==void 0?Sp:process.env.GRPC_TRACE)!==null&&bp!==void 0?bp:"",Ep=new Set,zb=new Set;for(let n of Uk.split(","))n.startsWith("-")?zb.add(n.substring(1)):Ep.add(n);var zk=Ep.has("all");function Gk(n,e,t){Gb(e)&&(0,Tt.log)(n,new Date().toISOString()+" | v"+Mk+" "+Ok.pid+" | "+e+" | "+t)}Tt.trace=Gk;function Gb(n){return!zb.has(n)&&(zk||Ep.has(n))}Tt.isTracerEnabled=Gb});var Qc=k(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.getErrorCode=Ms.getErrorMessage=void 0;function jk(n){return n instanceof Error?n.message:String(n)}Ms.getErrorMessage=jk;function $k(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Ms.getErrorCode=$k});var xt=k(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.Metadata=void 0;var Wk=Ue(),Kk=pe(),Hk=Qc(),Qk=/^[0-9a-z_.-]+$/,Yk=/^[ -~]*$/;function Jk(n){return Qk.test(n)}function Xk(n){return Yk.test(n)}function $b(n){return n.endsWith("-bin")}function Zk(n){return!n.startsWith("grpc-")}function Yc(n){return n.toLowerCase()}function jb(n,e){if(!Jk(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if($b(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!Xk(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Cp=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Yc(e),jb(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Yc(e),jb(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Yc(e),this.internalRepr.delete(e)}get(e){return e=Yc(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(ex);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{$b(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(Zk(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,Hk.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Wk.log)(Kk.LogVerbosity.ERROR,o)}}return t}};Jc.Metadata=Cp;var ex=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Dp=k(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.CallCredentials=void 0;var Ip=xt();function tx(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Ps=class n{static createFromMetadataGenerator(e){return new Tp(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;tx(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Ip.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Ap}};Xc.CallCredentials=Ps;var wp=class n extends Ps{constructor(e){super(),this.creds=e}generateMetadata(e){return E(this,null,function*(){let t=new Ip.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},Tp=class n extends Ps{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new wp([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Ap=class n extends Ps{generateMetadata(e){return Promise.resolve(new Ip.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var kp=k(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.getDefaultRootsData=Fs.CIPHER_SUITES=void 0;var nx=me("fs");Fs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Wb=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Rp=null;function rx(){return Wb?(Rp===null&&(Rp=nx.readFileSync(Wb)),Rp):null}Fs.getDefaultRootsData=rx});var tu=k(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.ChannelCredentials=void 0;var ix=me("tls"),sx=Dp(),Kb=kp();function xp(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Ls=class{constructor(e){this.callCredentials=e||sx.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(xp(e,"Root certificate"),xp(t,"Private key"),xp(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,ix.createSecureContext)({ca:(s=e??(0,Kb.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:Kb.CIPHER_SUITES});return new Zc(o,i??{})}static createFromSecureContext(e,t){return new Zc(e,t??{})}static createInsecure(){return new Np}};eu.ChannelCredentials=Ls;var Np=class n extends Ls{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Zc=class n extends Ls{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Op(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Op=class n extends Ls{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Or=k(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.validateLoadBalancingConfig=mt.getFirstUsableConfig=mt.isLoadBalancerNameRegistered=mt.createLoadBalancer=mt.registerDefaultLoadBalancerType=mt.registerLoadBalancerType=mt.createChildChannelControlHelper=void 0;function ox(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}mt.createChildChannelControlHelper=ox;var Nr={},Mp=null;function ax(n,e,t){Nr[n]={LoadBalancer:e,LoadBalancingConfig:t}}mt.registerLoadBalancerType=ax;function lx(n){Mp=n}mt.registerDefaultLoadBalancerType=lx;function cx(n,e){let t=n.getLoadBalancerName();return t in Nr?new Nr[t].LoadBalancer(e):null}mt.createLoadBalancer=cx;function ux(n){return n in Nr}mt.isLoadBalancerNameRegistered=ux;function dx(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Nr)return t;return e&&Mp?new Nr[Mp].LoadBalancingConfig:null}mt.getFirstUsableConfig=dx;function hx(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Nr)return Nr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}mt.validateLoadBalancingConfig=hx});var Pp=k(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.extractAndSelectServiceConfig=Mr.validateServiceConfig=Mr.validateRetryThrottling=void 0;var fx=me("os"),nu=pe(),px=Or(),ru=/^\d+(\.\d{1,9})?s$/,mx="node";function gx(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function yx(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!ru.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!ru.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(nu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(nu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function vx(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!ru.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(nu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(nu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function _x(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(gx(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&ru.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=yx(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=vx(n.hedgingPolicy));return t}function Hb(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Mr.validateRetryThrottling=Hb;function Qb(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,px.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(_x(r));"retryThrottling"in n&&(e.retryThrottling=Hb(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Mr.validateServiceConfig=Qb;function Sx(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:Qb(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function bx(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=Sx(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===fx.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===mx&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function Ex(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return bx(i,e)}return null}Mr.extractAndSelectServiceConfig=Ex});var Yt=k(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.ConnectivityState=void 0;var Yb=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(Yb||(iu.ConnectivityState=Yb={}))});var qt=k(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.uriToString=Pr.splitHostPort=Pr.parseUri=void 0;var Cx=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function wx(n){let e=Cx.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Pr.parseUri=wx;var Jb=/^\d+$/;function Tx(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return Jb.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Jb.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Pr.splitHostPort=Tx;function Ax(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Pr.uriToString=Ax});var Nn=k(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.mapUriDefaultScheme=Jt.getDefaultAuthority=Jt.createResolver=Jt.registerDefaultScheme=Jt.registerResolver=void 0;var Lp=qt(),Bs={},Fp=null;function Ix(n,e){Bs[n]=e}Jt.registerResolver=Ix;function Dx(n){Fp=n}Jt.registerDefaultScheme=Dx;function Rx(n,e,t){if(n.scheme!==void 0&&n.scheme in Bs)return new Bs[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Lp.uriToString)(n)}`)}Jt.createResolver=Rx;function kx(n){if(n.scheme!==void 0&&n.scheme in Bs)return Bs[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Lp.uriToString)(n)}`)}Jt.getDefaultAuthority=kx;function xx(n){return n.scheme===void 0||!(n.scheme in Bs)?Fp!==null?{scheme:Fp,authority:void 0,path:(0,Lp.uriToString)(n)}:null:n}Jt.mapUriDefaultScheme=xx});var Lr=k(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.QueuePicker=Fr.UnavailablePicker=Fr.PickResultType=void 0;var Nx=xt(),Ox=pe(),su=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(su||(Fr.PickResultType=su={})),Bp=class{constructor(e){this.status=Object.assign({code:Ox.Status.UNAVAILABLE,details:"No connection established",metadata:new Nx.Metadata},e)}pick(e){return{pickResultType:su.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Fr.UnavailablePicker=Bp;var Vp=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:su.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Fr.QueuePicker=Vp});var Ba=k(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.BackoffTimeout=void 0;var Mx=1e3,Px=1.6,Fx=12e4,Lx=.2;function Bx(n,e){return Math.random()*(e-n)+n}var qp=class{constructor(e,t){this.callback=e,this.initialDelay=Mx,this.multiplier=Px,this.maxDelay=Fx,this.jitter=Lx,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+Bx(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};ou.BackoffTimeout=qp});var lu=k(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.ChildLoadBalancerHandler=void 0;var Vx=Or(),qx=Yt(),Ux="child_load_balancer_helper",Up=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===qx.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,Vx.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return Ux}};au.ChildLoadBalancerHandler=Up});var Zb=k(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.ResolvingLoadBalancer=void 0;var zx=Or(),Gx=Pp(),Nt=Yt(),jx=Nn(),Vs=Lr(),$x=Ba(),zp=pe(),Wx=xt(),Kx=Ue(),Hx=pe(),Qx=qt(),Yx=lu(),Jx="resolving_load_balancer";function Xb(n){Kx.trace(Hx.LogVerbosity.DEBUG,Jx,n)}var Xx=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function Zx(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function eN(n,e,t,r){for(let i of t)if(Zx(n,e,i,r))return i;return null}function tN(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Xx){let u=eN(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:zp.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:zp.Status.OK,dynamicFilterFactories:[]}}}var Gp=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Nt.ConnectivityState.IDLE,this.latestChildPicker=new Vs.QueuePicker(this),this.currentState=Nt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Gx.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Nt.ConnectivityState.IDLE,new Vs.QueuePicker(this)),this.childLoadBalancer=new Yx.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Xb("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,jx.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let w=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],A=(0,zx.getFirstUsableConfig)(w,!0);if(A===null){this.handleResolutionFailure({code:zp.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Wx.Metadata});return}this.childLoadBalancer.updateAddressList(a,A,d);let T=v??this.defaultServiceConfig;this.onSuccessfulResolution(T,u??tN(T))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new $x.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Nt.ConnectivityState.IDLE&&this.updateState(Nt.ConnectivityState.CONNECTING,new Vs.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){Xb((0,Qx.uriToString)(this.target)+" "+Nt.ConnectivityState[this.currentState]+" -> "+Nt.ConnectivityState[e]),e===Nt.ConnectivityState.IDLE&&(t=new Vs.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Nt.ConnectivityState.IDLE&&(this.updateState(Nt.ConnectivityState.TRANSIENT_FAILURE,new Vs.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Nt.ConnectivityState.IDLE||this.currentState===Nt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Nt.ConnectivityState.IDLE,this.latestChildPicker=new Vs.QueuePicker(this),this.currentState=Nt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};cu.ResolvingLoadBalancer=Gp});var eE=k(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.channelOptionsEqual=qs.recognizedOptions=void 0;qs.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function nN(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}qs.channelOptionsEqual=nN});var Mn=k(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.stringToSubchannelAddress=On.subchannelAddressToString=On.subchannelAddressEqual=On.isTcpSubchannelAddress=void 0;var rN=me("net");function Va(n){return"port"in n}On.isTcpSubchannelAddress=Va;function iN(n,e){return!n&&!e?!0:!n||!e?!1:Va(n)?Va(e)&&n.host===e.host&&n.port===e.port:!Va(e)&&n.path===e.path}On.subchannelAddressEqual=iN;function sN(n){return Va(n)?n.host+":"+n.port:n.path}On.subchannelAddressToString=sN;var oN=443;function aN(n,e){return(0,rN.isIP)(n)?{host:n,port:e??oN}:{path:n}}On.stringToSubchannelAddress=aN});var uu=k(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.addAdminServicesToServer=Us.registerAdminService=void 0;var tE=[];function lN(n,e){tE.push({getServiceDefinition:n,getHandlers:e})}Us.registerAdminService=lN;function cN(n){for(let{getServiceDefinition:e,getHandlers:t}of tE)n.addService(e(),t())}Us.addAdminServicesToServer=cN});var nE=k(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.ClientDuplexStreamImpl=Xt.ClientWritableStreamImpl=Xt.ClientReadableStreamImpl=Xt.ClientUnaryCallImpl=Xt.callErrorFromStatus=void 0;var uN=me("events"),Hp=me("stream"),qa=pe();function dN(n,e){let t=`${n.code} ${qa.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Xt.callErrorFromStatus=dN;var jp=class extends uN.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(qa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Xt.ClientUnaryCallImpl=jp;var $p=class extends Hp.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(qa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Xt.ClientReadableStreamImpl=$p;var Wp=class extends Hp.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(qa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Xt.ClientWritableStreamImpl=Wp;var Kp=class extends Hp.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(qa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Xt.ClientDuplexStreamImpl=Kp});var rE=k(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.InterceptingListenerImpl=zs.isInterceptingListener=void 0;function hN(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}zs.isInterceptingListener=hN;var Qp=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};zs.InterceptingListenerImpl=Qp});var nm=k(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.getInterceptingCall=Zt.InterceptingCall=Zt.RequesterBuilder=Zt.ListenerBuilder=Zt.InterceptorConfigurationError=void 0;var fN=xt(),iE=rE(),sE=pe(),oE=Qc(),za=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Zt.InterceptorConfigurationError=za;var Jp=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Zt.ListenerBuilder=Jp;var Xp=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Zt.RequesterBuilder=Xp;var Yp={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Ua={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Zp=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Ua.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Ua.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Ua.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Ua.cancel}:this.requester=Ua}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,w;this.processingMetadata=!1;let A;if((0,iE.isInterceptingListener)(d))A=d;else{let T={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:Yp.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:Yp.onReceiveMessage,onReceiveStatus:(w=d.onReceiveStatus)!==null&&w!==void 0?w:Yp.onReceiveStatus};A=new iE.InterceptingListenerImpl(T,c)}this.nextCall.start(u,A),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Zt.InterceptingCall=Zp;function pN(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var du=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(sE.Status.INTERNAL,`Request message serialization failure: ${(0,oE.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:sE.Status.INTERNAL,details:`Response message parsing error: ${(0,oE.getErrorMessage)(a)}`,metadata:new fN.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},em=class extends du{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},tm=class extends du{};function mN(n,e,t){let r=pN(n,t.path,e);return t.responseStream?new tm(r,t):new em(r,t)}function gN(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new za("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new za("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>mN(r,a,e))(s)}Zt.getInterceptingCall=gN});var sm=k(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});fu.Client=void 0;var Pn=nE(),yN=om(),vN=Yt(),Br=pe(),Gs=xt(),hu=nm(),pn=Symbol(),js=Symbol(),$s=Symbol(),or=Symbol();function rm(n){return typeof n=="function"}function Ws(n){return n.stack.split(`
`).slice(1).join(`
`)}var im=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[js]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[$s]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[js].length>0&&this[$s].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[or]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[pn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[pn]=o(e,t,r)}else this[pn]=new yN.ChannelImplementation(e,t,r)}close(){this[pn].close()}getChannel(){return this[pn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[pn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===vN.ConnectivityState.READY)t();else try{this[pn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(rm(e))return{metadata:new Gs.Metadata,options:{},callback:e};if(rm(t))return e instanceof Gs.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Gs.Metadata,options:e,callback:t};if(!(e instanceof Gs.Metadata&&t instanceof Object&&rm(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new Pn.ClientUnaryCallImpl,channel:this[pn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[or]&&(f=this[or](f));let v=f.call,w={clientInterceptors:this[js],clientInterceptorProviders:this[$s],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},A=(0,hu.getInterceptingCall)(w,f.methodDefinition,f.callOptions,f.channel);v.call=A;let T=null,F=!1,R=new Error;return A.start(f.metadata,{onReceiveMetadata:L=>{v.emit("metadata",L)},onReceiveMessage(L){T!==null&&A.cancelWithStatus(Br.Status.INTERNAL,"Too many responses received"),T=L},onReceiveStatus(L){if(!F){if(F=!0,L.code===Br.Status.OK)if(T===null){let B=Ws(R);f.callback((0,Pn.callErrorFromStatus)({code:Br.Status.INTERNAL,details:"No message received",metadata:L.metadata},B))}else f.callback(null,T);else{let B=Ws(R);f.callback((0,Pn.callErrorFromStatus)(L,B))}R=null,v.emit("status",L)}}}),A.sendMessage(i),A.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Pn.ClientWritableStreamImpl(t),channel:this[pn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[or]&&(d=this[or](d));let f=d.call,v={clientInterceptors:this[js],clientInterceptorProviders:this[$s],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,hu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=null,T=!1,F=new Error;return w.start(d.metadata,{onReceiveMetadata:R=>{f.emit("metadata",R)},onReceiveMessage(R){A!==null&&w.cancelWithStatus(Br.Status.INTERNAL,"Too many responses received"),A=R},onReceiveStatus(R){if(!T){if(T=!0,R.code===Br.Status.OK)if(A===null){let L=Ws(F);d.callback((0,Pn.callErrorFromStatus)({code:Br.Status.INTERNAL,details:"No message received",metadata:R.metadata},L))}else d.callback(null,A);else{let L=Ws(F);d.callback((0,Pn.callErrorFromStatus)(R,L))}F=null,f.emit("status",R)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Gs.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Gs.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Pn.ClientReadableStreamImpl(r),channel:this[pn],methodDefinition:u,callOptions:c.options};this[or]&&(d=this[or](d));let f=d.call,v={clientInterceptors:this[js],clientInterceptorProviders:this[$s],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,hu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=!1,T=new Error;return w.start(d.metadata,{onReceiveMetadata(F){f.emit("metadata",F)},onReceiveMessage(F){f.push(F)},onReceiveStatus(F){if(!A){if(A=!0,f.push(null),F.code!==Br.Status.OK){let R=Ws(T);f.emit("error",(0,Pn.callErrorFromStatus)(F,R))}T=null,f.emit("status",F)}}}),w.sendMessage(i),w.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Pn.ClientDuplexStreamImpl(t,r),channel:this[pn],methodDefinition:c,callOptions:l.options};this[or]&&(u=this[or](u));let d=u.call,f={clientInterceptors:this[js],clientInterceptorProviders:this[$s],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,hu.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let w=!1,A=new Error;return v.start(u.metadata,{onReceiveMetadata(T){d.emit("metadata",T)},onReceiveMessage(T){d.push(T)},onReceiveStatus(T){if(!w){if(w=!0,d.push(null),T.code!==Br.Status.OK){let F=Ws(A);d.emit("error",(0,Pn.callErrorFromStatus)(T,F))}A=null,d.emit("status",T)}}}),d}};fu.Client=im});var lm=k(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.loadPackageDefinition=Ks.makeClientConstructor=void 0;var Ga=sm(),_N={unary:Ga.Client.prototype.makeUnaryRequest,server_stream:Ga.Client.prototype.makeServerStreamRequest,client_stream:Ga.Client.prototype.makeClientStreamRequest,bidi:Ga.Client.prototype.makeBidiStreamRequest};function am(n){return["__proto__","prototype","constructor"].includes(n)}function aE(n,e,t){t||(t={});class r extends Ga.Client{}return Object.keys(n).forEach(i=>{if(am(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=SN(_N[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!am(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Ks.makeClientConstructor=aE;function SN(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function bN(n){return"format"in n}function EN(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>am(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];bN(r)?o[s]=r:o[s]=aE(r,s,{})}return e}Ks.loadPackageDefinition=EN});var NE=k((B$,xE)=>{"use strict";var CN=1/0,wN="[object Symbol]",TN=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,AN=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mu="\\ud800-\\udfff",mE="\\u0300-\\u036f\\ufe20-\\ufe23",gE="\\u20d0-\\u20f0",yE="\\u2700-\\u27bf",vE="a-z\\xdf-\\xf6\\xf8-\\xff",IN="\\xac\\xb1\\xd7\\xf7",DN="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",RN="\\u2000-\\u206f",kN=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_E="A-Z\\xc0-\\xd6\\xd8-\\xde",SE="\\ufe0e\\ufe0f",bE=IN+DN+RN+kN,um="['\u2019]",xN="["+mu+"]",lE="["+bE+"]",pu="["+mE+gE+"]",EE="\\d+",NN="["+yE+"]",CE="["+vE+"]",wE="[^"+mu+bE+EE+yE+vE+_E+"]",cm="\\ud83c[\\udffb-\\udfff]",ON="(?:"+pu+"|"+cm+")",TE="[^"+mu+"]",dm="(?:\\ud83c[\\udde6-\\uddff]){2}",hm="[\\ud800-\\udbff][\\udc00-\\udfff]",Hs="["+_E+"]",AE="\\u200d",cE="(?:"+CE+"|"+wE+")",MN="(?:"+Hs+"|"+wE+")",uE="(?:"+um+"(?:d|ll|m|re|s|t|ve))?",dE="(?:"+um+"(?:D|LL|M|RE|S|T|VE))?",IE=ON+"?",DE="["+SE+"]?",PN="(?:"+AE+"(?:"+[TE,dm,hm].join("|")+")"+DE+IE+")*",RE=DE+IE+PN,FN="(?:"+[NN,dm,hm].join("|")+")"+RE,LN="(?:"+[TE+pu+"?",pu,dm,hm,xN].join("|")+")",BN=RegExp(um,"g"),VN=RegExp(pu,"g"),qN=RegExp(cm+"(?="+cm+")|"+LN+RE,"g"),UN=RegExp([Hs+"?"+CE+"+"+uE+"(?="+[lE,Hs,"$"].join("|")+")",MN+"+"+dE+"(?="+[lE,Hs+cE,"$"].join("|")+")",Hs+"?"+cE+"+"+uE,Hs+"+"+dE,EE,FN].join("|"),"g"),zN=RegExp("["+AE+mu+mE+gE+SE+"]"),GN=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jN={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},$N=typeof global=="object"&&global&&global.Object===Object&&global,WN=typeof self=="object"&&self&&self.Object===Object&&self,KN=$N||WN||Function("return this")();function HN(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function QN(n){return n.split("")}function YN(n){return n.match(TN)||[]}function JN(n){return function(e){return n?.[e]}}var XN=JN(jN);function kE(n){return zN.test(n)}function ZN(n){return GN.test(n)}function eO(n){return kE(n)?tO(n):QN(n)}function tO(n){return n.match(qN)||[]}function nO(n){return n.match(UN)||[]}var rO=Object.prototype,iO=rO.toString,hE=KN.Symbol,fE=hE?hE.prototype:void 0,pE=fE?fE.toString:void 0;function sO(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function oO(n){if(typeof n=="string")return n;if(dO(n))return pE?pE.call(n):"";var e=n+"";return e=="0"&&1/n==-CN?"-0":e}function aO(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:sO(n,e,t)}function lO(n){return function(e){e=gu(e);var t=kE(e)?eO(e):void 0,r=t?t[0]:e.charAt(0),i=t?aO(t,1).join(""):e.slice(1);return r[n]()+i}}function cO(n){return function(e){return HN(gO(pO(e).replace(BN,"")),n,"")}}function uO(n){return!!n&&typeof n=="object"}function dO(n){return typeof n=="symbol"||uO(n)&&iO.call(n)==wN}function gu(n){return n==null?"":oO(n)}var hO=cO(function(n,e,t){return e=e.toLowerCase(),n+(t?fO(e):e)});function fO(n){return mO(gu(n).toLowerCase())}function pO(n){return n=gu(n),n&&n.replace(AN,XN).replace(VN,"")}var mO=lO("toUpperCase");function gO(n,e,t){return n=gu(n),e=t?void 0:e,e===void 0?ZN(n)?nO(n):YN(n):n.match(e)||[]}xE.exports=hO});var fm=k((V$,OE)=>{"use strict";OE.exports=yO;function yO(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var LE=k(FE=>{"use strict";var yu=FE;yu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Qs=new Array(64),PE=new Array(123);for(mn=0;mn<64;)PE[Qs[mn]=mn<26?mn+65:mn<52?mn+71:mn<62?mn-4:mn-59|43]=mn++;var mn;yu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Qs[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Qs[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Qs[l|c>>6],s[o++]=Qs[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Qs[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var ME="invalid encoding";yu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=PE[l])===void 0)throw Error(ME);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(ME);return r-i};yu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var VE=k((U$,BE)=>{"use strict";BE.exports=vu;function vu(){this._listeners={}}vu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};vu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};vu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var WE=k((z$,$E)=>{"use strict";$E.exports=qE(qE);function qE(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,UE),n.writeFloatBE=e.bind(null,zE);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,GE),n.readFloatBE=t.bind(null,jE)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,UE,0,4),n.writeDoubleBE=e.bind(null,zE,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,GE,0,4),n.readDoubleBE=t.bind(null,jE,4,0)}(),n}function UE(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function zE(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function GE(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function jE(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var pm=k((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var HE=k(KE=>{"use strict";var mm=KE;mm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};mm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};mm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var YE=k((j$,QE)=>{"use strict";QE.exports=vO;function vO(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var XE=k(($$,JE)=>{"use strict";JE.exports=at;var ja=Fn();function at(n,e){this.lo=n>>>0,this.hi=e>>>0}var Fi=at.zero=new at(0,0);Fi.toNumber=function(){return 0};Fi.zzEncode=Fi.zzDecode=function(){return this};Fi.length=function(){return 1};var _O=at.zeroHash="\0\0\0\0\0\0\0\0";at.fromNumber=function(e){if(e===0)return Fi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new at(r,i)};at.from=function(e){if(typeof e=="number")return at.fromNumber(e);if(ja.isString(e))if(ja.Long)e=ja.Long.fromString(e);else return at.fromNumber(parseInt(e,10));return e.low||e.high?new at(e.low>>>0,e.high>>>0):Fi};at.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};at.prototype.toLong=function(e){return ja.Long?new ja.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Vr=String.prototype.charCodeAt;at.fromHash=function(e){return e===_O?Fi:new at((Vr.call(e,0)|Vr.call(e,1)<<8|Vr.call(e,2)<<16|Vr.call(e,3)<<24)>>>0,(Vr.call(e,4)|Vr.call(e,5)<<8|Vr.call(e,6)<<16|Vr.call(e,7)<<24)>>>0)};at.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};at.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};at.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};at.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Fn=k(gm=>{"use strict";var Q=gm;Q.asPromise=fm();Q.base64=LE();Q.EventEmitter=VE();Q.float=WE();Q.inquire=pm();Q.utf8=HE();Q.pool=YE();Q.LongBits=XE();Q.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Q.global=Q.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||gm;Q.emptyArray=Object.freeze?Object.freeze([]):[];Q.emptyObject=Object.freeze?Object.freeze({}):{};Q.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Q.isString=function(e){return typeof e=="string"||e instanceof String};Q.isObject=function(e){return e&&typeof e=="object"};Q.isset=Q.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Q.Buffer=function(){try{var n=Q.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Q._Buffer_from=null;Q._Buffer_allocUnsafe=null;Q.newBuffer=function(e){return typeof e=="number"?Q.Buffer?Q._Buffer_allocUnsafe(e):new Q.Array(e):Q.Buffer?Q._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Q.Array=typeof Uint8Array<"u"?Uint8Array:Array;Q.Long=Q.global.dcodeIO&&Q.global.dcodeIO.Long||Q.global.Long||Q.inquire("long");Q.key2Re=/^true|false|0|1$/;Q.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Q.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Q.longToHash=function(e){return e?Q.LongBits.from(e).toHash():Q.LongBits.zeroHash};Q.longFromHash=function(e,t){var r=Q.LongBits.fromHash(e);return Q.Long?Q.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function ZE(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}Q.merge=ZE;Q.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function eC(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&ZE(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Q.newError=eC;Q.ProtocolError=eC("ProtocolError");Q.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Q.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};Q.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Q._configure=function(){var n=Q.Buffer;if(!n){Q._Buffer_from=Q._Buffer_allocUnsafe=null;return}Q._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},Q._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Su=k((K$,iC)=>{"use strict";iC.exports=de;var en=Fn(),ym,_u=en.LongBits,tC=en.base64,nC=en.utf8;function $a(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function _m(){}function SO(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function de(){this.len=0,this.head=new $a(_m,0,0),this.tail=this.head,this.states=null}var rC=function(){return en.Buffer?function(){return(de.create=function(){return new ym})()}:function(){return new de}};de.create=rC();de.alloc=function(e){return new en.Array(e)};en.Array!==Array&&(de.alloc=en.pool(de.alloc,en.Array.prototype.subarray));de.prototype._push=function(e,t,r){return this.tail=this.tail.next=new $a(e,t,r),this.len+=t,this};function Sm(n,e,t){e[t]=n&255}function bO(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function bm(n,e){this.len=n,this.next=void 0,this.val=e}bm.prototype=Object.create($a.prototype);bm.prototype.fn=bO;de.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new bm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};de.prototype.int32=function(e){return e<0?this._push(Em,10,_u.fromNumber(e)):this.uint32(e)};de.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Em(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}de.prototype.uint64=function(e){var t=_u.from(e);return this._push(Em,t.length(),t)};de.prototype.int64=de.prototype.uint64;de.prototype.sint64=function(e){var t=_u.from(e).zzEncode();return this._push(Em,t.length(),t)};de.prototype.bool=function(e){return this._push(Sm,1,e?1:0)};function vm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}de.prototype.fixed32=function(e){return this._push(vm,4,e>>>0)};de.prototype.sfixed32=de.prototype.fixed32;de.prototype.fixed64=function(e){var t=_u.from(e);return this._push(vm,4,t.lo)._push(vm,4,t.hi)};de.prototype.sfixed64=de.prototype.fixed64;de.prototype.float=function(e){return this._push(en.float.writeFloatLE,4,e)};de.prototype.double=function(e){return this._push(en.float.writeDoubleLE,8,e)};var EO=en.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};de.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Sm,1,0);if(en.isString(e)){var r=de.alloc(t=tC.length(e));tC.decode(e,r,0),e=r}return this.uint32(t)._push(EO,t,e)};de.prototype.string=function(e){var t=nC.length(e);return t?this.uint32(t)._push(nC.write,t,e):this._push(Sm,1,0)};de.prototype.fork=function(){return this.states=new SO(this),this.head=this.tail=new $a(_m,0,0),this.len=0,this};de.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new $a(_m,0,0),this.len=0),this};de.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};de.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};de._configure=function(n){ym=n,de.create=rC(),ym._configure()}});var aC=k((H$,oC)=>{"use strict";oC.exports=Ln;var sC=Su();(Ln.prototype=Object.create(sC.prototype)).constructor=Ln;var qr=Fn();function Ln(){sC.call(this)}Ln._configure=function(){Ln.alloc=qr._Buffer_allocUnsafe,Ln.writeBytesBuffer=qr.Buffer&&qr.Buffer.prototype instanceof Uint8Array&&qr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Ln.prototype.bytes=function(e){qr.isString(e)&&(e=qr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ln.writeBytesBuffer,t,e),this};function CO(n,e,t){n.length<40?qr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Ln.prototype.string=function(e){var t=qr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(CO,t,e),this};Ln._configure()});var Eu=k((Q$,hC)=>{"use strict";hC.exports=$e;var gn=Fn(),wm,uC=gn.LongBits,wO=gn.utf8;function yn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function $e(n){this.buf=n,this.pos=0,this.len=n.length}var lC=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new $e(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new $e(e);throw Error("illegal buffer")},dC=function(){return gn.Buffer?function(t){return($e.create=function(i){return gn.Buffer.isBuffer(i)?new wm(i):lC(i)})(t)}:lC};$e.create=dC();$e.prototype._slice=gn.Array.prototype.subarray||gn.Array.prototype.slice;$e.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,yn(this,10);return e}}();$e.prototype.int32=function(){return this.uint32()|0};$e.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Cm(){var n=new uC(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw yn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw yn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}$e.prototype.bool=function(){return this.uint32()!==0};function bu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}$e.prototype.fixed32=function(){if(this.pos+4>this.len)throw yn(this,4);return bu(this.buf,this.pos+=4)};$e.prototype.sfixed32=function(){if(this.pos+4>this.len)throw yn(this,4);return bu(this.buf,this.pos+=4)|0};function cC(){if(this.pos+8>this.len)throw yn(this,8);return new uC(bu(this.buf,this.pos+=4),bu(this.buf,this.pos+=4))}$e.prototype.float=function(){if(this.pos+4>this.len)throw yn(this,4);var e=gn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};$e.prototype.double=function(){if(this.pos+8>this.len)throw yn(this,4);var e=gn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};$e.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw yn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=gn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};$e.prototype.string=function(){var e=this.bytes();return wO.read(e,0,e.length)};$e.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw yn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw yn(this);while(this.buf[this.pos++]&128);return this};$e.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};$e._configure=function(n){wm=n,$e.create=dC(),wm._configure();var e=gn.Long?"toLong":"toNumber";gn.merge($e.prototype,{int64:function(){return Cm.call(this)[e](!1)},uint64:function(){return Cm.call(this)[e](!0)},sint64:function(){return Cm.call(this).zzDecode()[e](!1)},fixed64:function(){return cC.call(this)[e](!0)},sfixed64:function(){return cC.call(this)[e](!1)}})}});var gC=k((Y$,mC)=>{"use strict";mC.exports=Li;var pC=Eu();(Li.prototype=Object.create(pC.prototype)).constructor=Li;var fC=Fn();function Li(n){pC.call(this,n)}Li._configure=function(){fC.Buffer&&(Li.prototype._slice=fC.Buffer.prototype.slice)};Li.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Li._configure()});var vC=k((J$,yC)=>{"use strict";yC.exports=Wa;var Tm=Fn();(Wa.prototype=Object.create(Tm.EventEmitter.prototype)).constructor=Wa;function Wa(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Tm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Wa.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Tm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Wa.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Am=k(_C=>{"use strict";var TO=_C;TO.Service=vC()});var Im=k((Z$,SC)=>{"use strict";SC.exports={}});var CC=k(EC=>{"use strict";var Ot=EC;Ot.build="minimal";Ot.Writer=Su();Ot.BufferWriter=aC();Ot.Reader=Eu();Ot.BufferReader=gC();Ot.util=Fn();Ot.rpc=Am();Ot.roots=Im();Ot.configure=bC;function bC(){Ot.util._configure(),Ot.Writer._configure(Ot.BufferWriter),Ot.Reader._configure(Ot.BufferReader)}bC()});var TC=k((t5,wC)=>{"use strict";wC.exports=Dm;function Dm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Dm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(w,A){var T=d[f++];switch(A){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Dm.verbose=!1});var IC=k((n5,AC)=>{"use strict";AC.exports=Ka;var AO=fm(),IO=pm(),Rm=IO("fs");function Ka(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Rm&&Rm.readFile?Rm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Ka.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Ka.xhr(n,e,t):AO(Ka,this,n,e)}Ka.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var kC=k(RC=>{"use strict";var xm=RC,DC=xm.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},km=xm.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=DC(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};xm.resolve=function(e,t,r){return r||(t=km(t)),DC(t)?t:(r||(e=km(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?km(e+"/"+t):t)}});var Bi=k(xC=>{"use strict";var Ha=xC,DO=lt(),RO=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Qa(n,e){var t=0,r={};for(e|=0;t<n.length;)r[RO[t+e]]=n[t++];return r}Ha.basic=Qa([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Ha.defaults=Qa([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",DO.emptyArray,null]);Ha.long=Qa([0,0,0,1,1],7);Ha.mapKey=Qa([0,0,0,5,5,0,0,0,1,1,0,2],2);Ha.packed=Qa([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Ur=k((s5,MC)=>{"use strict";MC.exports=tn;var Cu=Vi();((tn.prototype=Object.create(Cu.prototype)).constructor=tn).className="Field";var NC=vn(),OC=Bi(),Ze=lt(),Nm,kO=/^required|optional|repeated$/;tn.fromJSON=function(e,t){return new tn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function tn(n,e,t,r,i,s,o){if(Ze.isObject(r)?(o=i,s=r,r=i=void 0):Ze.isObject(i)&&(o=s,s=i,i=void 0),Cu.call(this,n,s),!Ze.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ze.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!kO.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ze.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ze.Long?OC.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(tn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});tn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Cu.prototype.setOption.call(this,e,t,r)};tn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ze.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};tn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=OC.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Nm?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof NC&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof NC))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ze.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ze.base64.test(this.typeDefault)?Ze.base64.decode(this.typeDefault,e=Ze.newBuffer(Ze.base64.length(this.typeDefault)),0):Ze.utf8.write(this.typeDefault,e=Ze.newBuffer(Ze.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ze.emptyObject:this.repeated?this.defaultValue=Ze.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Nm&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Cu.prototype.resolve.call(this)};tn.d=function(e,t,r,i){return typeof t=="function"?t=Ze.decorateType(t).name:t&&typeof t=="object"&&(t=Ze.decorateEnum(t).name),function(o,a){Ze.decorateType(o.constructor).add(new tn(a,e,t,r,{default:i}))}};tn._configure=function(e){Nm=e}});var Ys=k((o5,LC)=>{"use strict";LC.exports=nn;var Tu=Vi();((nn.prototype=Object.create(Tu.prototype)).constructor=nn).className="OneOf";var PC=Ur(),wu=lt();function nn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Tu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}nn.fromJSON=function(e,t){return new nn(e,t.oneof,t.options,t.comment)};nn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return wu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function FC(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}nn.prototype.add=function(e){if(!(e instanceof PC))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,FC(this),this};nn.prototype.remove=function(e){if(!(e instanceof PC))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};nn.prototype.onAdd=function(e){Tu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}FC(this)};nn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Tu.prototype.onRemove.call(this,e)};nn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){wu.decorateType(i.constructor).add(new nn(s,e)),Object.defineProperty(i,s,{get:wu.oneOfGetter(e),set:wu.oneOfSetter(e)})}}});var Zs=k((a5,UC)=>{"use strict";UC.exports=fe;var Om=Vi();((fe.prototype=Object.create(Om.prototype)).constructor=fe).className="Namespace";var BC=Ur(),Au=lt(),xO=Ys(),Js,Ya,Xs;fe.fromJSON=function(e,t){return new fe(e,t.options).addJSON(t.nested)};function VC(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}fe.arrayToJSON=VC;fe.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};fe.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function fe(n,e){Om.call(this,n,e),this.nested=void 0,this._nestedArray=null}function qC(n){return n._nestedArray=null,n}Object.defineProperty(fe.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Au.toArray(this.nested))}});fe.prototype.toJSON=function(e){return Au.toObject(["options",this.options,"nested",VC(this.nestedArray,e)])};fe.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Js.fromJSON:s.values!==void 0?Xs.fromJSON:s.methods!==void 0?Ya.fromJSON:s.id!==void 0?BC.fromJSON:fe.fromJSON)(r[i],s));return this};fe.prototype.get=function(e){return this.nested&&this.nested[e]||null};fe.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Xs)return this.nested[e].values;throw Error("no such enum: "+e)};fe.prototype.add=function(e){if(!(e instanceof BC&&e.extend!==void 0||e instanceof Js||e instanceof xO||e instanceof Xs||e instanceof Ya||e instanceof fe))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof fe&&e instanceof fe&&!(t instanceof Js||t instanceof Ya)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),qC(this)};fe.prototype.remove=function(e){if(!(e instanceof Om))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),qC(this)};fe.prototype.define=function(e,t){if(Au.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof fe))throw Error("path conflicts with non-namespace objects")}else r.add(r=new fe(i))}return t&&r.addJSON(t),r};fe.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof fe?e[t++].resolveAll():e[t++].resolve();return this.resolve()};fe.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Au.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof fe&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof fe&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};fe.prototype.lookupType=function(e){var t=this.lookup(e,[Js]);if(!t)throw Error("no such type: "+e);return t};fe.prototype.lookupEnum=function(e){var t=this.lookup(e,[Xs]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};fe.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Js,Xs]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};fe.prototype.lookupService=function(e){var t=this.lookup(e,[Ya]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};fe._configure=function(n,e,t){Js=n,Ya=e,Xs=t}});var Iu=k((l5,zC)=>{"use strict";zC.exports=ar;var Mm=Ur();((ar.prototype=Object.create(Mm.prototype)).constructor=ar).className="MapField";var NO=Bi(),Ja=lt();function ar(n,e,t,r,i,s){if(Mm.call(this,n,e,r,void 0,void 0,i,s),!Ja.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}ar.fromJSON=function(e,t){return new ar(e,t.id,t.keyType,t.type,t.options,t.comment)};ar.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ja.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};ar.prototype.resolve=function(){if(this.resolved)return this;if(NO.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Mm.prototype.resolve.call(this)};ar.d=function(e,t,r){return typeof r=="function"?r=Ja.decorateType(r).name:r&&typeof r=="object"&&(r=Ja.decorateEnum(r).name),function(s,o){Ja.decorateType(s.constructor).add(new ar(o,e,t,r))}}});var Du=k((c5,GC)=>{"use strict";GC.exports=qi;var Pm=Vi();((qi.prototype=Object.create(Pm.prototype)).constructor=qi).className="Method";var eo=lt();function qi(n,e,t,r,i,s,o,a,l){if(eo.isObject(i)?(o=i,i=s=void 0):eo.isObject(s)&&(o=s,s=void 0),!(e===void 0||eo.isString(e)))throw TypeError("type must be a string");if(!eo.isString(t))throw TypeError("requestType must be a string");if(!eo.isString(r))throw TypeError("responseType must be a string");Pm.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}qi.fromJSON=function(e,t){return new qi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};qi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return eo.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};qi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Pm.prototype.resolve.call(this))}});var Ru=k((u5,$C)=>{"use strict";$C.exports=rn;var zr=Zs();((rn.prototype=Object.create(zr.prototype)).constructor=rn).className="Service";var Fm=Du(),Xa=lt(),OO=Am();function rn(n,e){zr.call(this,n,e),this.methods={},this._methodsArray=null}rn.fromJSON=function(e,t){var r=new rn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Fm.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};rn.prototype.toJSON=function(e){var t=zr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Xa.toObject(["options",t&&t.options||void 0,"methods",zr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(rn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Xa.toArray(this.methods))}});function jC(n){return n._methodsArray=null,n}rn.prototype.get=function(e){return this.methods[e]||zr.prototype.get.call(this,e)};rn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return zr.prototype.resolve.call(this)};rn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Fm?(this.methods[e.name]=e,e.parent=this,jC(this)):zr.prototype.add.call(this,e)};rn.prototype.remove=function(e){if(e instanceof Fm){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,jC(this)}return zr.prototype.remove.call(this,e)};rn.prototype.create=function(e,t,r){for(var i=new OO.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Xa.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Xa.codegen(["r","c"],Xa.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var ku=k((d5,WC)=>{"use strict";WC.exports=Bn;var MO=Fn();function Bn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Bn.create=function(e){return this.$type.create(e)};Bn.encode=function(e,t){return this.$type.encode(e,t)};Bn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Bn.decode=function(e){return this.$type.decode(e)};Bn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Bn.verify=function(e){return this.$type.verify(e)};Bn.fromObject=function(e){return this.$type.fromObject(e)};Bn.toObject=function(e,t){return this.$type.toObject(e,t)};Bn.prototype.toJSON=function(){return this.$type.toObject(this,MO.toJSONOptions)}});var Lm=k((h5,HC)=>{"use strict";HC.exports=LO;var PO=vn(),lr=Bi(),KC=lt();function FO(n){return"missing required '"+n.name+"'"}function LO(n){var e=KC.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof PO?"int32":r.type,s="m"+KC.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),lr.defaults[r.keyType]!==void 0?e("k=%j",lr.defaults[r.keyType]):e("k=null"),lr.defaults[i]!==void 0?e("value=%j",lr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),lr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),lr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),lr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),lr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):lr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",FO(o))}return e("return m")}});var qm=k((f5,QC)=>{"use strict";QC.exports=qO;var BO=vn(),Bm=lt();function sn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Vm(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof BO){n("switch(%s){",r)("default:")("return%j",sn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",sn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",sn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",sn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",sn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",sn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",sn(e,"buffer"));break}return n}function VO(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",sn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",sn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",sn(e,"boolean key"));break}return n}function qO(n){var e=Bm.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Bm.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",sn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),VO(e,s,"k[i]"),Vm(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",sn(s,"array"))("for(var i=0;i<%s.length;++i){",o),Vm(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Bm.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}Vm(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Gm=k(JC=>{"use strict";var YC=JC,Za=vn(),Vn=lt();function Um(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Za){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}YC.fromObject=function(e){var t=e.fieldsArray,r=Vn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Vn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Um(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Um(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Za||r("if(d%s!=null){",o),Um(r,s,i,o),s.resolvedType instanceof Za||r("}"))}return r("return m")};function zm(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Za?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}YC.toObject=function(e){var t=e.fieldsArray.slice().sort(Vn.compareFieldsById);if(!t.length)return Vn.codegen()("return {}");for(var r=Vn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Vn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Vn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Vn.safeProp(l.name);if(l.resolvedType instanceof Za)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=Vn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),zm(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),zm(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),zm(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Vn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var jm=k(XC=>{"use strict";var UO=XC,zO=ku();UO[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof zO){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Ou=k((g5,ew)=>{"use strict";ew.exports=Te;var _n=Zs();((Te.prototype=Object.create(_n.prototype)).constructor=Te).className="Type";var GO=vn(),Km=Ys(),xu=Ur(),jO=Iu(),$O=Ru(),$m=ku(),Wm=Eu(),WO=Su(),gt=lt(),KO=Hm(),HO=Lm(),QO=qm(),ZC=Gm(),YO=jm();function Te(n,e){_n.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Te.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=gt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=gt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Te.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof $m||((n.prototype=new $m).constructor=n,gt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,gt.merge(n,$m,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:gt.oneOfGetter(this._oneofsArray[t].oneof),set:gt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Te.generateConstructor=function(e){for(var t=gt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",gt.safeProp(i.name)):i.repeated&&t("this%s=[]",gt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Nu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Te.fromJSON=function(e,t){var r=new Te(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?jO.fromJSON:xu.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Km.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?xu.fromJSON:o.fields!==void 0?Te.fromJSON:o.values!==void 0?GO.fromJSON:o.methods!==void 0?$O.fromJSON:_n.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Te.prototype.toJSON=function(e){var t=_n.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return gt.toObject(["options",t&&t.options||void 0,"oneofs",_n.arrayToJSON(this.oneofsArray,e),"fields",_n.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Te.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return _n.prototype.resolveAll.call(this)};Te.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Te.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof xu&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Nu(this)}return e instanceof Km?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Nu(this)):_n.prototype.add.call(this,e)};Te.prototype.remove=function(e){if(e instanceof xu&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Nu(this)}if(e instanceof Km){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Nu(this)}return _n.prototype.remove.call(this,e)};Te.prototype.isReservedId=function(e){return _n.isReservedId(this.reserved,e)};Te.prototype.isReservedName=function(e){return _n.isReservedName(this.reserved,e)};Te.prototype.create=function(e){return new this.ctor(e)};Te.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=KO(this)({Writer:WO,types:t,util:gt}),this.decode=HO(this)({Reader:Wm,types:t,util:gt}),this.verify=QO(this)({types:t,util:gt}),this.fromObject=ZC.fromObject(this)({types:t,util:gt}),this.toObject=ZC.toObject(this)({types:t,util:gt});var i=YO[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Te.prototype.encode=function(e,t){return this.setup().encode(e,t)};Te.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Te.prototype.decode=function(e,t){return this.setup().decode(e,t)};Te.prototype.decodeDelimited=function(e){return e instanceof Wm||(e=Wm.create(e)),this.decode(e,e.uint32())};Te.prototype.verify=function(e){return this.setup().verify(e)};Te.prototype.fromObject=function(e){return this.setup().fromObject(e)};Te.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Te.d=function(e){return function(r){gt.decorateType(r,e)}}});var Fu=k((y5,sw)=>{"use strict";sw.exports=Ut;var Pu=Zs();((Ut.prototype=Object.create(Pu.prototype)).constructor=Ut).className="Root";var Ym=Ur(),nw=vn(),JO=Ys(),Gr=lt(),rw,Qm,el;function Ut(n){Pu.call(this,"",n),this.deferred=[],this.files=[]}Ut.fromJSON=function(e,t){return t||(t=new Ut),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Ut.prototype.resolvePath=Gr.path.resolve;Ut.prototype.fetch=Gr.fetch;function iw(){}Ut.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Gr.asPromise(n,i,e,t);var s=r===iw;function o(v,w){if(r){if(s)throw v;var A=r;r=null,A(v,w)}}function a(v){var w=v.lastIndexOf("google/protobuf/");if(w>-1){var A=v.substring(w);if(A in el)return A}return null}function l(v,w){try{if(Gr.isString(w)&&w.charAt(0)==="{"&&(w=JSON.parse(w)),!Gr.isString(w))i.setOptions(w.options).addJSON(w.nested);else{Qm.filename=v;var A=Qm(w,i,t),T,F=0;if(A.imports)for(;F<A.imports.length;++F)(T=a(A.imports[F])||i.resolvePath(v,A.imports[F]))&&c(T);if(A.weakImports)for(F=0;F<A.weakImports.length;++F)(T=a(A.weakImports[F])||i.resolvePath(v,A.weakImports[F]))&&c(T,!0)}}catch(R){o(R)}!s&&!u&&o(null,i)}function c(v,w){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in el){s?l(v,el[v]):(++u,setTimeout(function(){--u,l(v,el[v])}));return}if(s){var A;try{A=Gr.fs.readFileSync(v).toString("utf8")}catch(T){w||o(T);return}l(v,A)}else++u,i.fetch(v,function(T,F){if(--u,!!r){if(T){w?u||o(null,i):o(T);return}l(v,F)}})}}var u=0;Gr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||o(null,i)};Ut.prototype.loadSync=function(e,t){if(!Gr.isNode)throw Error("not supported");return this.load(e,t,iw)};Ut.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Pu.prototype.resolveAll.call(this)};var Mu=/^[A-Z]/;function tw(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Ym(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Ut.prototype._handleAdd=function(e){if(e instanceof Ym)e.extend!==void 0&&!e.extensionField&&(tw(this,e)||this.deferred.push(e));else if(e instanceof nw)Mu.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof JO)){if(e instanceof rw)for(var t=0;t<this.deferred.length;)tw(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Mu.test(e.name)&&(e.parent[e.name]=e)}};Ut.prototype._handleRemove=function(e){if(e instanceof Ym){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof nw)Mu.test(e.name)&&delete e.parent[e.name];else if(e instanceof Pu){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Mu.test(e.name)&&delete e.parent[e.name]}};Ut._configure=function(n,e,t){rw=n,Qm=e,el=t}});var lt=k((v5,aw)=>{"use strict";var We=aw.exports=Fn(),ow=Im(),Jm,Xm;We.codegen=TC();We.fetch=IC();We.path=kC();We.fs=We.inquire("fs");We.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};We.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var XO=/\\/g,ZO=/"/g;We.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};We.safeProp=function(e){return!/^[$\w_]+$/.test(e)||We.isReserved(e)?'["'+e.replace(XO,"\\\\").replace(ZO,'\\"')+'"]':"."+e};We.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var eM=/_([a-z])/g;We.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(eM,function(t,r){return r.toUpperCase()})};We.compareFieldsById=function(e,t){return e.id-t.id};We.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(We.decorateRoot.remove(e.$type),e.$type.name=t,We.decorateRoot.add(e.$type)),e.$type;Jm||(Jm=Ou());var r=new Jm(t||e.name);return We.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var tM=0;We.decorateEnum=function(e){if(e.$type)return e.$type;Xm||(Xm=vn());var t=new Xm("Enum"+tM++,e);return We.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};We.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(We,"decorateRoot",{get:function(){return ow.decorated||(ow.decorated=new(Fu()))}})});var Vi=k((_5,lw)=>{"use strict";lw.exports=zt;zt.className="ReflectionObject";var Lu=lt(),Bu;function zt(n,e){if(!Lu.isString(n))throw TypeError("name must be a string");if(e&&!Lu.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(zt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});zt.prototype.toJSON=function(){throw Error()};zt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Bu&&t._handleAdd(this)};zt.prototype.onRemove=function(e){var t=e.root;t instanceof Bu&&t._handleRemove(this),this.parent=null,this.resolved=!1};zt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Bu&&(this.resolved=!0),this)};zt.prototype.getOption=function(e){if(this.options)return this.options[e]};zt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};zt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Lu.setProperty(o,r,t)}else s={},s[e]=Lu.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};zt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};zt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};zt._configure=function(n){Bu=n}});var vn=k((S5,dw)=>{"use strict";dw.exports=qn;var cw=Vi();((qn.prototype=Object.create(cw.prototype)).constructor=qn).className="Enum";var uw=Zs(),Vu=lt();function qn(n,e,t,r,i,s){if(cw.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}qn.fromJSON=function(e,t){var r=new qn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};qn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Vu.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};qn.prototype.add=function(e,t,r,i){if(!Vu.isString(e))throw TypeError("name must be a string");if(!Vu.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};qn.prototype.remove=function(e){if(!Vu.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};qn.prototype.isReservedId=function(e){return uw.isReservedId(this.reserved,e)};qn.prototype.isReservedName=function(e){return uw.isReservedName(this.reserved,e)}});var Hm=k((b5,fw)=>{"use strict";fw.exports=rM;var nM=vn(),Zm=Bi(),eg=lt();function hw(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function rM(n){for(var e=eg.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(eg.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof nM?"int32":s.type,l=Zm.basic[a];r="m"+eg.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Zm.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Zm.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?hw(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?hw(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var mw=k((E5,pw)=>{"use strict";var ae=pw.exports=CC();ae.build="light";function iM(n,e,t){return typeof e=="function"?(t=e,e=new ae.Root):e||(e=new ae.Root),e.load(n,t)}ae.load=iM;function sM(n,e){return e||(e=new ae.Root),e.loadSync(n)}ae.loadSync=sM;ae.encoder=Hm();ae.decoder=Lm();ae.verifier=qm();ae.converter=Gm();ae.ReflectionObject=Vi();ae.Namespace=Zs();ae.Root=Fu();ae.Enum=vn();ae.Type=Ou();ae.Field=Ur();ae.OneOf=Ys();ae.MapField=Iu();ae.Service=Ru();ae.Method=Du();ae.Message=ku();ae.wrappers=jm();ae.types=Bi();ae.util=lt();ae.ReflectionObject._configure(ae.Root);ae.Namespace._configure(ae.Type,ae.Service,ae.Enum);ae.Root._configure(ae.Type);ae.Field._configure(ae.Type)});var ng=k((C5,vw)=>{"use strict";vw.exports=yw;var tg=/[\s{}=;:[\],'"()<>]/g,oM=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,aM=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,lM=/^ *[*/]+ */,cM=/^\s*\*?\/*/,uM=/\n/g,dM=/\s/,hM=/\\(.?)/g,fM={0:"\0",r:"\r",n:`
`,t:"	"};function gw(n){return n.replace(hM,function(e,t){switch(t){case"\\":case"":return t;default:return fM[t]||""}})}yw.unescape=gw;function yw(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(B){return Error("illegal "+B+" (line "+i+")")}function u(){var B=l==="'"?aM:oM;B.lastIndex=t-1;var $=B.exec(n);if(!$)throw c("string");return t=B.lastIndex,T(l),l=null,gw($[1])}function d(B){return n.charAt(B)}function f(B,$,X){var S={type:n.charAt(B++),lineEmpty:!1,leading:X},g;e?g=2:g=3;var y=B-g,_;do if(--y<0||(_=n.charAt(y))===`
`){S.lineEmpty=!0;break}while(_===" "||_==="	");for(var p=n.substring(B,$).split(uM),b=0;b<p.length;++b)p[b]=p[b].replace(e?cM:lM,"").trim();S.text=p.join(`
`).trim(),o[i]=S,s=i}function v(B){var $=w(B),X=n.substring(B,$),S=/^\s*\/\//.test(X);return S}function w(B){for(var $=B;$<r&&d($)!==`
`;)$++;return $}function A(){if(a.length>0)return a.shift();if(l)return u();var B,$,X,S,g,y=t===0;do{if(t===r)return null;for(B=!1;dM.test(X=d(t));)if(X===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(S=t,g=!1,v(t-1)){g=!0;do if(t=w(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,w(t)+1);g&&(f(S,t,y),y=!0),i++,B=!0}else{for(g=d(S=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(S,t-1,y),y=!0),++i,B=!0}else if((X=d(t))==="*"){S=t+1,g=e||d(S)==="*";do{if(X===`
`&&++i,++t===r)throw c("comment");$=X,X=d(t)}while($!=="*"||X!=="/");++t,g&&(f(S,t-2,y),y=!0),B=!0}else return"/"}}while(B);var _=t;tg.lastIndex=0;var p=tg.test(d(_++));if(!p)for(;_<r&&!tg.test(d(_));)++_;var b=n.substring(t,t=_);return(b==='"'||b==="'")&&(l=b),b}function T(B){a.push(B)}function F(){if(!a.length){var B=A();if(B===null)return null;T(B)}return a[0]}function R(B,$){var X=F(),S=X===B;if(S)return A(),!0;if(!$)throw c("token '"+X+"', '"+B+"' expected");return!1}function L(B){var $=null,X;return B===void 0?(X=o[i-1],delete o[i-1],X&&(e||X.type==="*"||X.lineEmpty)&&($=X.leading?X.text:null)):(s<B&&F(),X=o[B],delete o[B],X&&!X.lineEmpty&&(e||X.type==="/")&&($=X.leading?null:X.text)),$}return Object.defineProperty({next:A,peek:F,push:T,skip:R,cmnt:L},"line",{get:function(){return i}})}});var ww=k((w5,Cw)=>{"use strict";Cw.exports=cr;cr.filename=null;cr.defaults={keepCase:!1};var pM=ng(),_w=Fu(),Sw=Ou(),bw=Ur(),mM=Iu(),Ew=Ys(),gM=vn(),yM=Ru(),vM=Du(),rg=Bi(),ig=lt(),_M=/^[1-9][0-9]*$/,SM=/^-?[1-9][0-9]*$/,bM=/^0[x][0-9a-fA-F]+$/,EM=/^-?0[x][0-9a-fA-F]+$/,CM=/^0[0-7]+$/,wM=/^-?0[0-7]+$/,TM=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Un=/^[a-zA-Z_][a-zA-Z_0-9]*$/,zn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,AM=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function cr(n,e,t){e instanceof _w||(t=e,e=new _w),t||(t=cr.defaults);var r=t.preferTrailingComment||!1,i=pM(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,w,A=!1,T=e,F=t.keepCase?function(O){return O}:ig.camelCase;function R(O,M,q){var J=cr.filename;return q||(cr.filename=null),Error("illegal "+(M||"token")+" '"+O+"' ("+(J?J+", ":"")+"line "+i.line+")")}function L(){var O=[],M;do{if((M=s())!=='"'&&M!=="'")throw R(M);O.push(s()),l(M),M=a()}while(M==='"'||M==="'");return O.join("")}function B(O){var M=s();switch(M){case"'":case'"':return o(M),L();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return X(M,!0)}catch{if(O&&zn.test(M))return M;throw R(M,"value")}}function $(O,M){var q,J;do M&&((q=a())==='"'||q==="'")?O.push(L()):O.push([J=S(s()),l("to",!0)?S(s()):J]);while(l(",",!0));var K={options:void 0};K.setOption=function(re,Fe){this.options===void 0&&(this.options={}),this.options[re]=Fe},b(K,function(Fe){if(Fe==="option")we(K,Fe),l(";");else throw R(Fe)},function(){dt(K)})}function X(O,M){var q=1;switch(O.charAt(0)==="-"&&(q=-1,O=O.substring(1)),O){case"inf":case"INF":case"Inf":return q*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(_M.test(O))return q*parseInt(O,10);if(bM.test(O))return q*parseInt(O,16);if(CM.test(O))return q*parseInt(O,8);if(TM.test(O))return q*parseFloat(O);throw R(O,"number",M)}function S(O,M){switch(O){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!M&&O.charAt(0)==="-")throw R(O,"id");if(SM.test(O))return parseInt(O,10);if(EM.test(O))return parseInt(O,16);if(wM.test(O))return parseInt(O,8);throw R(O,"id")}function g(){if(d!==void 0)throw R("package");if(d=s(),!zn.test(d))throw R(d,"name");T=T.define(d),l(";")}function y(){var O=a(),M;switch(O){case"weak":M=v||(v=[]),s();break;case"public":s();default:M=f||(f=[]);break}O=L(),l(";"),M.push(O)}function _(){if(l("="),w=L(),A=w==="proto3",!A&&w!=="proto2")throw R(w,"syntax");e.setOption("syntax",w),l(";")}function p(O,M){switch(M){case"option":return we(O,M),l(";"),!0;case"message":return h(O,M),!0;case"enum":return Se(O,M),!0;case"service":return Xe(O,M),!0;case"extend":return Cs(O,M),!0}return!1}function b(O,M,q){var J=i.line;if(O&&(typeof O.comment!="string"&&(O.comment=c()),O.filename=cr.filename),l("{",!0)){for(var K;(K=s())!=="}";)M(K);l(";",!0)}else q&&q(),l(";"),O&&(typeof O.comment!="string"||r)&&(O.comment=c(J)||O.comment)}function h(O,M){if(!Un.test(M=s()))throw R(M,"type name");var q=new Sw(M);b(q,function(K){if(!p(q,K))switch(K){case"map":ue(q,K);break;case"required":case"repeated":m(q,K);break;case"optional":A?m(q,"proto3_optional"):m(q,"optional");break;case"oneof":xe(q,K);break;case"extensions":$(q.extensions||(q.extensions=[]));break;case"reserved":$(q.reserved||(q.reserved=[]),!0);break;default:if(!A||!zn.test(K))throw R(K);o(K),m(q,"optional");break}}),O.add(q)}function m(O,M,q){var J=s();if(J==="group"){G(O,M);return}for(;J.endsWith(".")||a().startsWith(".");)J+=s();if(!zn.test(J))throw R(J,"type");var K=s();if(!Un.test(K))throw R(K,"name");K=F(K),l("=");var re=new bw(K,S(s()),J,M,q);if(b(re,function(Ft){if(Ft==="option")we(re,Ft),l(";");else throw R(Ft)},function(){dt(re)}),M==="proto3_optional"){var Fe=new Ew("_"+K);re.setOption("proto3_optional",!0),Fe.add(re),O.add(Fe)}else O.add(re);!A&&re.repeated&&(rg.packed[J]!==void 0||rg.basic[J]===void 0)&&re.setOption("packed",!1,!0)}function G(O,M){var q=s();if(!Un.test(q))throw R(q,"name");var J=ig.lcFirst(q);q===J&&(q=ig.ucFirst(q)),l("=");var K=S(s()),re=new Sw(q);re.group=!0;var Fe=new bw(J,K,q,M);Fe.filename=cr.filename,b(re,function(Ft){switch(Ft){case"option":we(re,Ft),l(";");break;case"required":case"repeated":m(re,Ft);break;case"optional":A?m(re,"proto3_optional"):m(re,"optional");break;case"message":h(re,Ft);break;case"enum":Se(re,Ft);break;default:throw R(Ft)}}),O.add(re).add(Fe)}function ue(O){l("<");var M=s();if(rg.mapKey[M]===void 0)throw R(M,"type");l(",");var q=s();if(!zn.test(q))throw R(q,"type");l(">");var J=s();if(!Un.test(J))throw R(J,"name");l("=");var K=new mM(F(J),S(s()),M,q);b(K,function(Fe){if(Fe==="option")we(K,Fe),l(";");else throw R(Fe)},function(){dt(K)}),O.add(K)}function xe(O,M){if(!Un.test(M=s()))throw R(M,"name");var q=new Ew(F(M));b(q,function(K){K==="option"?(we(q,K),l(";")):(o(K),m(q,"optional"))}),O.add(q)}function Se(O,M){if(!Un.test(M=s()))throw R(M,"name");var q=new gM(M);b(q,function(K){switch(K){case"option":we(q,K),l(";");break;case"reserved":$(q.reserved||(q.reserved=[]),!0);break;default:Ge(q,K)}}),O.add(q)}function Ge(O,M){if(!Un.test(M))throw R(M,"name");l("=");var q=S(s(),!0),J={options:void 0};J.setOption=function(K,re){this.options===void 0&&(this.options={}),this.options[K]=re},b(J,function(re){if(re==="option")we(J,re),l(";");else throw R(re)},function(){dt(J)}),O.add(M,q,J.comment,J.options)}function we(O,M){var q=l("(",!0);if(!zn.test(M=s()))throw R(M,"name");var J=M,K=J,re;q&&(l(")"),J="("+J+")",K=J,M=a(),AM.test(M)&&(re=M.slice(1),J+=M,s())),l("=");var Fe=St(O,J);qe(O,K,Fe,re)}function St(O,M){if(l("{",!0)){for(var q={};!l("}",!0);){if(!Un.test(ft=s()))throw R(ft,"name");if(ft===null)throw R(ft,"end of input");var J,K=ft;if(l(":",!0),a()==="{")J=St(O,M+"."+ft);else if(a()==="["){J=[];var re;if(l("[",!0)){do re=B(!0),J.push(re);while(l(",",!0));l("]"),typeof re<"u"&&Je(O,M+"."+ft,re)}}else J=B(!0),Je(O,M+"."+ft,J);var Fe=q[K];Fe&&(J=[].concat(Fe).concat(J)),q[K]=J,l(",",!0),l(";",!0)}return q}var Cr=B(!0);return Je(O,M,Cr),Cr}function Je(O,M,q){O.setOption&&O.setOption(M,q)}function qe(O,M,q,J){O.setParsedOption&&O.setParsedOption(M,q,J)}function dt(O){if(l("[",!0)){do we(O,"option");while(l(",",!0));l("]")}return O}function Xe(O,M){if(!Un.test(M=s()))throw R(M,"service name");var q=new yM(M);b(q,function(K){if(!p(q,K))if(K==="rpc")bt(q,K);else throw R(K)}),O.add(q)}function bt(O,M){var q=c(),J=M;if(!Un.test(M=s()))throw R(M,"name");var K=M,re,Fe,Cr,Ft;if(l("("),l("stream",!0)&&(Fe=!0),!zn.test(M=s())||(re=M,l(")"),l("returns"),l("("),l("stream",!0)&&(Ft=!0),!zn.test(M=s())))throw R(M);Cr=M,l(")");var Cc=new vM(K,J,re,Cr,Fe,Ft);Cc.comment=q,b(Cc,function(Lf){if(Lf==="option")we(Cc,Lf),l(";");else throw R(Lf)}),O.add(Cc)}function Cs(O,M){if(!zn.test(M=s()))throw R(M,"reference");var q=M;b(null,function(K){switch(K){case"required":case"repeated":m(O,K,q);break;case"optional":A?m(O,"proto3_optional",q):m(O,"optional",q);break;default:if(!A||!zn.test(K))throw R(K);o(K),m(O,"optional",q);break}})}for(var ft;(ft=s())!==null;)switch(ft){case"package":if(!u)throw R(ft);g();break;case"import":if(!u)throw R(ft);y();break;case"syntax":if(!u)throw R(ft);_();break;case"option":we(T,ft),l(";");break;default:if(p(T,ft)){u=!1;continue}throw R(ft)}return cr.filename=null,{package:d,imports:f,weakImports:v,syntax:w,root:e}}});var Iw=k((T5,Aw)=>{"use strict";Aw.exports=Sn;var IM=/\/|\./;function Sn(n,e){IM.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Sn[n]=e}Sn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Tw;Sn("duration",{Duration:Tw={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Sn("timestamp",{Timestamp:Tw});Sn("empty",{Empty:{fields:{}}});Sn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Sn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Sn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Sn.get=function(e){return Sn[e]||null}});var Rw=k((A5,Dw)=>{"use strict";var jr=Dw.exports=mw();jr.build="full";jr.tokenize=ng();jr.parse=ww();jr.common=Iw();jr.Root._configure(jr.Type,jr.parse,jr.common)});var qu=k((I5,kw)=>{"use strict";kw.exports=Rw()});var sg=k((D5,DM)=>{DM.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var Pw=k((se,Mw)=>{"use strict";var At=qu();Mw.exports=se=At.descriptor=At.Root.fromJSON(sg()).lookup(".google.protobuf");var xw=At.Namespace,tl=At.Root,ur=At.Enum,$r=At.Type,Wr=At.Field,RM=At.MapField,Uu=At.OneOf,nl=At.Service,zu=At.Method;tl.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.FileDescriptorSet.decode(e));var t=new tl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add($r.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(ur.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(Wr.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(nl.fromDescriptor(r.service[o]));var a=to(r.options,se.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};tl.prototype.toDescriptor=function(e){var t=se.FileDescriptorSet.create();return Nw(this,t.file,e),t};function Nw(n,e,t){var r=se.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof tl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof $r?r.messageType.push(s.toDescriptor(t)):s instanceof ur?r.enumType.push(s.toDescriptor()):s instanceof Wr?r.extension.push(s.toDescriptor(t)):s instanceof nl?r.service.push(s.toDescriptor()):s instanceof xw&&Nw(s,e,t);r.options=no(n.options,se.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var kM=0;$r.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=se.DescriptorProto.decode(e));var r=new $r(e.name.length?e.name:"Type"+kM++,to(e.options,se.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Uu.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=Wr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(Wr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add($r.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(ur.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};$r.prototype.toDescriptor=function(e){var t=se.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof RM){var s=og(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=og(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&Ow(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(se.DescriptorProto.create({name:i.typeName,field:[se.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),se.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:se.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Wr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof $r?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ur&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(se.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(se.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=no(this.options,se.MessageOptions),t};var xM=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Wr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=se.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=FM(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new Wr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=to(e.options,se.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=xM.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return LM(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};Wr.prototype.toDescriptor=function(e){var t=se.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=At.util.ucFirst(this.name),t.label=3;else{switch(t.type=og(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?Ow(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=no(this.options,se.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=se.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=se.FieldOptions.create())).packed=!0),t};var NM=0;ur.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new ur(e.name&&e.name.length?e.name:"Enum"+NM++,t,to(e.options,se.EnumOptions))};ur.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(se.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return se.EnumDescriptorProto.create({name:this.name,value:e,options:no(this.options,se.EnumOptions)})};var OM=0;Uu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=se.OneofDescriptorProto.decode(e)),new Uu(e.name&&e.name.length?e.name:"oneof"+OM++)};Uu.prototype.toDescriptor=function(){return se.OneofDescriptorProto.create({name:this.name})};var MM=0;nl.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.ServiceDescriptorProto.decode(e));var t=new nl(e.name&&e.name.length?e.name:"Service"+MM++,to(e.options,se.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(zu.fromDescriptor(e.method[r]));return t};nl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return se.ServiceDescriptorProto.create({name:this.name,method:e,options:no(this.options,se.ServiceOptions)})};var PM=0;zu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=se.MethodDescriptorProto.decode(e)),new zu(e.name&&e.name.length?e.name:"Method"+PM++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,to(e.options,se.MethodOptions))};zu.prototype.toDescriptor=function(){return se.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:no(this.options,se.MethodOptions)})};function FM(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function LM(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function og(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof ur)return 14;if(e instanceof $r)return e.group?10:11;throw Error("illegal type: "+n)}function to(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof ur&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(BM(s),o));return t.length?At.util.toObject(t):void 0}}function no(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=At.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(At.util.toObject(t)):void 0}}function Ow(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof tl)&&e instanceof xw)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function BM(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var Fw=k((R5,VM)=>{VM.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Lw=k((k5,qM)=>{qM.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Bw=k((x5,UM)=>{UM.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var zw=k(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.addCommonProtos=Kr.loadProtosWithOptionsSync=Kr.loadProtosWithOptions=void 0;var Vw=me("fs"),qw=me("path"),ro=qu();function Uw(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(qw.isAbsolute(i))return i;for(let s of e){let o=qw.join(s,i);try{return Vw.accessSync(o,Vw.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function zM(n,e){return E(this,null,function*(){let t=new ro.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));Uw(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}Kr.loadProtosWithOptions=zM;function GM(n,e){let t=new ro.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");Uw(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}Kr.loadProtosWithOptionsSync=GM;function jM(){let n=Fw(),e=sg(),t=Lw(),r=Bw();ro.common("api",n.nested.google.nested.protobuf.nested),ro.common("descriptor",e.nested.google.nested.protobuf.nested),ro.common("source_context",t.nested.google.nested.protobuf.nested),ro.common("type",r.nested.google.nested.protobuf.nested)}Kr.addCommonProtos=jM});var $w=k((jw,ag)=>{"use strict";var Gw=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,m,G){this.low=h|0,this.high=m|0,this.unsigned=!!G}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var m=Math.clz32(h&-h);return h?31-m:m}t.isLong=r;var s={},o={};function a(h,m){var G,ue,xe;return m?(h>>>=0,(xe=0<=h&&h<256)&&(ue=o[h],ue)?ue:(G=c(h,0,!0),xe&&(o[h]=G),G)):(h|=0,(xe=-128<=h&&h<128)&&(ue=s[h],ue)?ue:(G=c(h,h<0?-1:0,!1),xe&&(s[h]=G),G))}t.fromInt=a;function l(h,m){if(isNaN(h))return m?B:L;if(m){if(h<0)return B;if(h>=T)return y}else{if(h<=-F)return _;if(h+1>=F)return g}return h<0?l(-h,m).neg():c(h%A|0,h/A|0,m)}t.fromNumber=l;function c(h,m,G){return new t(h,m,G)}t.fromBits=c;var u=Math.pow;function d(h,m,G){if(h.length===0)throw Error("empty string");if(typeof m=="number"?(G=m,m=!1):m=!!m,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return m?B:L;if(G=G||10,G<2||36<G)throw RangeError("radix");var ue;if((ue=h.indexOf("-"))>0)throw Error("interior hyphen");if(ue===0)return d(h.substring(1),m,G).neg();for(var xe=l(u(G,8)),Se=L,Ge=0;Ge<h.length;Ge+=8){var we=Math.min(8,h.length-Ge),St=parseInt(h.substring(Ge,Ge+we),G);if(we<8){var Je=l(u(G,we));Se=Se.mul(Je).add(l(St))}else Se=Se.mul(xe),Se=Se.add(l(St))}return Se.unsigned=m,Se}t.fromString=d;function f(h,m){return typeof h=="number"?l(h,m):typeof h=="string"?d(h,m):c(h.low,h.high,typeof m=="boolean"?m:h.unsigned)}t.fromValue=f;var v=65536,w=1<<24,A=v*v,T=A*A,F=T/2,R=a(w),L=a(0);t.ZERO=L;var B=a(0,!0);t.UZERO=B;var $=a(1);t.ONE=$;var X=a(1,!0);t.UONE=X;var S=a(-1);t.NEG_ONE=S;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var _=c(0,-2147483648,!1);t.MIN_VALUE=_;var p=t.prototype;p.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.toNumber=function(){return this.unsigned?(this.high>>>0)*A+(this.low>>>0):this.high*A+(this.low>>>0)},p.toString=function(m){if(m=m||10,m<2||36<m)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_)){var G=l(m),ue=this.div(G),xe=ue.mul(G).sub(this);return ue.toString(m)+xe.toInt().toString(m)}else return"-"+this.neg().toString(m);for(var Se=l(u(m,6),this.unsigned),Ge=this,we="";;){var St=Ge.div(Se),Je=Ge.sub(St.mul(Se)).toInt()>>>0,qe=Je.toString(m);if(Ge=St,Ge.isZero())return qe+we;for(;qe.length<6;)qe="0"+qe;we=""+qe+we}},p.getHighBits=function(){return this.high},p.getHighBitsUnsigned=function(){return this.high>>>0},p.getLowBits=function(){return this.low},p.getLowBitsUnsigned=function(){return this.low>>>0},p.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var m=this.high!=0?this.high:this.low,G=31;G>0&&!(m&1<<G);G--);return this.high!=0?G+33:G+1},p.isZero=function(){return this.high===0&&this.low===0},p.eqz=p.isZero,p.isNegative=function(){return!this.unsigned&&this.high<0},p.isPositive=function(){return this.unsigned||this.high>=0},p.isOdd=function(){return(this.low&1)===1},p.isEven=function(){return(this.low&1)===0},p.equals=function(m){return r(m)||(m=f(m)),this.unsigned!==m.unsigned&&this.high>>>31===1&&m.high>>>31===1?!1:this.high===m.high&&this.low===m.low},p.eq=p.equals,p.notEquals=function(m){return!this.eq(m)},p.neq=p.notEquals,p.ne=p.notEquals,p.lessThan=function(m){return this.comp(m)<0},p.lt=p.lessThan,p.lessThanOrEqual=function(m){return this.comp(m)<=0},p.lte=p.lessThanOrEqual,p.le=p.lessThanOrEqual,p.greaterThan=function(m){return this.comp(m)>0},p.gt=p.greaterThan,p.greaterThanOrEqual=function(m){return this.comp(m)>=0},p.gte=p.greaterThanOrEqual,p.ge=p.greaterThanOrEqual,p.compare=function(m){if(r(m)||(m=f(m)),this.eq(m))return 0;var G=this.isNegative(),ue=m.isNegative();return G&&!ue?-1:!G&&ue?1:this.unsigned?m.high>>>0>this.high>>>0||m.high===this.high&&m.low>>>0>this.low>>>0?-1:1:this.sub(m).isNegative()?-1:1},p.comp=p.compare,p.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add($)},p.neg=p.negate,p.add=function(m){r(m)||(m=f(m));var G=this.high>>>16,ue=this.high&65535,xe=this.low>>>16,Se=this.low&65535,Ge=m.high>>>16,we=m.high&65535,St=m.low>>>16,Je=m.low&65535,qe=0,dt=0,Xe=0,bt=0;return bt+=Se+Je,Xe+=bt>>>16,bt&=65535,Xe+=xe+St,dt+=Xe>>>16,Xe&=65535,dt+=ue+we,qe+=dt>>>16,dt&=65535,qe+=G+Ge,qe&=65535,c(Xe<<16|bt,qe<<16|dt,this.unsigned)},p.subtract=function(m){return r(m)||(m=f(m)),this.add(m.neg())},p.sub=p.subtract,p.multiply=function(m){if(this.isZero())return this;if(r(m)||(m=f(m)),e){var G=e.mul(this.low,this.high,m.low,m.high);return c(G,e.get_high(),this.unsigned)}if(m.isZero())return this.unsigned?B:L;if(this.eq(_))return m.isOdd()?_:L;if(m.eq(_))return this.isOdd()?_:L;if(this.isNegative())return m.isNegative()?this.neg().mul(m.neg()):this.neg().mul(m).neg();if(m.isNegative())return this.mul(m.neg()).neg();if(this.lt(R)&&m.lt(R))return l(this.toNumber()*m.toNumber(),this.unsigned);var ue=this.high>>>16,xe=this.high&65535,Se=this.low>>>16,Ge=this.low&65535,we=m.high>>>16,St=m.high&65535,Je=m.low>>>16,qe=m.low&65535,dt=0,Xe=0,bt=0,Cs=0;return Cs+=Ge*qe,bt+=Cs>>>16,Cs&=65535,bt+=Se*qe,Xe+=bt>>>16,bt&=65535,bt+=Ge*Je,Xe+=bt>>>16,bt&=65535,Xe+=xe*qe,dt+=Xe>>>16,Xe&=65535,Xe+=Se*Je,dt+=Xe>>>16,Xe&=65535,Xe+=Ge*St,dt+=Xe>>>16,Xe&=65535,dt+=ue*qe+xe*Je+Se*St+Ge*we,dt&=65535,c(bt<<16|Cs,dt<<16|Xe,this.unsigned)},p.mul=p.multiply,p.divide=function(m){if(r(m)||(m=f(m)),m.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&m.low===-1&&m.high===-1)return this;var G=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,m.low,m.high);return c(G,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?B:L;var ue,xe,Se;if(this.unsigned){if(m.unsigned||(m=m.toUnsigned()),m.gt(this))return B;if(m.gt(this.shru(1)))return X;Se=B}else{if(this.eq(_)){if(m.eq($)||m.eq(S))return _;if(m.eq(_))return $;var Ge=this.shr(1);return ue=Ge.div(m).shl(1),ue.eq(L)?m.isNegative()?$:S:(xe=this.sub(m.mul(ue)),Se=ue.add(xe.div(m)),Se)}else if(m.eq(_))return this.unsigned?B:L;if(this.isNegative())return m.isNegative()?this.neg().div(m.neg()):this.neg().div(m).neg();if(m.isNegative())return this.div(m.neg()).neg();Se=L}for(xe=this;xe.gte(m);){ue=Math.max(1,Math.floor(xe.toNumber()/m.toNumber()));for(var we=Math.ceil(Math.log(ue)/Math.LN2),St=we<=48?1:u(2,we-48),Je=l(ue),qe=Je.mul(m);qe.isNegative()||qe.gt(xe);)ue-=St,Je=l(ue,this.unsigned),qe=Je.mul(m);Je.isZero()&&(Je=$),Se=Se.add(Je),xe=xe.sub(qe)}return Se},p.div=p.divide,p.modulo=function(m){if(r(m)||(m=f(m)),e){var G=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,m.low,m.high);return c(G,e.get_high(),this.unsigned)}return this.sub(this.div(m).mul(m))},p.mod=p.modulo,p.rem=p.modulo,p.not=function(){return c(~this.low,~this.high,this.unsigned)},p.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},p.clz=p.countLeadingZeros,p.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},p.ctz=p.countTrailingZeros,p.and=function(m){return r(m)||(m=f(m)),c(this.low&m.low,this.high&m.high,this.unsigned)},p.or=function(m){return r(m)||(m=f(m)),c(this.low|m.low,this.high|m.high,this.unsigned)},p.xor=function(m){return r(m)||(m=f(m)),c(this.low^m.low,this.high^m.high,this.unsigned)},p.shiftLeft=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low<<m,this.high<<m|this.low>>>32-m,this.unsigned):c(0,this.low<<m-32,this.unsigned)},p.shl=p.shiftLeft,p.shiftRight=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>m,this.unsigned):c(this.high>>m-32,this.high>=0?0:-1,this.unsigned)},p.shr=p.shiftRight,p.shiftRightUnsigned=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>>m,this.unsigned):m===32?c(this.high,0,this.unsigned):c(this.high>>>m-32,0,this.unsigned)},p.shru=p.shiftRightUnsigned,p.shr_u=p.shiftRightUnsigned,p.rotateLeft=function(m){var G;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(G=32-m,c(this.low<<m|this.high>>>G,this.high<<m|this.low>>>G,this.unsigned)):(m-=32,G=32-m,c(this.high<<m|this.low>>>G,this.low<<m|this.high>>>G,this.unsigned))},p.rotl=p.rotateLeft,p.rotateRight=function(m){var G;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(G=32-m,c(this.high<<G|this.low>>>m,this.low<<G|this.high>>>m,this.unsigned)):(m-=32,G=32-m,c(this.low<<G|this.high>>>m,this.high<<G|this.low>>>m,this.unsigned))},p.rotr=p.rotateRight,p.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},p.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},p.toBytes=function(m){return m?this.toBytesLE():this.toBytesBE()},p.toBytesLE=function(){var m=this.high,G=this.low;return[G&255,G>>>8&255,G>>>16&255,G>>>24,m&255,m>>>8&255,m>>>16&255,m>>>24]},p.toBytesBE=function(){var m=this.high,G=this.low;return[m>>>24,m>>>16&255,m>>>8&255,m&255,G>>>24,G>>>16&255,G>>>8&255,G&255]},t.fromBytes=function(m,G,ue){return ue?t.fromBytesLE(m,G):t.fromBytesBE(m,G)},t.fromBytesLE=function(m,G){return new t(m[0]|m[1]<<8|m[2]<<16|m[3]<<24,m[4]|m[5]<<8|m[6]<<16|m[7]<<24,G)},t.fromBytesBE=function(m,G){return new t(m[4]<<24|m[5]<<16|m[6]<<8|m[7],m[0]<<24|m[1]<<16|m[2]<<8|m[3],G)};var b=t;return n.default=b,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return Gw}):typeof ag=="object"&&typeof jw=="object"&&(ag.exports=Gw)});var dg=k(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.loadFileDescriptorSetFromObject=it.loadFileDescriptorSetFromBuffer=it.fromJSON=it.loadSync=it.load=it.IdempotencyLevel=it.isAnyExtension=it.Long=void 0;var $M=NE(),Gn=qu(),cg=Pw(),ug=zw(),WM=$w();it.Long=WM;function KM(n){return"@type"in n&&typeof n["@type"]=="string"}it.isAnyExtension=KM;var Hw;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(Hw=it.IdempotencyLevel||(it.IdempotencyLevel={}));var Qw={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function HM(n,e){return n===""?e:n+"."+e}function QM(n){return n instanceof Gn.Service||n instanceof Gn.Type||n instanceof Gn.Enum}function YM(n){return n instanceof Gn.Namespace||n instanceof Gn.Root}function Yw(n,e){let t=HM(e,n.name);return QM(n)?[[t,n]]:YM(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>Yw(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function Ww(n,e){return function(r){return n.toObject(n.decode(r),e)}}function Kw(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function JM(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:Hw.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function XM(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:Kw(i),requestDeserialize:Ww(i,t),responseSerialize:Kw(s),responseDeserialize:Ww(s,t),originalName:$M(n.name),requestType:lg(i,r),responseType:lg(s,r),options:JM(n.parsedOptions)}}function ZM(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=XM(s,e,t,r);return i}function lg(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,Qw),fileDescriptorProtos:e}}function eP(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,Qw),fileDescriptorProtos:e}}function tP(n,e,t,r){if(n instanceof Gn.Service)return ZM(n,e,t,r);if(n instanceof Gn.Type)return lg(n,r);if(n instanceof Gn.Enum)return eP(n,r);throw new Error("Type mismatch in reflection object handling")}function Gu(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(cg.FileDescriptorProto.encode(s).finish()));for(let[s,o]of Yw(n,""))t[s]=tP(o,s,e,i);return t}function Jw(n,e){e=e||{};let t=Gn.Root.fromDescriptor(n);return t.resolveAll(),Gu(t,e)}function nP(n,e){return(0,ug.loadProtosWithOptions)(n,e).then(t=>Gu(t,e))}it.load=nP;function rP(n,e){let t=(0,ug.loadProtosWithOptionsSync)(n,e);return Gu(t,e)}it.loadSync=rP;function iP(n,e){e=e||{};let t=Gn.Root.fromJSON(n);return t.resolveAll(),Gu(t,e)}it.fromJSON=iP;function sP(n,e){let t=cg.FileDescriptorSet.decode(n);return Jw(t,e)}it.loadFileDescriptorSetFromBuffer=sP;function oP(n,e){let t=cg.FileDescriptorSet.fromObject(n);return Jw(t,e)}it.loadFileDescriptorSetFromObject=oP;(0,ug.addCommonProtos)()});var Ui=k(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.setup=Oe.getChannelzServiceDefinition=Oe.getChannelzHandlers=Oe.unregisterChannelzRef=Oe.registerChannelzSocket=Oe.registerChannelzServer=Oe.registerChannelzSubchannel=Oe.registerChannelzChannel=Oe.ChannelzCallTracker=Oe.ChannelzChildrenTracker=Oe.ChannelzTrace=void 0;var Xw=me("net"),rl=Yt(),sl=pe(),aP=Mn(),lP=uu(),cP=lm();function hg(n){return{channel_id:n.id,name:n.name}}function gg(n){return{subchannel_id:n.id,name:n.name}}function uP(n){return{server_id:n.id}}function $u(n){return{socket_id:n.id,name:n.name}}var Zw=32,fg=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=Zw*2&&(this.events=this.events.slice(Zw)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:dr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:dr(e.timestamp),channel_ref:e.childChannel?hg(e.childChannel):null,subchannel_ref:e.childSubchannel?gg(e.childSubchannel):null}))}}};Oe.ChannelzTrace=fg;var pg=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Oe.ChannelzChildrenTracker=pg;var mg=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Oe.ChannelzCallTracker=mg;var dP=1;function Wu(){return dP++}var il=[],yg=[],Hr=[],vg=[];function hP(n,e,t){let r=Wu(),i={id:r,name:n,kind:"channel"};return t&&(il[r]={ref:i,getInfo:e}),i}Oe.registerChannelzChannel=hP;function fP(n,e,t){let r=Wu(),i={id:r,name:n,kind:"subchannel"};return t&&(yg[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSubchannel=fP;function pP(n,e){let t=Wu(),r={id:t,kind:"server"};return e&&(Hr[t]={ref:r,getInfo:n}),r}Oe.registerChannelzServer=pP;function mP(n,e,t){let r=Wu(),i={id:r,name:n,kind:"socket"};return t&&(vg[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSocket=mP;function gP(n){switch(n.kind){case"channel":delete il[n.id];return;case"subchannel":delete yg[n.id];return;case"server":delete Hr[n.id];return;case"socket":delete vg[n.id];return}}Oe.unregisterChannelzRef=gP;function yP(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function eT(n){if(n==="")return[];let e=n.split(":").map(r=>yP(r));return[].concat(...e)}function vP(n){if((0,Xw.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,Xw.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(eT(e)),s=Buffer.from(eT(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function nT(n){switch(n){case rl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case rl.ConnectivityState.IDLE:return{state:"IDLE"};case rl.ConnectivityState.READY:return{state:"READY"};case rl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case rl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function dr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function rT(n){let e=n.getInfo();return{ref:hg(n.ref),data:{target:e.target,state:nT(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:dr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>hg(t)),subchannel_ref:e.children.subchannels.map(t=>gg(t))}}function _P(n,e){let t=Number.parseInt(n.request.channel_id),r=il[t];if(r===void 0){e({code:sl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:rT(r)})}function SP(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<il.length;i++){let s=il[i];if(s!==void 0&&(r.push(rT(s)),r.length>=t))break}e(null,{channel:r,end:i>=Hr.length})}function iT(n){let e=n.getInfo();return{ref:uP(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:dr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>$u(t))}}function bP(n,e){let t=Number.parseInt(n.request.server_id),r=Hr[t];if(r===void 0){e({code:sl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:iT(r)})}function EP(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Hr.length;i++){let s=Hr[i];if(s!==void 0&&(r.push(iT(s)),r.length>=t))break}e(null,{server:r,end:i>=Hr.length})}function CP(n,e){let t=Number.parseInt(n.request.subchannel_id),r=yg[t];if(r===void 0){e({code:sl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:gg(r.ref),data:{target:i.target,state:nT(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:dr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>$u(o))};e(null,{subchannel:s})}function tT(n){var e;return(0,aP.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=vP(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function wP(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=vg[a];if(l===void 0){e({code:sl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:$u(l.ref),local:c.localAddress?tT(c.localAddress):null,remote:c.remoteAddress?tT(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:dr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:dr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:dr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:dr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function TP(n,e){let t=Number.parseInt(n.request.server_id),r=Hr[t];if(r===void 0){e({code:sl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push($u(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function sT(){return{GetChannel:_P,GetTopChannels:SP,GetServer:bP,GetServers:EP,GetSubchannel:CP,GetSocket:wP,GetServerSockets:TP}}Oe.getChannelzHandlers=sT;var ju=null;function oT(){if(ju)return ju;let n=dg().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return ju=(0,cP.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,ju}Oe.getChannelzServiceDefinition=oT;function AP(){(0,lP.registerAdminService)(oT,sT)}Oe.setup=AP});var aT=k(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.Subchannel=void 0;var Ae=Yt(),IP=Ba(),_g=Ue(),Ku=pe(),DP=qt(),RP=Mn(),io=Ui(),kP="subchannel",xP=~(1<<31),Sg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Ae.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new io.ChannelzCallTracker,this.childrenTracker=new io.ChannelzChildrenTracker,this.streamTracker=new io.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new IP.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,RP.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new io.ChannelzTrace,this.channelzRef=(0,io.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){_g.trace(Ku.LogVerbosity.DEBUG,kP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){_g.trace(Ku.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Ae.ConnectivityState.TRANSIENT_FAILURE],Ae.ConnectivityState.CONNECTING):this.transitionToState([Ae.ConnectivityState.TRANSIENT_FAILURE],Ae.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,xP);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Ae.ConnectivityState.CONNECTING],Ae.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Ae.ConnectivityState.READY],Ae.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,_g.log(Ku.LogVerbosity.ERROR,`Connection to ${(0,DP.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Ae.ConnectivityState.CONNECTING],Ae.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Ae.ConnectivityState[this.connectivityState]+" -> "+Ae.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ae.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Ae.ConnectivityState.READY:this.stopBackoff();break;case Ae.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Ae.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Ae.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,io.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Ae.ConnectivityState.CONNECTING,Ae.ConnectivityState.READY],Ae.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Ku.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Ae.ConnectivityState.IDLE],Ae.ConnectivityState.CONNECTING)||this.connectivityState===Ae.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Ae.ConnectivityState.TRANSIENT_FAILURE],Ae.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Hu.Subchannel=Sg});var wg=k(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.setup=Jr.DEFAULT_PORT=void 0;var lT=Nn(),uT=me("dns"),dT=me("util"),NP=Pp(),bg=pe(),Eg=xt(),OP=Ue(),MP=pe(),Qr=qt(),cT=me("net"),PP=Ba(),FP="dns_resolver";function Yr(n){OP.trace(MP.LogVerbosity.DEBUG,FP,n)}Jr.DEFAULT_PORT=443;var LP=3e4,BP=dT.promisify(uT.resolveTxt),VP=dT.promisify(uT.lookup);function qP(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Cg=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Yr("Resolver constructed for target "+(0,Qr.uriToString)(e));let a=(0,Qr.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,cT.isIPv4)(a.host)||(0,cT.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Jr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Jr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:bg.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Qr.uriToString)(this.target)}`,metadata:new Eg.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new PP.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:LP,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Yr("Returning IP address for target "+(0,Qr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Yr("Failed to parse DNS address "+(0,Qr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:bg.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Qr.uriToString)(this.target)}`,metadata:new Eg.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Yr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=VP(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=qP(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Yr("Resolved addresses for target "+(0,Qr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Yr("Resolution error for target "+(0,Qr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=BP(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,NP.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:bg.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Eg.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Yr('resolution update delayed by "min time between resolutions" rate limit'):Yr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function UP(){(0,lT.registerResolver)("dns",Cg),(0,lT.registerDefaultScheme)("dns")}Jr.setup=UP});var Tg=k(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.getProxiedConnection=ao.mapProxyName=void 0;var ol=Ue(),so=pe(),zP=Nn(),GP=me("http"),jP=me("tls"),$P=Ue(),hT=Mn(),oo=qt(),WP=me("url"),KP=wg(),HP="proxy";function Xr(n){$P.trace(so.LogVerbosity.DEBUG,HP,n)}function QP(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new WP.URL(n)}catch{return(0,ol.log)(so.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,ol.log)(so.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,ol.log)(so.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Xr("Proxy server "+o.address+" set by environment variable "+e),o}function YP(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Xr("No proxy server list set by environment variable "+e),n.split(",")):[]}function JP(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=QP();if(!i.address)return r;let s=(0,oo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of YP())if(l===o)return Xr("Not using proxy for target in no_proxy list: "+(0,oo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,oo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}ao.mapProxyName=JP;function XP(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,oo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,oo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:KP.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,hT.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,hT.subchannelAddressToString)(n);return Xr("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=GP.request(l);v.once("connect",(w,A,T)=>{var F;if(v.removeAllListeners(),A.removeAllListeners(),w.statusCode===200)if(Xr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let R=(0,zP.getDefaultAuthority)(s),L=(0,oo.splitHostPort)(R),B=(F=L?.host)!==null&&F!==void 0?F:R,$=jP.connect(Object.assign({host:B,servername:B,socket:A},t),()=>{Xr("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:$,realTarget:s})});$.on("error",X=>{Xr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+X.message),f()})}else Xr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:A,realTarget:s});else(0,ol.log)(so.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+w.statusCode),f()}),v.once("error",w=>{v.removeAllListeners(),(0,ol.log)(so.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+w.message),f()}),v.end()})}ao.getProxiedConnection=XP});var Ig=k(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.StreamDecoder=void 0;var hr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(hr||{}),Ag=class{constructor(e){this.maxReadMessageLength=e,this.readState=hr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case hr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=hr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case hr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=hr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=hr.NO_DATA,i.push(s)}}break;case hr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=hr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Qu.StreamDecoder=Ag});var fT=k(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.Http2SubchannelCall=void 0;var fr=me("http2"),ZP=me("os"),ve=pe(),Zr=xt(),eF=Ig(),tF=Ue(),nF=pe(),rF="subchannel_call";function iF(n){for(let[e,t]of Object.entries(ZP.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Dg=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ve.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:ve.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new eF.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ve.Status.INTERNAL;break;case 401:this.mappedStatusCode=ve.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ve.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ve.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ve.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ve.Status.UNKNOWN}if(c&fr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=Zr.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:ve.Status.UNKNOWN,details:f.message,metadata:new Zr.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ve.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ve.Status.OK)return;let c,u="";switch(e.rstCode){case fr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ve.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case fr.constants.NGHTTP2_REFUSED_STREAM:c=ve.Status.UNAVAILABLE,u="Stream refused by server";break;case fr.constants.NGHTTP2_CANCEL:c=ve.Status.CANCELLED,u="Call cancelled";break;case fr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ve.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case fr.constants.NGHTTP2_INADEQUATE_SECURITY:c=ve.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case fr.constants.NGHTTP2_INTERNAL_ERROR:c=ve.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ve.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ve.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Zr.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+iF(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ve.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Zr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){tF.trace(nF.LogVerbosity.DEBUG,rF,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ve.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ve.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Zr.Metadata.fromHttp2Headers(e)}catch{r=new Zr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ve.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ve.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ve.Status.OK?t=fr.constants.NGHTTP2_NO_ERROR:t=fr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Zr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ve.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=ve.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ve.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ve.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Zr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Yu.Http2SubchannelCall=Dg});var Rg=k(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.getNextCallNumber=void 0;var sF=0;function oF(){return sF++}Ju.getNextCallNumber=oF});var gT=k(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.Http2SubchannelConnector=void 0;var Mg=me("http2"),pT=me("tls"),kg=Ui(),al=pe(),aF=Tg(),co=Ue(),mT=Nn(),Xu=Mn(),lo=qt(),lF=me("net"),cF=fT(),uF=Rg(),xg="transport",dF="transport_flowctrl",hF=yp().version,{HTTP2_HEADER_AUTHORITY:fF,HTTP2_HEADER_CONTENT_TYPE:pF,HTTP2_HEADER_METHOD:mF,HTTP2_HEADER_PATH:gF,HTTP2_HEADER_TE:yF,HTTP2_HEADER_USER_AGENT:vF}=Mg.constants,_F=2e4,SF=Buffer.from("too_many_pings","ascii"),Ng=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=_F,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new kg.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Xu.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,kg.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${hF}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Mg.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(SF)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),co.isTracerEnabled(xg)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Xu.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Xu.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){co.trace(al.LogVerbosity.DEBUG,xg,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){co.trace(al.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){co.trace(al.LogVerbosity.DEBUG,dF,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){co.trace(al.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[fF]=t,o[vF]=this.userAgent,o[pF]="application/grpc",o[mF]="POST",o[gF]=r,o[yF]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new cF.Http2SubchannelCall(a,l,i,this,(0,uF.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,kg.unregisterChannelzRef)(this.channelzRef)}},Og=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){co.trace(al.LogVerbosity.DEBUG,xg,(0,lo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,lo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,lo.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Xu.subchannelAddressToString)(e)));let d=(0,mT.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let T=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(F,R)=>(0,pT.checkServerIdentity)(T,R),f.servername=T}else{let T=(c=(l=(0,lo.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=T}i.socket&&(f.createConnection=(T,F)=>i.socket)}else f.createConnection=(T,F)=>i.socket?i.socket:lF.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let w=Mg.connect(v+d,f);this.session=w;let A="Failed to connect";w.unref(),w.once("connect",()=>{w.removeAllListeners(),s(new Ng(w,e,r,u)),this.session=null}),w.once("close",()=>{this.session=null,setImmediate(()=>{o(`${A} (${new Date().toISOString()})`)})}),w.once("error",T=>{A=T.message,this.trace("connection failed with error "+A)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,pT.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,mT.getDefaultAuthority)((i=(0,lo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,lo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,aF.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Zu.Http2SubchannelConnector=Og});var yT=k(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.getSubchannelPool=uo.SubchannelPool=void 0;var bF=eE(),EF=aT(),CF=Mn(),wF=qt(),TF=gT(),AF=1e4,ll=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},AF),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,wF.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,CF.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,bF.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new EF.Subchannel(e,t,r,i,new TF.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};uo.SubchannelPool=ll;var IF=new ll;function DF(n){return n?IF:new ll}uo.getSubchannelPool=DF});var Fg=k(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.FilterStackFactory=ho.FilterStack=void 0;var ed=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};ho.FilterStack=ed;var Pg=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new ed(this.factories.map(e=>e.createFilter()))}};ho.FilterStackFactory=Pg});var Lg=k(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.CompressionAlgorithms=void 0;var vT=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(vT||(td.CompressionAlgorithms=vT={}))});var Vg=k(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.BaseFilter=void 0;var Bg=class{sendMetadata(e){return E(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return E(this,null,function*(){return e})}receiveMessage(e){return E(this,null,function*(){return e})}receiveTrailers(e){return e}};nd.BaseFilter=Bg});var bT=k(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.CompressionFilterFactory=po.CompressionFilter=void 0;var rd=me("zlib"),ST=Lg(),id=pe(),RF=Vg(),kF=Ue(),xF=n=>typeof n=="number"&&typeof ST.CompressionAlgorithms[n]=="string",fo=class{writeMessage(e,t){return E(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return E(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},zi=class extends fo{compressMessage(e){return E(this,null,function*(){return e})}writeMessage(e,t){return E(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},qg=class extends fo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{rd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=rd.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:id.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Ug=class extends fo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{rd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=rd.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:id.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},zg=class extends fo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function _T(n,e){switch(n){case"identity":return new zi;case"deflate":return new qg(e);case"gzip":return new Ug(e);default:return new zg(n)}}var sd=class extends RF.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new zi,this.receiveCompression=new zi,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:id.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(xF(s)){let o=ST.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=_T(this.currentCompressionAlgorithm,-1))}else kF.log(id.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return E(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=_T(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new zi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return E(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof zi?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return E(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};po.CompressionFilter=sd;var Gg=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new sd(this.options,this.sharedFilterConfig)}};po.CompressionFilterFactory=Gg});var od=k(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.deadlineToString=jn.getRelativeTimeout=jn.getDeadlineTimeoutString=jn.minDeadline=void 0;function NF(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}jn.minDeadline=NF;var OF=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function MF(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of OF){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}jn.getDeadlineTimeoutString=MF;var PF=2147483647;function FF(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>PF?1/0:r}jn.getRelativeTimeout=FF;function LF(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}jn.deadlineToString=LF});var ld=k(ad=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});ad.restrictControlPlaneStatusCode=void 0;var $n=pe(),BF=[$n.Status.OK,$n.Status.INVALID_ARGUMENT,$n.Status.NOT_FOUND,$n.Status.ALREADY_EXISTS,$n.Status.FAILED_PRECONDITION,$n.Status.ABORTED,$n.Status.OUT_OF_RANGE,$n.Status.DATA_LOSS];function VF(n,e){return BF.includes(n)?{code:$n.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${$n.Status[n]} ${e}`}:{code:n,details:e}}ad.restrictControlPlaneStatusCode=VF});var CT=k(dd=>{"use strict";Object.defineProperty(dd,"__esModule",{value:!0});dd.LoadBalancingCall=void 0;var ET=Yt(),cd=pe(),qF=od(),ud=xt(),cl=Lr(),UF=qt(),zF=Ue(),jg=ld(),GF=me("http2"),jF="load_balancing_call",$g=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,UF.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){zF.trace(cd.LogVerbosity.DEBUG,jF,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+cl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case cl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:cd.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ud.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==ET.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+ET.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,qF.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===GF.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:cd.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new ud.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,jg.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:cd.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new ud.Metadata},"PROCESSED")});break;case cl.PickResultType.DROP:let{code:s,details:o}=(0,jg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case cl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,jg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case cl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ud.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};dd.LoadBalancingCall=$g});var TT=k(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.ResolvingCall=void 0;var mo=pe(),hd=od(),wT=xt(),$F=Ue(),WF=ld(),KF="resolving_call",Wg=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&mo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(mo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&mo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,hd.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){$F.trace(mo.LogVerbosity.DEBUG,KF,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,hd.deadlineToString)(this.deadline));let e=(0,hd.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(mo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==mo.Status.OK){let{code:r,details:i}=(0,WF.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new wT.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,hd.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new wT.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};fd.ResolvingCall=Wg});var AT=k(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.RetryingCall=ei.MessageBufferTracker=ei.RetryThrottler=void 0;var pd=pe(),HF=xt(),QF=Ue(),YF="retrying_call",Hg=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ei.RetryThrottler=Hg;var Qg=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ei.MessageBufferTracker=Qg;var Kg="grpc-previous-rpc-attempts",Yg=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){QF.trace(pd.LogVerbosity.DEBUG,YF,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new HF.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(pd.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===pd.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===pd.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Kg,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Kg,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Kg,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ei.RetryingCall=Yg});var gd=k(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.BaseSubchannelWrapper=void 0;var Jg=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};md.BaseSubchannelWrapper=Jg});var RT=k(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.InternalChannel=void 0;var JF=tu(),XF=Zb(),ZF=yT(),IT=Lr(),ul=pe(),eL=Fg(),tL=bT(),DT=Nn(),Xg=Ue(),nL=Tg(),yd=qt(),Wn=Yt(),dl=Ui(),rL=CT(),iL=od(),sL=TT(),Zg=Rg(),oL=ld(),ey=AT(),aL=gd(),lL=2147483647,cL=1e3,uL=30*60*1e3,vd=new Map,dL=1<<24,hL=1<<20,ty=class extends aL.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},ny=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Wn.ConnectivityState.IDLE,this.currentPicker=new IT.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new dl.ChannelzCallTracker,this.childrenTracker=new dl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof JF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,yd.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,DT.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},lL),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new dl.ChannelzTrace,this.channelzRef=(0,dl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,DT.getDefaultAuthority)(v);let w=(0,nL.mapProxyName)(v,r);this.target=w.target,this.options=Object.assign({},this.options,w.extraOptions),this.subchannelPool=(0,ZF.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new ey.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:dL,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:hL),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:uL,cL);let A={createSubchannel:(F,R)=>{let L=this.subchannelPool.getOrCreateSubchannel(this.target,F,Object.assign({},this.options,R),this.credentials);L.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",L.getChannelzRef());let B=new ty(L,this);return this.wrappedSubchannels.add(B),B},updateState:(F,R)=>{this.currentPicker=R;let L=this.pickQueue.slice();this.pickQueue=[],L.length>0&&this.callRefTimerUnref();for(let B of L)B.doPick();this.updateState(F)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:F=>{this.channelzEnabled&&this.childrenTracker.refChild(F)},removeChannelzChild:F=>{this.channelzEnabled&&this.childrenTracker.unrefChild(F)}};this.resolvingLoadBalancer=new XF.ResolvingLoadBalancer(this.target,A,r,(F,R)=>{F.retryThrottling?vd.set(this.getTarget(),new ey.RetryThrottler(F.retryThrottling.maxTokens,F.retryThrottling.tokenRatio,vd.get(this.getTarget()))):vd.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=R,this.currentResolutionError=null,process.nextTick(()=>{let L=this.configSelectionQueue;this.configSelectionQueue=[],L.length>0&&this.callRefTimerUnref();for(let B of L)B.getConfig()})},F=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+F.code+' and details "'+F.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,oL.restrictControlPlaneStatusCode)(F.code,F.details)),{metadata:F.metadata}));let R=this.configSelectionQueue;this.configSelectionQueue=[],R.length>0&&this.callRefTimerUnref();for(let L of R)L.reportResolverError(F)}),this.filterStackFactory=new eL.FilterStackFactory([new tL.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let T=new Error;(0,Xg.trace)(ul.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=T.stack)===null||d===void 0?void 0:d.substring(T.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Xg.trace)(t??ul.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,yd.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Xg.trace)(ul.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,yd.uriToString)(this.target)+" "+Wn.ConnectivityState[this.connectivityState]+" -> "+Wn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Wn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Wn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Wn.ConnectivityState.IDLE),this.currentPicker=new IT.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Wn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===ul.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Zg.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new rL.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Zg.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new ey.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,vd.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Zg.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,iL.deadlineToString)(t));let a={deadline:t,flags:s??ul.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new sL.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Wn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,dl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,yd.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Wn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Wn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};_d.InternalChannel=ny});var om=k(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});Sd.ChannelImplementation=void 0;var fL=tu(),pL=RT(),ry=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof fL.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new pL.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Sd.ChannelImplementation=ry});var BT=k(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.Http2ServerCallStream=on.ServerDuplexStreamImpl=on.ServerWritableStreamImpl=on.ServerReadableStreamImpl=on.ServerUnaryCallImpl=void 0;var PT=me("events"),go=me("http2"),oy=me("stream"),kT=me("zlib"),Re=pe(),ay=xt(),mL=Ig(),FT=Ue(),fl=Qc(),LT="server_call";function hl(n){FT.trace(Re.LogVerbosity.DEBUG,LT,n)}var gL="grpc-accept-encoding",yL="grpc-encoding",xT="grpc-message",NT="grpc-status",OT="grpc-timeout",vL=/(\d{1,8})\s*([HMSmun])/,_L={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},SL={[gL]:"identity,deflate,gzip",[yL]:"identity"},MT={[go.constants.HTTP2_HEADER_STATUS]:go.constants.HTTP_STATUS_OK,[go.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},bL={waitForTrailers:!0},iy=class extends PT.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};on.ServerUnaryCallImpl=iy;var bd=class extends oy.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};on.ServerReadableStreamImpl=bd;var pl=class extends oy.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new ay.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,fl.getErrorMessage)(i),code:Re.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Re.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};on.ServerWritableStreamImpl=pl;var yo=class extends oy.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new ay.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};on.ServerDuplexStreamImpl=yo;yo.prototype._read=bd.prototype._read;yo.prototype._write=pl.prototype._write;yo.prototype._final=pl.prototype._final;var sy=class extends PT.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Re.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Re.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;hl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Re.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=kT.createInflate():i=kT.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Re.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Re.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},MT),SL),t);this.stream.respond(r,bL)}receiveMetadata(e){let t=ay.Metadata.fromHttp2Headers(e);FT.isTracerEnabled(LT)&&hl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(OT);if(r.length>0){let i=r[0].toString().match(vL);if(i===null){let a=new Error("Invalid deadline");return a.code=Re.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*_L[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(EL,s,this),t.remove(OT)}return t.remove(go.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(go.constants.HTTP2_HEADER_TE),t.remove(go.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Re.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Re.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Re.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),w=f.readUInt8(0)===1?e:"identity",A=o.getDecompressedMessage(f,w);if(Buffer.isBuffer(A)){t(o.deserializeMessageWithInternalError(A));return}A.then(T=>t(o.deserializeMessageWithInternalError(T)),T=>r(T.code?T:{code:Re.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return E(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,fl.getErrorMessage)(t),code:Re.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return E(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Re.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,fl.getErrorMessage)(s),code:Re.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Re.Status.OK),!this.checkCancelled())if(hl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Re.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[NT]:e.code,[xT]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[NT]:e.code,[xT]:encodeURI(e.details)},MT),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Re.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Re.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new mL.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>E(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>E(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Re.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(w){this.sendError(w);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>E(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return E(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return E(this,null,function*(){if(t===null){hl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}hl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,fl.getErrorCode)(r);(i===null||i<Re.Status.OK||i>Re.Status.UNAUTHENTICATED)&&(i=Re.Status.INTERNAL),e.emit("error",{details:(0,fl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};on.Http2ServerCallStream=sy;function EL(n){let e=new Error("Deadline exceeded");e.code=Re.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var uy=k(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.ServerCredentials=void 0;var VT=kp(),ml=class{static createInsecure(){return new ly}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new cy({ca:e||(0,VT.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:VT.CIPHER_SUITES})}};Ed.ServerCredentials=ml;var ly=class extends ml{_isSecure(){return!1}_getSettings(){return null}},cy=class extends ml{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var zT=k(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.Server=void 0;var ti=me("http2"),pr=pe(),Gi=BT(),CL=uy(),qT=Nn(),Cd=Ue(),bn=Mn(),wL=qt(),Mt=Ui(),wd=~(1<<31),TL=~(1<<31),AL=2e4,{HTTP2_HEADER_PATH:UT}=ti.constants,IL="server";function DL(){}function dy(n){return{code:pr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function RL(n,e){let t=dy(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var hy=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Mt.ChannelzTrace,this.callTracker=new Mt.ChannelzCallTracker,this.listenerChildrenTracker=new Mt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Mt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Mt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:wd,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:wd,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:TL,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:AL,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,bn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,bn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),v=d.getCertificate(),w=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:w&&"raw"in w?w.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Cd.trace(pr.LogVerbosity.DEBUG,IL,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=RL(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof CL.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,wL.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,qT.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,w)=>{process.nextTick(()=>r(v,w))},l=()=>{let v;if(t._isSecure()){let w=Object.assign(o,t._getSettings());w.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=ti.createSecureServer(w),v.on("secureConnection",A=>{A.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else v=ti.createServer(o);return v.setTimeout(0,DL),this._setupHandlers(v),v},c=(v,w,A)=>v.length===0?Promise.resolve({port:w,count:A}):Promise.all(v.map(T=>{this.trace("Attempting to bind "+(0,bn.subchannelAddressToString)(T));let F;(0,bn.isTcpSubchannelAddress)(T)?F={host:T.host,port:w}:F=T;let R=l();return new Promise((L,B)=>{let $=X=>{this.trace("Failed to bind "+(0,bn.subchannelAddressToString)(T)+" with error "+X.message),L(X)};R.once("error",$),R.listen(F,()=>{if(this.shutdown){R.close(),L(new Error("bindAsync failed because server is shutdown"));return}let X=R.address(),S;typeof X=="string"?S={path:X}:S={host:X.address,port:X.port};let g=(0,Mt.registerChannelzSocket)((0,bn.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:R,channelzRef:g}),this.trace("Successfully bound "+(0,bn.subchannelAddressToString)(S)),L("port"in S?S.port:w),R.removeListener("error",$)})})})).then(T=>{let F=0;for(let R of T)if(typeof R=="number"&&(F+=1,R!==w))throw new Error("Invalid state: multiple port numbers added from single address");return{port:w,count:F+A}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let w=v[0],A=l();return new Promise((T,F)=>{let R=L=>{this.trace("Failed to bind "+(0,bn.subchannelAddressToString)(w)+" with error "+L.message),T(u(v.slice(1)))};A.once("error",R),A.listen(w,()=>{if(this.shutdown){A.close(),T({port:0,count:0});return}let L=A.address(),B={host:L.address,port:L.port},$=(0,Mt.registerChannelzSocket)((0,bn.subchannelAddressToString)(B),()=>({localAddress:B,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild($),this.http2ServerList.push({server:A,channelzRef:$}),this.trace("Successfully bound "+(0,bn.subchannelAddressToString)(B)),T(c(v.slice(1),L.port,1)),A.removeListener("error",R)})})},d={onSuccessfulResolution:(v,w,A)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let T;(0,bn.isTcpSubchannelAddress)(v[0])?v[0].port===0?T=u(v):T=c(v,v[0].port,0):T=c(v,1,0),T.then(F=>{if(F.count===0){let R=`No address added out of total ${v.length} resolved`;Cd.log(pr.LogVerbosity.ERROR,R),a(new Error(R),0)}else F.count<v.length&&Cd.log(pr.LogVerbosity.INFO,`WARNING Only ${F.count} addresses added out of total ${v.length} resolved`),a(null,F.port)},F=>{let R=`No address added out of total ${v.length} resolved`;Cd.log(pr.LogVerbosity.ERROR,R),a(new Error(R),0)})},onError:v=>{a(new Error(v.details),0)}};(0,qT.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Mt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(ti.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Mt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Mt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Mt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[ti.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[ti.constants.HTTP2_HEADER_STATUS]:ti.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Gi.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=pr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[UT],s=this._retrieveHandler(i);if(!s){this._respondWithError(dy(i),e,r);return}let o=new Gi.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===pr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:pr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[UT],i=this._retrieveHandler(r);if(!i){this._respondWithError(dy(r),e,null);return}let s=new Gi.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:pr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")kL(e,t,s,o);else if(a==="clientStream")xL(e,t,s,o);else if(a==="serverStream")NL(e,t,s,o);else if(a==="bidi")OL(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Mt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new Mt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let w=null,A=null,T=!1;if(this.maxConnectionAgeMs!==wd){let R=this.maxConnectionAgeMs/10,L=Math.random()*R*2-R;w=(l=(a=setTimeout(()=>{var B,$;T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(ti.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==wd&&(A=($=(B=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||$===void 0?void 0:$.call(B))},this.maxConnectionAgeMs+L)).unref)===null||l===void 0?void 0:l.call(a)}let F=(u=(c=setInterval(()=>{var R,L;let B=(L=(R=setTimeout(()=>{T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||L===void 0?void 0:L.call(R);try{s.ping(($,X,S)=>{clearTimeout(B)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(T||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,Mt.unregisterChannelzRef)(d)),w&&clearTimeout(w),A&&clearTimeout(A),F&&clearTimeout(F),this.sessions.delete(s)})})}};Td.Server=hy;function kL(n,e,t,r){return E(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Gi.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function xL(n,e,t,r){let i=new Gi.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function NL(n,e,t,r){return E(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Gi.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function OL(n,e,t,r){let i=new Gi.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var GT=k(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.StatusBuilder=void 0;var fy=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Ad.StatusBuilder=fy});var py=k(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.isDuration=ni.durationToMs=ni.msToDuration=void 0;function ML(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ni.msToDuration=ML;function PL(n){return n.seconds*1e3+n.nanos/1e6|0}ni.durationToMs=PL;function FL(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ni.isDuration=FL});var Ey=k(ri=>{"use strict";var my;Object.defineProperty(ri,"__esModule",{value:!0});ri.setup=ri.OutlierDetectionLoadBalancer=ri.OutlierDetectionLoadBalancingConfig=void 0;var Dd=Yt(),$T=pe(),ji=py(),WT=Cy(),KT=Or(),LL=lu(),BL=Lr(),jT=Mn(),VL=gd(),qL=Ue(),UL="outlier_detection";function ct(n){qL.trace($T.LogVerbosity.DEBUG,UL,n)}var by="outlier_detection",zL=((my=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&my!==void 0?my:"true")==="true",GL={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},jL={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function vo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function gy(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,ji.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Id(n,e,t){let r=t?`${t}.${e}`:e;if(vo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var gl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},GL),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},jL),o):null}getLoadBalancerName(){return by}toJsonObject(){return{interval:(0,ji.msToDuration)(this.intervalMs),base_ejection_time:(0,ji.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ji.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(gy(e,"interval"),gy(e,"base_ejection_time"),gy(e,"max_ejection_time"),Id(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");vo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Id(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),vo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),vo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Id(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Id(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),vo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),vo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ji.durationToMs)(e.interval):null,e.base_ejection_time?(0,ji.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ji.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(KT.validateLoadBalancingConfig))}};ri.OutlierDetectionLoadBalancingConfig=gl;var vy=class extends VL.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Dd.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Dd.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Dd.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function yy(){return{success:0,failure:0}}var _y=class{constructor(){this.activeBucket=yy(),this.inactiveBucket=yy()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=yy()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Sy=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===BL.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===$T.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Rd=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new LL.ChildLoadBalancerHandler((0,WT.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,jT.subchannelAddressToString)(t)),o=new vy(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Dd.ConnectivityState.READY?e.updateState(t,new Sy(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;ct("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();ct("Stats for "+d+": successes="+v+" failures="+w+" targetRequestVolume="+r),v+w>=r&&(i+=1,s.push(v/(v+w)))}if(ct("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);ct("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();if(v+w<r)continue;let A=v/(v+w);if(ct("Checking candidate "+d+" successRate="+A),A<u){let T=Math.random()*100;ct("Candidate "+d+" randomNumber="+T+" enforcement_percentage="+t.enforcement_percentage),T<t.enforcement_percentage&&(ct("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;ct("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(ct("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;ct("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(ct("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(ct("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(ct("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof gl))return;let i=new Set;for(let o of e)i.add((0,jT.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(ct("Adding map entry for "+o),this.addressMap.set(o,{counter:new _y,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(ct("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,KT.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){ct("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else ct("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{ct("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return by}};ri.OutlierDetectionLoadBalancer=Rd;function $L(){zL&&(0,WT.registerLoadBalancerType)(by,Rd,gl)}ri.setup=$L});var Cy=k(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.OutlierDetectionLoadBalancingConfig=Z.BaseSubchannelWrapper=Z.registerAdminService=Z.FilterStackFactory=Z.BaseFilter=Z.PickResultType=Z.QueuePicker=Z.UnavailablePicker=Z.ChildLoadBalancerHandler=Z.subchannelAddressToString=Z.validateLoadBalancingConfig=Z.getFirstUsableConfig=Z.registerLoadBalancerType=Z.createChildChannelControlHelper=Z.BackoffTimeout=Z.durationToMs=Z.uriToString=Z.createResolver=Z.registerResolver=Z.log=Z.trace=void 0;var HT=Ue();Object.defineProperty(Z,"trace",{enumerable:!0,get:function(){return HT.trace}});Object.defineProperty(Z,"log",{enumerable:!0,get:function(){return HT.log}});var QT=Nn();Object.defineProperty(Z,"registerResolver",{enumerable:!0,get:function(){return QT.registerResolver}});Object.defineProperty(Z,"createResolver",{enumerable:!0,get:function(){return QT.createResolver}});var WL=qt();Object.defineProperty(Z,"uriToString",{enumerable:!0,get:function(){return WL.uriToString}});var KL=py();Object.defineProperty(Z,"durationToMs",{enumerable:!0,get:function(){return KL.durationToMs}});var HL=Ba();Object.defineProperty(Z,"BackoffTimeout",{enumerable:!0,get:function(){return HL.BackoffTimeout}});var kd=Or();Object.defineProperty(Z,"createChildChannelControlHelper",{enumerable:!0,get:function(){return kd.createChildChannelControlHelper}});Object.defineProperty(Z,"registerLoadBalancerType",{enumerable:!0,get:function(){return kd.registerLoadBalancerType}});Object.defineProperty(Z,"getFirstUsableConfig",{enumerable:!0,get:function(){return kd.getFirstUsableConfig}});Object.defineProperty(Z,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return kd.validateLoadBalancingConfig}});var QL=Mn();Object.defineProperty(Z,"subchannelAddressToString",{enumerable:!0,get:function(){return QL.subchannelAddressToString}});var YL=lu();Object.defineProperty(Z,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return YL.ChildLoadBalancerHandler}});var wy=Lr();Object.defineProperty(Z,"UnavailablePicker",{enumerable:!0,get:function(){return wy.UnavailablePicker}});Object.defineProperty(Z,"QueuePicker",{enumerable:!0,get:function(){return wy.QueuePicker}});Object.defineProperty(Z,"PickResultType",{enumerable:!0,get:function(){return wy.PickResultType}});var JL=Vg();Object.defineProperty(Z,"BaseFilter",{enumerable:!0,get:function(){return JL.BaseFilter}});var XL=Fg();Object.defineProperty(Z,"FilterStackFactory",{enumerable:!0,get:function(){return XL.FilterStackFactory}});var ZL=uu();Object.defineProperty(Z,"registerAdminService",{enumerable:!0,get:function(){return ZL.registerAdminService}});var e2=gd();Object.defineProperty(Z,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return e2.BaseSubchannelWrapper}});var t2=Ey();Object.defineProperty(Z,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return t2.OutlierDetectionLoadBalancingConfig}})});var YT=k(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});xd.setup=void 0;var n2=Nn(),Ty=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function r2(){(0,n2.registerResolver)("unix",Ty)}xd.setup=r2});var tA=k(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});Md.setup=void 0;var JT=me("net"),Nd=pe(),Ay=xt(),XT=Nn(),ZT=qt(),i2=Ue(),s2="ip_resolver";function eA(n){i2.trace(Nd.LogVerbosity.DEBUG,s2,n)}var Iy="ipv4",Dy="ipv6",o2=443,Od=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,eA("Resolver constructed for target "+(0,ZT.uriToString)(e));let s=[];if(!(e.scheme===Iy||e.scheme===Dy)){this.error={code:Nd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Ay.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,ZT.splitHostPort)(a);if(l===null){this.error={code:Nd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Ay.Metadata};return}if(e.scheme===Iy&&!(0,JT.isIPv4)(l.host)||e.scheme===Dy&&!(0,JT.isIPv6)(l.host)){this.error={code:Nd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Ay.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:o2})}this.addresses=s,eA("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function a2(){(0,XT.registerResolver)(Iy,Od),(0,XT.registerResolver)(Dy,Od)}Md.setup=a2});var iA=k(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.setup=Kn.PickFirstLoadBalancer=Kn.shuffled=Kn.PickFirstLoadBalancingConfig=void 0;var nA=Or(),yt=Yt(),Pd=Lr(),l2=Ue(),c2=pe(),u2="pick_first";function Ry(n){l2.trace(c2.LogVerbosity.DEBUG,u2,n)}var yl="pick_first",d2=250,vl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return yl}toJsonObject(){return{[yl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Kn.PickFirstLoadBalancingConfig=vl;var ky=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Pd.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function rA(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Kn.shuffled=rA;var Fd=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=yt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(yt.ConnectivityState.READY,new ky(this.currentPick)):this.children.length===0?this.updateState(yt.ConnectivityState.IDLE,new Pd.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(yt.ConnectivityState.TRANSIENT_FAILURE,new Pd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(yt.ConnectivityState.CONNECTING,new Pd.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==yt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===yt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===yt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===yt.ConnectivityState.IDLE||i===yt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===yt.ConnectivityState.IDLE&&(Ry("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},d2)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Ry("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Ry(yt.ConnectivityState[this.currentState]+" -> "+yt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===yt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===yt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof vl&&(t.getShuffleAddressList()&&(e=rA(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===yt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return yl}};Kn.PickFirstLoadBalancer=Fd;function h2(){(0,nA.registerLoadBalancerType)(yl,Fd,vl),(0,nA.registerDefaultLoadBalancerType)(yl)}Kn.setup=h2});var oA=k(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.setup=_o.RoundRobinLoadBalancer=void 0;var f2=Or(),vt=Yt(),Ld=Lr(),p2=Mn(),m2=Ue(),g2=pe(),y2="round_robin";function sA(n){m2.trace(g2.LogVerbosity.DEBUG,y2,n)}var Bd="round_robin",xy=class n{getLoadBalancerName(){return Bd}constructor(){}toJsonObject(){return{[Bd]:{}}}static createFromJson(e){return new n}},Ny=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Ld.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Vd=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=vt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===vt.ConnectivityState.TRANSIENT_FAILURE||i===vt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(vt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===vt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(vt.ConnectivityState.READY,new Ny(e,t))}else this.countSubchannelsWithState(vt.ConnectivityState.CONNECTING)>0?this.updateState(vt.ConnectivityState.CONNECTING,new Ld.QueuePicker(this)):this.countSubchannelsWithState(vt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(vt.ConnectivityState.TRANSIENT_FAILURE,new Ld.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(vt.ConnectivityState.IDLE,new Ld.QueuePicker(this))}updateState(e,t){sA(vt.ConnectivityState[this.currentState]+" -> "+vt.ConnectivityState[e]),e===vt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),sA("Connect to address list "+e.map(r=>(0,p2.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===vt.ConnectivityState.IDLE||i===vt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Bd}};_o.RoundRobinLoadBalancer=Vd;function v2(){(0,f2.registerLoadBalancerType)(Bd,Vd,xy)}_o.setup=v2});var uA=k(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.experimental=W.addAdminServicesToServer=W.getChannelzHandlers=W.getChannelzServiceDefinition=W.InterceptorConfigurationError=W.InterceptingCall=W.RequesterBuilder=W.ListenerBuilder=W.StatusBuilder=W.getClientChannel=W.ServerCredentials=W.Server=W.setLogVerbosity=W.setLogger=W.load=W.loadObject=W.CallCredentials=W.ChannelCredentials=W.waitForClientReady=W.closeClient=W.Channel=W.makeGenericClientConstructor=W.makeClientConstructor=W.loadPackageDefinition=W.Client=W.compressionAlgorithms=W.propagate=W.connectivityState=W.status=W.logVerbosity=W.Metadata=W.credentials=void 0;var qd=Dp();Object.defineProperty(W,"CallCredentials",{enumerable:!0,get:function(){return qd.CallCredentials}});var _2=om();Object.defineProperty(W,"Channel",{enumerable:!0,get:function(){return _2.ChannelImplementation}});var S2=Lg();Object.defineProperty(W,"compressionAlgorithms",{enumerable:!0,get:function(){return S2.CompressionAlgorithms}});var b2=Yt();Object.defineProperty(W,"connectivityState",{enumerable:!0,get:function(){return b2.ConnectivityState}});var Ud=tu();Object.defineProperty(W,"ChannelCredentials",{enumerable:!0,get:function(){return Ud.ChannelCredentials}});var aA=sm();Object.defineProperty(W,"Client",{enumerable:!0,get:function(){return aA.Client}});var Oy=pe();Object.defineProperty(W,"logVerbosity",{enumerable:!0,get:function(){return Oy.LogVerbosity}});Object.defineProperty(W,"status",{enumerable:!0,get:function(){return Oy.Status}});Object.defineProperty(W,"propagate",{enumerable:!0,get:function(){return Oy.Propagate}});var lA=Ue(),My=lm();Object.defineProperty(W,"loadPackageDefinition",{enumerable:!0,get:function(){return My.loadPackageDefinition}});Object.defineProperty(W,"makeClientConstructor",{enumerable:!0,get:function(){return My.makeClientConstructor}});Object.defineProperty(W,"makeGenericClientConstructor",{enumerable:!0,get:function(){return My.makeClientConstructor}});var E2=xt();Object.defineProperty(W,"Metadata",{enumerable:!0,get:function(){return E2.Metadata}});var C2=zT();Object.defineProperty(W,"Server",{enumerable:!0,get:function(){return C2.Server}});var w2=uy();Object.defineProperty(W,"ServerCredentials",{enumerable:!0,get:function(){return w2.ServerCredentials}});var T2=GT();Object.defineProperty(W,"StatusBuilder",{enumerable:!0,get:function(){return T2.StatusBuilder}});W.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Ud.ChannelCredentials.createInsecure,createSsl:Ud.ChannelCredentials.createSsl,createFromSecureContext:Ud.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:qd.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:qd.CallCredentials.createFromGoogleCredential,createEmpty:qd.CallCredentials.createEmpty};var A2=n=>n.close();W.closeClient=A2;var I2=(n,e,t)=>n.waitForReady(e,t);W.waitForClientReady=I2;var D2=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.loadObject=D2;var R2=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.load=R2;var k2=n=>{lA.setLogger(n)};W.setLogger=k2;var x2=n=>{lA.setLoggerVerbosity(n)};W.setLogVerbosity=x2;var N2=n=>aA.Client.prototype.getChannel.call(n);W.getClientChannel=N2;var zd=nm();Object.defineProperty(W,"ListenerBuilder",{enumerable:!0,get:function(){return zd.ListenerBuilder}});Object.defineProperty(W,"RequesterBuilder",{enumerable:!0,get:function(){return zd.RequesterBuilder}});Object.defineProperty(W,"InterceptingCall",{enumerable:!0,get:function(){return zd.InterceptingCall}});Object.defineProperty(W,"InterceptorConfigurationError",{enumerable:!0,get:function(){return zd.InterceptorConfigurationError}});var cA=Ui();Object.defineProperty(W,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return cA.getChannelzServiceDefinition}});Object.defineProperty(W,"getChannelzHandlers",{enumerable:!0,get:function(){return cA.getChannelzHandlers}});var O2=uu();Object.defineProperty(W,"addAdminServicesToServer",{enumerable:!0,get:function(){return O2.addAdminServicesToServer}});var M2=Cy();W.experimental=M2;var P2=wg(),F2=YT(),L2=tA(),B2=iA(),V2=oA(),q2=Ey(),U2=Ui();P2.setup(),F2.setup(),L2.setup(),B2.setup(),V2.setup(),q2.setup(),U2.setup()});var vb=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-header"]],standalone:!0,features:[Ee],decls:4,vars:0,consts:[[1,"navbar","navbar-expand-lg","fixed-top","bg-white"],[1,"container","justify-content-center"],["routerLink","/",1,"site-logo"]],template:function(i,s){i&1&&(N(0,"header",0)(1,"div",1)(2,"a",2),V(3,"AberRange Innovate"),D()()())},dependencies:[Rs],styles:["header[_ngcontent-%COMP%]{height:100px}header[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:24px}"]});let n=e;return n})();var UR="firebase",zR="10.13.1";Et(UR,zR,"app");var hn=new Wf("ANGULARFIRE2_VERSION");function ep(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Oa=(n,e)=>{let t=e?[e]:Gc(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},xn=class{constructor(){return Oa(GR)}},GR="app-check";function ks(){}var jc=class{zone;delegate;constructor(e,t=U0){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Zf=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ks,{},ks,ks)),t.pipe(W0({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},sr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new jc(Zone.current)),this.insideAngular=t.run(()=>new jc(Zone.current,Tc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ie(Kt))};static \u0275prov=Vt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function $c(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function jR(n){return $c().ngZone.runOutsideAngular(()=>n())}function Oi(n){return $c().ngZone.run(()=>n())}function wt(n){return $R($c())(n)}function $R(n){return function(t){return t=t.lift(new Zf(n.ngZone)),t.pipe(Ii(n.outsideAngular),Tr(n.insideAngular))}}var WR=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Oi(()=>n.apply(void 0,r))},Ma=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=Oi(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ks,{},ks,ks))),r[s]=WR(r[s],t));let i=jR(()=>n.apply(this,r));if(!e)if(i instanceof wr){let s=$c();return i.pipe(Ii(s.outsideAngular),Tr(s.insideAngular))}else return Oi(()=>i);return i instanceof wr?i.pipe(wt):i instanceof Promise?Oi(()=>new Promise((s,o)=>i.then(a=>Oi(()=>s(a)),a=>Oi(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Oi(()=>i)};var Mi=class{constructor(e){return e}},Pa=class{constructor(){return Gc()}};function KR(n){return n&&n.length===1?n[0]:new Mi(Na())}var tp=new De("angularfire2._apps"),HR={provide:Mi,useFactory:KR,deps:[[new Rn,tp]]},QR={provide:Pa,deps:[[new Rn,tp]]};function YR(n){return(e,t)=>{let r=t.get(Ar);Et("angularfire",hn.full,"core"),Et("angularfire",hn.full,"app"),Et("angular",Fc.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new Mi(i)}}function Sb(n,...e){return kc([HR,QR,{provide:tp,useFactory:YR(n),multi:!0,deps:[Kt,wa,sr,...e]}])}var bb=Ma(yb,!0);var JR=new Map,XR={activated:!1,tokenObservers:[]},ZR={initialized:!1,enabled:!1};function fn(n){return JR.get(n)||Object.assign({},XR)}function Ab(){return ZR}var ek="https://content-firebaseappcheck.googleapis.com/v1";var tk="exchangeDebugToken",Eb={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Dj=24*60*60*1e3;var rp=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return E(this,null,function*(){this.stop();try{this.pending=new Qf,this.pending.promise.catch(t=>{}),yield nk(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Qf,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function nk(n){return new Promise(e=>{setTimeout(e,n)})}var rk={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Rr=new mb("appCheck","AppCheck",rk);function Ib(n){if(!fn(n).activated)throw Rr.create("use-before-activation",{appName:n.name})}function Db(r,i){return E(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw Rr.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw Rr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw Rr.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Rr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+d,issuedAtTimeMillis:f}})}function Rb(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${ek}/projects/${t}/apps/${r}:${tk}?key=${i}`,body:{debug_token:e}}}var ik="firebase-app-check-database",sk=1,ip="firebase-app-check-store";var Wc=null;function ok(){return Wc||(Wc=new Promise((n,e)=>{try{let t=indexedDB.open(ik,sk);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Rr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(ip,{keyPath:"compositeKey"})}}}catch(t){e(Rr.create("storage-open",{originalErrorMessage:t?.message}))}}),Wc)}function ak(n,e){return lk(ck(n),e)}function lk(n,e){return E(this,null,function*(){let r=(yield ok()).transaction(ip,"readwrite"),s=r.objectStore(ip).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Rr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function ck(n){return`${n.options.appId}-${n.name}`}var sp=new zc("@firebase/app-check");function np(n,e){return Uc()?ak(n,e).catch(t=>{sp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function kb(){return Ab().enabled}function xb(){return E(this,null,function*(){let n=Ab();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var uk={error:"UNKNOWN_ERROR"};function dk(n){return db.encodeString(JSON.stringify(n),!1)}function op(n,e=!1){return E(this,null,function*(){let t=n.app;Ib(t);let r=fn(t),i=r.token,s;if(i&&!Fa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Fa(l)?i=l:yield np(t,void 0))}if(!e&&i&&Fa(i))return{token:i.token};let o=!1;if(kb()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Db(Rb(t,yield xb()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield np(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield fn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?sp.warn(l.message):sp.error(l),s=l}let a;return i?s?Fa(i)?a={token:i.token,internalError:s}:a=wb(s):(a={token:i.token},r.token=i,yield np(t,i)):a=wb(s),o&&mk(t,a),a})}function hk(n){return E(this,null,function*(){let e=n.app;Ib(e);let{provider:t}=fn(e);if(kb()){let r=yield xb(),{token:i}=yield Db(Rb(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function fk(n,e,t,r){let{app:i}=n,s=fn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Fa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Cb(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Cb(n))}function Nb(n,e){let t=fn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Cb(n){let{app:e}=n,t=fn(e),r=t.tokenRefresher;r||(r=pk(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function pk(n){let{app:e}=n;return new rp(()=>E(this,null,function*(){let t=fn(e),r;if(t.token?r=yield op(n,!0):r=yield op(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=fn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Eb.RETRIAL_MIN_WAIT,Eb.RETRIAL_MAX_WAIT)}function mk(n,e){let t=fn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Fa(n){return n.expireTimeMillis-Date.now()>0}function wb(n){return{token:dk(uk),error:n}}var ap=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=fn(this.app);for(let t of e)Nb(this.app,t.next);return Promise.resolve()}};function gk(n,e){return new ap(n,e)}function yk(n){return{getToken:e=>op(n,e),getLimitedUseToken:()=>hk(n),addTokenListener:e=>fk(n,"INTERNAL",e),removeTokenListener:e=>Nb(n.app,e)}}var vk="@firebase/app-check",_k="0.8.7";var Sk="app-check",Tb="app-check-internal";function bk(){xa(new Ni(Sk,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return gk(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Tb).initialize()})),xa(new Ni(Tb,n=>{let e=n.getProvider("app-check").getImmediate();return yk(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Et(vk,_k)}bk();var Ek=["localhost","0.0.0.0","127.0.0.1"],qj=typeof window<"u"&&Ek.includes(window.location.hostname);var Ck="firebase",wk="10.13.1";Ct.registerVersion(Ck,wk,"app-compat");var Ak=["ngOnDestroy"],Pb=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(Ak.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var Kc=class{constructor(e){return e}},xs=new De("angularfire2.app.options"),Ns=new De("angularfire2.app.name");function La(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ct.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ct.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Ik("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Kc(o)}var Ik=(n,...e)=>{Kf()&&typeof console<"u"&&console[n](...e)},Dk={provide:Kc,useFactory:La,deps:[xs,Kt,[new Rn,Ns]]},lp=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:xs,useValue:t},{provide:Ns,useValue:r}]}}constructor(t){Ct.registerVersion("angularfire",hn.full,"core"),Ct.registerVersion("angularfire",hn.full,"app-compat"),Ct.registerVersion("angular",Fc.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ie(Ar))};static \u0275mod=ki({type:n});static \u0275inj=Ri({providers:[Dk]})}return n})();function Hc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Rk(i,o)||(Mb("error",`${e} was already initialized on the ${t} Firebase App with different settings.${kk?" You may need to reload as Firebase is not HMR aware.":""}`),Mb("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Rk(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var kk=typeof module<"u"&&!!module.hot,Mb=(n,...e)=>{Kf()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var cp=new De("angularfire2.auth.use-emulator"),up=new De("angularfire2.auth.settings"),dp=new De("angularfire2.auth.tenant-id"),hp=new De("angularfire2.auth.langugage-code"),fp=new De("angularfire2.auth.use-device-language"),pp=new De("angularfire.auth.persistence"),mp=(n,e,t,r,i,s,o,a)=>Hc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Fb=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,f,v){let w=new wc,A=Bt(void 0).pipe(Tr(o.outsideAngular),Di(()=>s.runOutsideAngular(()=>import("./chunk-DZ4NDRKB.mjs"))),Ne(()=>La(t,s,r)),Ne(T=>mp(T,s,a,c,u,d,l,f)),qf({bufferSize:1,refCount:!1}));if(Vc(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Bt(null);else{A.pipe($0()).subscribe();let T=A.pipe(Di(L=>L.getRedirectResult().then(B=>B,()=>null)),wt,qf({bufferSize:1,refCount:!1})),F=A.pipe(Di(L=>new wr(B=>({unsubscribe:s.runOutsideAngular(()=>L.onAuthStateChanged($=>B.next($),$=>B.error($),()=>B.complete()))})))),R=A.pipe(Di(L=>new wr(B=>({unsubscribe:s.runOutsideAngular(()=>L.onIdTokenChanged($=>B.next($),$=>B.error($),()=>B.complete()))}))));this.authState=T.pipe(Uf(F),Ii(o.outsideAngular),Tr(o.insideAngular)),this.user=T.pipe(Uf(R),Ii(o.outsideAngular),Tr(o.insideAngular)),this.idToken=this.user.pipe(Di(L=>L?Dn(L.getIdToken()):Bt(null))),this.idTokenResult=this.user.pipe(Di(L=>L?Dn(L.getIdTokenResult()):Bt(null))),this.credential=G0(T,w,this.authState.pipe(Ea(L=>!L))).pipe(Ne(L=>L?.user?L:null),Ii(o.outsideAngular),Tr(o.insideAngular))}return Pb(this,A,s,{spy:{apply:(T,F,R)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&R.then(L=>w.next(L))}}})}static \u0275fac=function(r){return new(r||n)(ie(xs),ie(Ns,8),ie(Ar),ie(Kt),ie(sr),ie(cp,8),ie(up,8),ie(dp,8),ie(hp,8),ie(fp,8),ie(pp,8),ie(xn,8))};static \u0275prov=Vt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as z2,TextEncoder as G2,TextDecoder as j2}from"util";import{randomBytes as $2}from"crypto";var Lb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bb={};var kr,gp;(function(){var n;function e(S,g){function y(){}y.prototype=g.prototype,S.D=g.prototype,S.prototype=new y,S.prototype.constructor=S,S.C=function(_,p,b){for(var h=Array(arguments.length-2),m=2;m<arguments.length;m++)h[m-2]=arguments[m];return g.prototype[p].apply(_,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,g,y){y||(y=0);var _=Array(16);if(typeof g=="string")for(var p=0;16>p;++p)_[p]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(p=0;16>p;++p)_[p]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=S.g[0],y=S.g[1],p=S.g[2];var b=S.g[3],h=g+(b^y&(p^b))+_[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=b+(p^g&(y^p))+_[1]+3905402710&4294967295,b=g+(h<<12&4294967295|h>>>20),h=p+(y^b&(g^y))+_[2]+606105819&4294967295,p=b+(h<<17&4294967295|h>>>15),h=y+(g^p&(b^g))+_[3]+3250441966&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(b^y&(p^b))+_[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(p^g&(y^p))+_[5]+1200080426&4294967295,b=g+(h<<12&4294967295|h>>>20),h=p+(y^b&(g^y))+_[6]+2821735955&4294967295,p=b+(h<<17&4294967295|h>>>15),h=y+(g^p&(b^g))+_[7]+4249261313&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(b^y&(p^b))+_[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(p^g&(y^p))+_[9]+2336552879&4294967295,b=g+(h<<12&4294967295|h>>>20),h=p+(y^b&(g^y))+_[10]+4294925233&4294967295,p=b+(h<<17&4294967295|h>>>15),h=y+(g^p&(b^g))+_[11]+2304563134&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(b^y&(p^b))+_[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(p^g&(y^p))+_[13]+4254626195&4294967295,b=g+(h<<12&4294967295|h>>>20),h=p+(y^b&(g^y))+_[14]+2792965006&4294967295,p=b+(h<<17&4294967295|h>>>15),h=y+(g^p&(b^g))+_[15]+1236535329&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(p^b&(y^p))+_[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^p&(g^y))+_[6]+3225465664&4294967295,b=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(b^g))+_[11]+643717713&4294967295,p=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(p^b))+_[0]+3921069994&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^b&(y^p))+_[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^p&(g^y))+_[10]+38016083&4294967295,b=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(b^g))+_[15]+3634488961&4294967295,p=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(p^b))+_[4]+3889429448&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^b&(y^p))+_[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^p&(g^y))+_[14]+3275163606&4294967295,b=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(b^g))+_[3]+4107603335&4294967295,p=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(p^b))+_[8]+1163531501&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^b&(y^p))+_[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^p&(g^y))+_[2]+4243563512&4294967295,b=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(b^g))+_[7]+1735328473&4294967295,p=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(p^b))+_[12]+2368359562&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(y^p^b)+_[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^p)+_[8]+2272392833&4294967295,b=g+(h<<11&4294967295|h>>>21),h=p+(b^g^y)+_[11]+1839030562&4294967295,p=b+(h<<16&4294967295|h>>>16),h=y+(p^b^g)+_[14]+4259657740&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^b)+_[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^p)+_[4]+1272893353&4294967295,b=g+(h<<11&4294967295|h>>>21),h=p+(b^g^y)+_[7]+4139469664&4294967295,p=b+(h<<16&4294967295|h>>>16),h=y+(p^b^g)+_[10]+3200236656&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^b)+_[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^p)+_[0]+3936430074&4294967295,b=g+(h<<11&4294967295|h>>>21),h=p+(b^g^y)+_[3]+3572445317&4294967295,p=b+(h<<16&4294967295|h>>>16),h=y+(p^b^g)+_[6]+76029189&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^b)+_[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^p)+_[12]+3873151461&4294967295,b=g+(h<<11&4294967295|h>>>21),h=p+(b^g^y)+_[15]+530742520&4294967295,p=b+(h<<16&4294967295|h>>>16),h=y+(p^b^g)+_[2]+3299628645&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(p^(y|~b))+_[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~p))+_[7]+1126891415&4294967295,b=g+(h<<10&4294967295|h>>>22),h=p+(g^(b|~y))+_[14]+2878612391&4294967295,p=b+(h<<15&4294967295|h>>>17),h=y+(b^(p|~g))+_[5]+4237533241&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~b))+_[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~p))+_[3]+2399980690&4294967295,b=g+(h<<10&4294967295|h>>>22),h=p+(g^(b|~y))+_[10]+4293915773&4294967295,p=b+(h<<15&4294967295|h>>>17),h=y+(b^(p|~g))+_[1]+2240044497&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~b))+_[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~p))+_[15]+4264355552&4294967295,b=g+(h<<10&4294967295|h>>>22),h=p+(g^(b|~y))+_[6]+2734768916&4294967295,p=b+(h<<15&4294967295|h>>>17),h=y+(b^(p|~g))+_[13]+1309151649&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~b))+_[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~p))+_[11]+3174756917&4294967295,b=g+(h<<10&4294967295|h>>>22),h=p+(g^(b|~y))+_[2]+718787259&4294967295,p=b+(h<<15&4294967295|h>>>17),h=y+(b^(p|~g))+_[9]+3951481745&4294967295,S.g[0]=S.g[0]+g&4294967295,S.g[1]=S.g[1]+(p+(h<<21&4294967295|h>>>11))&4294967295,S.g[2]=S.g[2]+p&4294967295,S.g[3]=S.g[3]+b&4294967295}r.prototype.u=function(S,g){g===void 0&&(g=S.length);for(var y=g-this.blockSize,_=this.B,p=this.h,b=0;b<g;){if(p==0)for(;b<=y;)i(this,S,b),b+=this.blockSize;if(typeof S=="string"){for(;b<g;)if(_[p++]=S.charCodeAt(b++),p==this.blockSize){i(this,_),p=0;break}}else for(;b<g;)if(_[p++]=S[b++],p==this.blockSize){i(this,_),p=0;break}}this.h=p,this.o+=g},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var g=1;g<S.length-8;++g)S[g]=0;var y=8*this.o;for(g=S.length-8;g<S.length;++g)S[g]=y&255,y/=256;for(this.u(S),S=Array(16),g=y=0;4>g;++g)for(var _=0;32>_;_+=8)S[y++]=this.g[g]>>>_&255;return S};function s(S,g){var y=a;return Object.prototype.hasOwnProperty.call(y,S)?y[S]:y[S]=g(S)}function o(S,g){this.h=g;for(var y=[],_=!0,p=S.length-1;0<=p;p--){var b=S[p]|0;_&&b==g||(y[p]=b,_=!1)}this.g=y}var a={};function l(S){return-128<=S&&128>S?s(S,function(g){return new o([g|0],0>g?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return d;if(0>S)return T(c(-S));for(var g=[],y=1,_=0;S>=y;_++)g[_]=S/y|0,y*=4294967296;return new o(g,0)}function u(S,g){if(S.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(S.charAt(0)=="-")return T(u(S.substring(1),g));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),_=d,p=0;p<S.length;p+=8){var b=Math.min(8,S.length-p),h=parseInt(S.substring(p,p+b),g);8>b?(b=c(Math.pow(g,b)),_=_.j(b).add(c(h))):(_=_.j(y),_=_.add(c(h)))}return _}var d=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-T(this).m();for(var S=0,g=1,y=0;y<this.g.length;y++){var _=this.i(y);S+=(0<=_?_:4294967296+_)*g,g*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(w(this))return"0";if(A(this))return"-"+T(this).toString(S);for(var g=c(Math.pow(S,6)),y=this,_="";;){var p=B(y,g).g;y=F(y,p.j(g));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(S);if(y=p,w(y))return b+_;for(;6>b.length;)b="0"+b;_=b+_}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function w(S){if(S.h!=0)return!1;for(var g=0;g<S.g.length;g++)if(S.g[g]!=0)return!1;return!0}function A(S){return S.h==-1}n.l=function(S){return S=F(this,S),A(S)?-1:w(S)?0:1};function T(S){for(var g=S.g.length,y=[],_=0;_<g;_++)y[_]=~S.g[_];return new o(y,~S.h).add(f)}n.abs=function(){return A(this)?T(this):this},n.add=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0,p=0;p<=g;p++){var b=_+(this.i(p)&65535)+(S.i(p)&65535),h=(b>>>16)+(this.i(p)>>>16)+(S.i(p)>>>16);_=h>>>16,b&=65535,h&=65535,y[p]=h<<16|b}return new o(y,y[y.length-1]&-2147483648?-1:0)};function F(S,g){return S.add(T(g))}n.j=function(S){if(w(this)||w(S))return d;if(A(this))return A(S)?T(this).j(T(S)):T(T(this).j(S));if(A(S))return T(this.j(T(S)));if(0>this.l(v)&&0>S.l(v))return c(this.m()*S.m());for(var g=this.g.length+S.g.length,y=[],_=0;_<2*g;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var p=0;p<S.g.length;p++){var b=this.i(_)>>>16,h=this.i(_)&65535,m=S.i(p)>>>16,G=S.i(p)&65535;y[2*_+2*p]+=h*G,R(y,2*_+2*p),y[2*_+2*p+1]+=b*G,R(y,2*_+2*p+1),y[2*_+2*p+1]+=h*m,R(y,2*_+2*p+1),y[2*_+2*p+2]+=b*m,R(y,2*_+2*p+2)}for(_=0;_<g;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=g;_<2*g;_++)y[_]=0;return new o(y,0)};function R(S,g){for(;(S[g]&65535)!=S[g];)S[g+1]+=S[g]>>>16,S[g]&=65535,g++}function L(S,g){this.g=S,this.h=g}function B(S,g){if(w(g))throw Error("division by zero");if(w(S))return new L(d,d);if(A(S))return g=B(T(S),g),new L(T(g.g),T(g.h));if(A(g))return g=B(S,T(g)),new L(T(g.g),g.h);if(30<S.g.length){if(A(S)||A(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,_=g;0>=_.l(S);)y=$(y),_=$(_);var p=X(y,1),b=X(_,1);for(_=X(_,2),y=X(y,2);!w(_);){var h=b.add(_);0>=h.l(S)&&(p=p.add(y),b=h),_=X(_,1),y=X(y,1)}return g=F(S,p.j(g)),new L(p,g)}for(p=d;0<=S.l(g);){for(y=Math.max(1,Math.floor(S.m()/g.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),b=c(y),h=b.j(g);A(h)||0<h.l(S);)y-=_,b=c(y),h=b.j(g);w(b)&&(b=f),p=p.add(b),S=F(S,h)}return new L(p,S)}n.A=function(S){return B(this,S).h},n.and=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)&S.i(_);return new o(y,this.h&S.h)},n.or=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)|S.i(_);return new o(y,this.h|S.h)},n.xor=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)^S.i(_);return new o(y,this.h^S.h)};function $(S){for(var g=S.g.length+1,y=[],_=0;_<g;_++)y[_]=S.i(_)<<1|S.i(_-1)>>>31;return new o(y,S.h)}function X(S,g){var y=g>>5;g%=32;for(var _=S.g.length-y,p=[],b=0;b<_;b++)p[b]=0<g?S.i(b+y)>>>g|S.i(b+y+1)<<32-g:S.i(b+y);return new o(p,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,gp=Bb.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,kr=Bb.Integer=o}).apply(typeof Lb<"u"?Lb:typeof self<"u"?self:typeof window<"u"?window:{});var es=Bf(uA(),1),SI=Bf(dg(),1);var dA="@firebase/firestore",hA="4.7.1";var nt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};nt.UNAUTHENTICATED=new nt(null);nt.GOOGLE_CREDENTIALS=new nt("google-credentials-uid");nt.FIRST_PARTY=new nt("first-party-uid");nt.MOCK_USER=new nt("mock-user");var W2="10.13.1";var ea=W2;function K2(n){ea=n}function H2(n){return z2(n,{depth:100})}var di=new zc("@firebase/firestore");function Io(){return di.logLevel}function K_(n){di.setLogLevel(n)}function P(n,...e){if(di.logLevel<=kn.DEBUG){let t=e.map(H_);di.debug(`Firestore (${ea}): ${n}`,...t)}}function Be(n,...e){if(di.logLevel<=kn.ERROR){let t=e.map(H_);di.error(`Firestore (${ea}): ${n}`,...t)}}function ln(n,...e){if(di.logLevel<=kn.WARN){let t=e.map(H_);di.warn(`Firestore (${ea}): ${n}`,...t)}}function H_(n){if(typeof n=="string")return n;try{return H2(n)}catch{return n}}function j(n="Unexpected state"){let e=`FIRESTORE (${ea}) INTERNAL ASSERTION FAILED: `+n;throw Be(e),new Error(e)}function H(n,e){n||j()}function bI(n,e){n||j()}function z(n,e){return n}var I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends pb{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ke=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Zd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},$y=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nt.UNAUTHENTICATED))}shutdown(){}},Wy=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ky=class{constructor(e){this.authProvider=e,this.currentUser=nt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Ke;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Ke,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>E(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{P("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(P("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ke)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(P("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H(typeof r.accessToken=="string"),new Zd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string"),new nt(e)}},Hy=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=nt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Qy=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Hy(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(nt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Yy=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Jy=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&P("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,P("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{P("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):P("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Yy(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function Q2(n){if(!n)return new $y;switch(n.type){case"firstParty":return new Qy(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function Y2(n){return $2(n)}var eh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=Y2(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ee(n,e){return n<e?-1:n>e?1:0}function ts(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function EI(n){return n+"\0"}var fA=-62135596800,pA=1e6,Ve=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<fA)throw new x(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*pA);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/pA}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-fA,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var Y=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ve(0,0))}static max(){return new n(new Ve(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var mA="__name__",th=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&j(),r===void 0?r=e.length-t:r>e.length-t&&j(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},le=class n extends th{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(I.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},J2=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Qe=class n extends th{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return J2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mA}static keyField(){return new n([mA])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new x(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new x(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new x(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(le.fromString(e))}static fromName(e){return new n(le.fromString(e).popFirst(5))}static empty(){return new n(le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&le.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return le.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new le(e.slice()))}};var Fo=-1,X2=0,Xy=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function Q_(n){return n.fields.find(e=>e.kind===2)}function ns(n){return n.fields.filter(e=>e.kind!==2)}function Z2(n){let e=ns(n);return e.length===0?0:e[e.length-1].kind}function eB(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Oo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var xl=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(X2,cn.min())}};function CI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Y.fromTimestamp(r===1e9?new Ve(t+1,0):new Ve(t,r));return new cn(i,U.empty(),e)}function wI(n){return new cn(n.readTime,n.key,Fo)}var cn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Y.min(),U.empty(),Fo)}static max(){return new n(Y.max(),U.empty(),Fo)}};function Y_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=U.comparator(n.documentKey,e.documentKey),t!==0)?t:ee(n.largestBatchId,e.largestBatchId)}var TI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ei(n){return E(this,null,function*(){if(n.code===I.FAILED_PRECONDITION&&n.message===TI)P("LocalStore","Unexpectedly lost primary lease");else throw n})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Gt="SimpleDb",tB=3,rh=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new Ke,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Zi(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=J_(r.target.error);this.completionDeferred.reject(new Zi(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Zi(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(P(Gt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new ev(t)}},hi=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(ka())===12.2&&Be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return P(Gt,"Removing database:",e),Wi(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Uc())return!1;if(n.isMockPersistence())return!0;let e=ka(),t=n.getIOSVersion(e),r=0<t&&t<10,i=AI(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return E(this,null,function*(){return this.db||(P(Gt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Zi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new x(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new x(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Zi(e,o))},i.onupgradeneeded=s=>{P(Gt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{P(Gt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return E(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=rh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),C.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<tB;if(P(Gt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function AI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Zy=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Wi(this.dbCursor.delete())}},Zi=class extends x{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ci(n){return n.name==="IndexedDbTransactionError"}var ev=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(P(Gt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(P(Gt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Wi(r)}add(e){P(Gt,"ADD",this.store.name,e,e);let t=this.store.add(e);return Wi(t)}get(e){let t=this.store.get(e);return Wi(t).next(r=>(r===void 0&&(r=null),P(Gt,"GET",this.store.name,e,r),r))}delete(e){P(Gt,"DELETE",this.store.name,e);let t=this.store.delete(e);return Wi(t)}count(){P(Gt,"COUNT",this.store.name);let e=this.store.count();return Wi(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new C((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new C((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){P(Gt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new C((r,i)=>{t.onerror=s=>{let o=J_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new C((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Zy(a),c=t(a.primaryKey,a.value,l);if(c instanceof C){let u=c.catch(d=>(l.done(),C.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>C.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Wi(n){return new C((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=J_(r.target.error);t(i)}})}var gA=!1;function J_(n){let e=hi.getIOSVersion(ka());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gA||(gA=!0,setTimeout(()=>{throw r},0)),r}}return n}var Tl="IndexBackfiller",nB=15*1e3,rB=60*1e3,iB=50,tv=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(nB)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){P(Tl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>E(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();P(Tl,`Documents written: ${t}`)}catch(t){Ci(t)?P(Tl,"Ignoring IndexedDB error during index backfill: ",t):yield Ei(t)}yield this.schedule(rB)}))}},nv=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return E(this,arguments,function*(e=iB){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return C.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return P(Tl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(P(Tl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=wI(s);Y_(o,r)>0&&(r=o)}),new cn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var jt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Mo="",rv="",II="",DI="";function Dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yA(e)),e=sB(n.get(t),e);return yA(e)}function sB(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Mo+II;break;case Mo:t+=Mo+DI;break;default:t+=s}}return t}function yA(n){return n+Mo+rv}function Qn(n){let e=n.length;if(H(e>=2),e===2)return H(n.charAt(0)===Mo&&n.charAt(1)===rv),le.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Mo,s);switch((o<0||o>t)&&j(),n.charAt(o+1)){case rv:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case II:i+=n.substring(s,o),i+="\0";break;case DI:i+=n.substring(s,o+1);break;default:j()}s=o+2}return new le(r)}var Ki="remoteDocuments";var rc="owner",So="owner",ic="mutationQueues",oB="userId",En="mutations",RI="batchId",Ji="userMutationsIndex",kI=["userId","batchId"];function aB(n){return[n]}function Kd(n,e){return[n,Dt(e)]}function xI(n,e,t){return[n,Dt(e),t]}var lB={},ta="documentMutations",$h="remoteDocumentsV14",cB=["prefixPath","collectionGroup","readTime","documentId"],Hd="documentKeyIndex",uB=["prefixPath","collectionGroup","documentId"],NI="collectionGroupIndex",dB=["collectionGroup","readTime","prefixPath","documentId"],sc="remoteDocumentGlobal",iv="remoteDocumentGlobalKey",na="targets",hB="targetId",OI="queryTargetsIndex",fB=["canonicalId","targetId"],ra="targetDocuments",pB=["targetId","path"],X_="documentTargetsIndex",mB=["path","targetId"],ih="targetGlobalKey",ms="targetGlobal",Nl="collectionParents",gB=["collectionId","parent"],Lo="clientMetadata",yB="clientId",Wh="bundles",vB="bundleId",Kh="namedQueries",_B="name",Z_="indexConfiguration",SB="indexId",sv="collectionGroupIndex",bB="collectionGroup",Hh="indexState",EB=["indexId","uid"],MI="sequenceNumberIndex",CB=["uid","sequenceNumber"],Qh="indexEntries",wB=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],PI="documentKeyIndex",TB=["indexId","uid","orderedDocumentKey"],Yh="documentOverlays",AB=["userId","collectionPath","documentId"],ov="collectionPathOverlayIndex",IB=["userId","collectionPath","largestBatchId"],FI="collectionGroupOverlayIndex",DB=["userId","collectionGroup","largestBatchId"],eS="globals",RB="name",kB=[ic,En,ta,Ki,na,rc,ms,ra],xB=kB,NB=[...xB,Lo],OB=[...NB,sc],MB=[...OB,Nl],LI=[...MB,Wh,Kh],PB=[...LI,Yh],BI=[ic,En,ta,$h,na,rc,ms,ra,Lo,sc,Nl,Wh,Kh,Yh],VI=BI,tS=[...VI,Z_,Hh,Qh],FB=tS,LB=[...tS,eS];function BB(n){if(n===17)return LB;if(n===16)return FB;if(n===15)return tS;if(n===14)return VI;if(n===13)return BI;if(n===12)return PB;if(n===11)return LI;j()}var Ol=class extends nh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function st(n,e){let t=z(n);return hi.getStore(t.simpleDbTransaction,e)}function vA(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function gs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qI(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ke=class n{constructor(e,t){this.comparator=e,this.root=t||Al.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Al.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Al.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xo(this.root,e,this.comparator,!1)}getReverseIterator(){return new xo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xo(this.root,e,this.comparator,!0)}},xo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Al=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let t=this.left.check();if(t!==this.right.check())throw j();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),av=class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Al(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Al.EMPTY=new av;var Ce=class n{constructor(e){this.comparator=e,this.data=new ke(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sh(this.data.getIterator())}getIteratorFrom(e){return new sh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},sh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function VB(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=bo(s),l=bo(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=bo(o)):u?(i(a),a=bo(s)):(a=bo(s),l=bo(o))}}function bo(n){return n.hasNext()?n.getNext():void 0}var $t=class n{constructor(e){this.fields=e,e.sort(Qe.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ce(Qe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ts(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function qB(n){return Buffer.from(n,"base64").toString("binary")}function UB(n){return Buffer.from(n,"binary").toString("base64")}function UI(){return!0}var Ye=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=qB(e);return new n(t)}static fromUint8Array(e){let t=zB(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return UB(this.binaryString)}toUint8Array(){return GB(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ye.EMPTY_BYTE_STRING=new Ye("");function zB(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function GB(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var jB=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gr(n){if(H(!!n),typeof n=="string"){let e=0,t=jB.exec(n);if(H(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Me(n.seconds),t=Me(n.nanos);return{seconds:e,nanos:t}}}function Me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fi(n){return typeof n=="string"?Ye.fromBase64String(n):Ye.fromUint8Array(n)}var zI="server_timestamp",GI="__type__",jI="__previous_value__",$I="__local_write_time__";function Jh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[GI])===null||t===void 0?void 0:t.stringValue)===zI}function $B(n,e){let t={fields:{[GI]:{stringValue:zI},[$I]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Jh(e)&&(e=nS(e)),e&&(t.fields[jI]=e),{mapValue:t}}function nS(n){let e=n.mapValue.fields[jI];return Jh(e)?nS(e):e}function Ml(n){let e=gr(n.mapValue.fields[$I].timestampValue);return new Ve(e.seconds,e.nanos)}var lv=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},cv="(default)",pi=class n{constructor(e,t){this.projectId=e,this.database=t||cv}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===cv}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function WB(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new x(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pi(n.options.projectId,e)}var ui=-1;function oc(n){return n==null}function Pl(n){return n===0&&1/n===-1/0}function WI(n){return typeof n=="number"&&Number.isInteger(n)&&!Pl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var rS="__type__",KI="__max__",li={mapValue:{fields:{__type__:{stringValue:KI}}}},iS="__vector__",Bo="value",Qd={nullValue:"NULL_VALUE"};function rs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jh(n)?4:QI(n)?9007199254740991:Xh(n)?10:11:j()}function Cn(n,e){if(n===e)return!0;let t=rs(n),r=rs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ml(n).isEqual(Ml(e));case 3:return KB(n,e);case 5:return n.stringValue===e.stringValue;case 6:return QB(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return HB(n,e);case 2:return YB(n,e);case 9:return ts(n.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:case 11:return JB(n,e);case 9007199254740991:return!0;default:return j()}}function KB(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=gr(n.timestampValue),r=gr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function HB(n,e){return Me(n.geoPointValue.latitude)===Me(e.geoPointValue.latitude)&&Me(n.geoPointValue.longitude)===Me(e.geoPointValue.longitude)}function QB(n,e){return fi(n.bytesValue).isEqual(fi(e.bytesValue))}function YB(n,e){if("integerValue"in n&&"integerValue"in e)return Me(n.integerValue)===Me(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Me(n.doubleValue),r=Me(e.doubleValue);return t===r?Pl(t)===Pl(r):isNaN(t)&&isNaN(r)}return!1}function JB(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(vA(t)!==vA(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Cn(t[i],r[i])))return!1;return!0}function Fl(n,e){return(n.values||[]).find(t=>Cn(t,e))!==void 0}function mi(n,e){if(n===e)return 0;let t=rs(n),r=rs(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return XB(n,e);case 3:return _A(n.timestampValue,e.timestampValue);case 4:return _A(Ml(n),Ml(e));case 5:return ee(n.stringValue,e.stringValue);case 6:return tV(n.bytesValue,e.bytesValue);case 7:return ZB(n.referenceValue,e.referenceValue);case 8:return eV(n.geoPointValue,e.geoPointValue);case 9:return HI(n.arrayValue,e.arrayValue);case 10:return nV(n.mapValue,e.mapValue);case 11:return rV(n.mapValue,e.mapValue);default:throw j()}}function XB(n,e){let t=Me(n.integerValue||n.doubleValue),r=Me(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function _A(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ee(n,e);let t=gr(n),r=gr(e),i=ee(t.seconds,r.seconds);return i!==0?i:ee(t.nanos,r.nanos)}function ZB(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ee(t[i],r[i]);if(s!==0)return s}return ee(t.length,r.length)}function eV(n,e){let t=ee(Me(n.latitude),Me(e.latitude));return t!==0?t:ee(Me(n.longitude),Me(e.longitude))}function tV(n,e){let t=fi(n),r=fi(e);return t.compareTo(r)}function HI(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=mi(t[i],r[i]);if(s)return s}return ee(t.length,r.length)}function nV(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Bo])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Bo])===null||r===void 0?void 0:r.arrayValue,u=ee(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:HI(l,c)}function rV(n,e){if(n===li.mapValue&&e===li.mapValue)return 0;if(n===li.mapValue)return 1;if(e===li.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ee(r[o],s[o]);if(a!==0)return a;let l=mi(t[r[o]],i[s[o]]);if(l!==0)return l}return ee(r.length,s.length)}function Vo(n){return sS(n)}function sS(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?sV(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?iV(n.bytesValue):"referenceValue"in n?aV(n.referenceValue):"geoPointValue"in n?oV(n.geoPointValue):"arrayValue"in n?cV(n.arrayValue):"mapValue"in n?lV(n.mapValue):j()}function iV(n){return fi(n).toBase64()}function sV(n){let e=gr(n);return`time(${e.seconds},${e.nanos})`}function oV(n){return`geo(${n.latitude},${n.longitude})`}function aV(n){return U.fromName(n).toString()}function lV(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${sS(n.fields[i])}`;return t+"}"}function cV(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=sS(r);return e+"]"}function is(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function uv(n){return!!n&&"integerValue"in n}function uV(n){return!!n&&"doubleValue"in n}function dV(n){return uv(n)||uV(n)}function Ll(n){return!!n&&"arrayValue"in n}function SA(n){return!!n&&"nullValue"in n}function bA(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yd(n){return!!n&&"mapValue"in n}function Xh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[rS])===null||t===void 0?void 0:t.stringValue)===iS}function Il(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return gs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Il(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Il(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function QI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===KI}var YI={mapValue:{fields:{[rS]:{stringValue:iS},[Bo]:{arrayValue:{}}}}};function hV(n){return"nullValue"in n?Qd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?is(pi.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Xh(n)?YI:{mapValue:{}}:j()}function fV(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?is(pi.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?YI:"mapValue"in n?Xh(n)?{mapValue:{}}:li:j()}function EA(n,e){let t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function CA(n,e){let t=mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var _t=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Il(t)}setAll(e){let t=Qe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Il(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Yd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Yd(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){gs(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Il(this.value))}};function JI(n){let e=[];return gs(n.fields,(t,r)=>{let i=new Qe([t]);if(Yd(r)){let o=JI(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new $t(e)}var tt=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Y.min(),Y.min(),Y.min(),_t.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Y.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Y.min(),Y.min(),_t.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Y.min(),Y.min(),_t.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Y.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function pV(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?mi(r,i):j()}var Zn=class{constructor(e,t){this.position=e,this.inclusive=t}};function XI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=U.comparator(U.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=mi(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function mV(n,e,t){let r=XI(n,e,t);return n.inclusive?r>=0:r>0}function gV(n,e,t){let r=XI(n,e,t);return n.inclusive?r<=0:r<0}function wA(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Cn(r,i))return!1}return!0}var ss=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function yV(n){return n.field.canonicalString()+n.dir}function vV(n){return`${n.field.canonicalString()} (${n.dir})`}function _V(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var oh=class{},oe=class n extends oh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new fv(e,t,r):t==="array-contains"?new gv(e,r):t==="in"?new ah(e,r):t==="not-in"?new yv(e,r):t==="array-contains-any"?new vv(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new pv(e,r):new mv(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(mi(t,this.value)):t!==null&&rs(this.value)===rs(t)&&this.matchesComparison(mi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},_e=class n extends oh{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return qo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function qo(n){return n.op==="and"}function dv(n){return n.op==="or"}function oS(n){return ZI(n)&&qo(n)}function ZI(n){for(let e of n.filters)if(e instanceof _e)return!1;return!0}function hv(n){if(n instanceof oe)return n.field.canonicalString()+n.op.toString()+Vo(n.value);if(oS(n))return n.filters.map(e=>hv(e)).join(",");{let e=n.filters.map(t=>hv(t)).join(",");return`${n.op}(${e})`}}function eD(n,e){if(n instanceof oe)return SV(n,e);if(n instanceof _e)return bV(n,e);j()}function SV(n,e){return e instanceof oe&&n.op===e.op&&n.field.isEqual(e.field)&&Cn(n.value,e.value)}function bV(n,e){return e instanceof _e&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&eD(i,e.filters[s]),!0):!1}function tD(n,e){let t=n.filters.concat(e);return _e.create(t,n.op)}function nD(n){return n instanceof oe?CV(n):n instanceof _e?EV(n):"Filter"}function EV(n){return n.op.toString()+" {"+n.getFilters().map(nD).join(" ,")+"}"}function CV(n){return`${n.field.canonicalString()} ${n.op} ${Vo(n.value)}`}var fv=class extends oe{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},pv=class extends oe{constructor(e,t){super(e,"in",t),this.keys=rD("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},mv=class extends oe{constructor(e,t){super(e,"not-in",t),this.keys=rD("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function rD(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var gv=class extends oe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ll(t)&&Fl(t.arrayValue,this.value)}},ah=class extends oe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Fl(this.value.arrayValue,t)}},yv=class extends oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Fl(this.value.arrayValue,t)}},vv=class extends oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Ll(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Fl(this.value.arrayValue,r))}};var _v=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Sv(n,e=null,t=[],r=[],i=null,s=null,o=null){return new _v(n,e,t,r,i,s,o)}function os(n){let e=z(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>hv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>yV(r)).join(","),oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Vo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Vo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function wV(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>nD(t)).join(", ")}]`),oc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>vV(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Vo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Vo(t)).join(",")),`Target(${e})`}function ac(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!_V(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!eD(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!wA(n.startAt,e.startAt)?!1:wA(n.endAt,e.endAt)}function lh(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Zh(n,e){return n.filters.filter(t=>t instanceof oe&&t.field.isEqual(e))}function TV(n,e){let t=Q_(e);if(t===void 0)return null;for(let r of Zh(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function AV(n,e){let t=new Map;for(let r of ns(e))for(let i of Zh(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function IV(n,e){let t=[],r=!0;for(let i of ns(e)){let s=i.kind===0?iD(n,i.fieldPath,n.startAt):sD(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function DV(n,e){let t=[],r=!0;for(let i of ns(e)){let s=i.kind===0?sD(n,i.fieldPath,n.endAt):iD(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function iD(n,e,t){let r=Qd,i=!0;for(let s of Zh(n,e)){let o=Qd,a=!0;switch(s.op){case"<":case"<=":o=hV(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Qd;break}EA({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];EA({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function sD(n,e,t){let r=li,i=!0;for(let s of Zh(n,e)){let o=li,a=!0;switch(s.op){case">=":case">":o=fV(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=li;break}CA({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];CA({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function RV(n){let e=new Ce(Qe.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function kV(n){return n.limit!==null}var wn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function oD(n,e,t,r,i,s,o,a){return new wn(n,e,t,r,i,s,o,a)}function ia(n){return new wn(n)}function xV(n,e){return new wn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function TA(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function NV(n){let e=new Ce(Qe.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function OV(n){return new wn(le.emptyPath(),n)}function MV(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function aS(n){return n.collectionGroup!==null}function Uo(n){let e=z(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";NV(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new ss(s,r))}),t.has(Qe.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new ss(Qe.keyField(),r))}return e.memoizedNormalizedOrderBy}function Rt(n){let e=z(n);return e.memoizedTarget||(e.memoizedTarget=PV(e,Uo(n))),e.memoizedTarget}function PV(n,e){if(n.limitType==="F")return Sv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ss(i.field,s)});let t=n.endAt?new Zn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zn(n.startAt.position,n.startAt.inclusive):null;return Sv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function lS(n,e){let t=n.filters.concat([e]);return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function FV(n,e){let t=n.explicitOrderBy.concat([e]);return new wn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ch(n,e,t){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function LV(n,e){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function BV(n,e){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function lc(n,e){return ac(Rt(n),Rt(e))&&n.limitType===e.limitType}function aD(n){return`${os(Rt(n))}|lt:${n.limitType}`}function Do(n){return`Query(target=${wV(Rt(n))}; limitType=${n.limitType})`}function cc(n,e){return e.isFoundDocument()&&VV(n,e)&&qV(n,e)&&UV(n,e)&&zV(n,e)}function VV(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):U.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function qV(n,e){for(let t of Uo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function UV(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function zV(n,e){return!(n.startAt&&!gV(n.startAt,Uo(n),e)||n.endAt&&!mV(n.endAt,Uo(n),e))}function lD(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function cD(n){return(e,t)=>{let r=!1;for(let i of Uo(n)){let s=GV(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function GV(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):pV(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return j()}}var er=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){gs(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return qI(this.inner)}size(){return this.innerSize}};var jV=new ke(U.comparator);function Pt(){return jV}var uD=new ke(U.comparator);function Cl(...n){let e=uD;for(let t of n)e=e.insert(t.key,t);return e}function $V(){return Bl()}function dD(n){let e=uD;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Yn(){return Bl()}function hD(){return Bl()}function Bl(){return new er(n=>n.toString(),(n,e)=>n.isEqual(e))}var WV=new ke(U.comparator);function KV(){return WV}var HV=new Ce(U.comparator);function ne(...n){let e=HV;for(let t of n)e=e.add(t);return e}var QV=new Ce(ee);function cS(){return QV}function uS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pl(e)?"-0":e}}function fD(n){return{integerValue:""+n}}function pD(n,e){return WI(e)?fD(e):uS(n,e)}var zo=class{constructor(){this._=void 0}};function YV(n,e,t){return n instanceof gi?$B(t,e):n instanceof yr?gD(n,e):n instanceof vr?yD(n,e):ZV(n,e)}function JV(n,e,t){return n instanceof yr?gD(n,e):n instanceof vr?yD(n,e):t}function mD(n,e){return n instanceof yi?dV(e)?e:{integerValue:0}:null}function XV(n,e){return n instanceof yr&&e instanceof yr||n instanceof vr&&e instanceof vr?ts(n.elements,e.elements,Cn):n instanceof yi&&e instanceof yi?Cn(n.operand,e.operand):n instanceof gi&&e instanceof gi}var gi=class extends zo{},yr=class extends zo{constructor(e){super(),this.elements=e}};function gD(n,e){let t=vD(e);for(let r of n.elements)t.some(i=>Cn(i,r))||t.push(r);return{arrayValue:{values:t}}}var vr=class extends zo{constructor(e){super(),this.elements=e}};function yD(n,e){let t=vD(e);for(let r of n.elements)t=t.filter(i=>!Cn(i,r));return{arrayValue:{values:t}}}var yi=class extends zo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function ZV(n,e){let t=mD(n,e),r=AA(t)+AA(n.operand);return uv(t)&&uv(n.operand)?fD(r):uS(n.serializer,r)}function AA(n){return Me(n.integerValue||n.doubleValue)}function vD(n){return Ll(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var as=class{constructor(e,t){this.field=e,this.transform=t}};function eq(n,e){return n.field.isEqual(e.field)&&XV(n.transform,e.transform)}function tq(n,e){return n===void 0&&e===void 0?!0:n&&e?ts(n,e,(t,r)=>eq(t,r)):!1}var bv=class{constructor(e,t){this.version=e,this.transformResults=t}},ze=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ef(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Go=class{};function _D(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new _i(n.key,ze.none()):new vi(n.key,n.data,ze.none());{let t=n.data,r=_t.empty(),i=new Ce(Qe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Tn(n.key,r,new $t(i.toArray()),ze.none())}}function nq(n,e,t){n instanceof vi?iq(n,e,t):n instanceof Tn?oq(n,e,t):lq(n,e,t)}function Dl(n,e,t,r){return n instanceof vi?sq(n,e,t,r):n instanceof Tn?aq(n,e,t,r):cq(n,e,t)}function rq(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=mD(r.transform,i||null);s!=null&&(t===null&&(t=_t.empty()),t.set(r.field,s))}return t||null}function IA(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!tq(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var vi=class extends Go{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function iq(n,e,t){let r=n.value.clone(),i=bD(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function sq(n,e,t,r){if(!ef(n.precondition,e))return t;let i=n.value.clone(),s=ED(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Tn=class extends Go{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function oq(n,e,t){if(!ef(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=bD(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(SD(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function aq(n,e,t,r){if(!ef(n.precondition,e))return t;let i=ED(n.fieldTransforms,r,e),s=e.data;return s.setAll(SD(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function SD(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function bD(n,e,t){let r=new Map;H(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,JV(o,a,t[i]))}return r}function ED(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,YV(s,o,e))}return r}var _i=class extends Go{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function lq(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function cq(n,e,t){return ef(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Vl=class extends Go{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ql=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];nq(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Dl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=hD();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=_D(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Y.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ne())}isEqual(e){return this.batchId===e.batchId&&ts(this.mutations,e.mutations,(t,r)=>IA(t,r))&&ts(this.baseMutations,e.baseMutations,(t,r)=>IA(t,r))}},Ev=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length);let i=KV(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Ul=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Cv=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ut=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(ut||{});function CD(n){switch(n){case I.OK:return j();case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0;default:return j()}}function uq(n){return CD(n)&&n!==I.ABORTED}function Jd(n){if(n===void 0)return Be("GRPC error has no .code"),I.UNKNOWN;switch(n){case ut.OK:return I.OK;case ut.CANCELLED:return I.CANCELLED;case ut.UNKNOWN:return I.UNKNOWN;case ut.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case ut.INTERNAL:return I.INTERNAL;case ut.UNAVAILABLE:return I.UNAVAILABLE;case ut.UNAUTHENTICATED:return I.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case ut.NOT_FOUND:return I.NOT_FOUND;case ut.ALREADY_EXISTS:return I.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return I.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case ut.ABORTED:return I.ABORTED;case ut.OUT_OF_RANGE:return I.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return I.UNIMPLEMENTED;case ut.DATA_LOSS:return I.DATA_LOSS;default:return j()}}var wv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Py=null;function wD(){return new G2}function dq(){return new j2("utf-8")}var hq=new kr([4294967295,4294967295],0);function DA(n){let e=wD().encode(n),t=new gp;return t.update(e),new Uint8Array(t.digest())}function RA(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new kr([t,r],0),a=new kr([i,s],0);return[o,a]}var Tv=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Xi(`Invalid padding: ${t}`);if(r<0)throw new Xi(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Xi(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Xi(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=kr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(kr.fromNumber(r)));return i.compare(hq)===1&&(i=new kr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=DA(e),[r,i]=RA(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=DA(e),[r,i]=RA(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Xi=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var zl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Gl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Y.min(),i,new ke(ee),Pt(),ne())}},Gl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ne(),ne(),ne())}};var Po=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},uh=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},dh=class{constructor(e,t,r=Ye.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},hh=class{constructor(){this.pendingResponses=0,this.documentChanges=xA(),this._resumeToken=Ye.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ne(),t=ne(),r=ne();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:j()}}),new Gl(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=xA()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,H(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},fq="WatchChangeAggregator",Av=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Pt(),this.pendingDocumentTargetMapping=kA(),this.pendingTargetResets=new ke(ee)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(lh(s))if(r===0){let o=new U(s.path);this.removeDocumentFromTarget(t,o,tt.newNoDocument(o,Y.min()))}else H(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Py?.notifyOnExistenceFilterMismatch(pq(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=fi(r).toUint8Array()}catch(l){if(l instanceof wv)return ln("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new Tv(o,i,s)}catch(l){return l instanceof Xi?ln("BloomFilter error: ",l):ln("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&lh(a.target)){let l=new U(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,tt.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ne();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new zl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Pt(),this.pendingDocumentTargetMapping=kA(),this.pendingTargetResets=new ke(ee),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new hh,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Ce(ee),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||P(fq,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new hh),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function kA(){return new ke(U.comparator)}function xA(){return new ke(U.comparator)}function pq(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var w;return(w=r?.mightContain(v))!==null&&w!==void 0?w:!1}}),d}var mq=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),gq=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),yq=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Iv=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function vq(n){let e=n.code===void 0?I.UNKNOWN:Jd(n.code);return new x(e,n.message||"")}function Dv(n,e){return n.useProto3Json||oc(e)?e:{value:e}}function _q(n){let e;return typeof n=="object"?e=n.value:e=n,oc(e)?null:e}function jo(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function Sq(n){let e=gr(n);return new Ve(e.seconds,e.nanos)}function TD(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function bq(n,e){return n.useProto3Json?(H(e===void 0||typeof e=="string"),Ye.fromBase64String(e||"")):(H(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Ye.fromUint8Array(e||new Uint8Array))}function Eq(n,e){return jo(n,e.toTimestamp())}function He(n){return H(!!n),Y.fromTimestamp(Sq(n))}function dS(n,e){return Rv(n,e).canonicalString()}function Rv(n,e){let t=Cq(n).child("documents");return e===void 0?t:t.child(e)}function AD(n){let e=le.fromString(n);return H(FD(e)),e}function jl(n,e){return dS(n.databaseId,e.path)}function Jn(n,e){let t=AD(e);if(t.get(1)!==n.databaseId.projectId)throw new x(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(RD(t))}function ID(n,e){return dS(n.databaseId,e)}function DD(n){let e=AD(n);return e.length===4?le.emptyPath():RD(e)}function kv(n){return new le(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cq(n){return new le(["projects",n.projectId,"databases",n.database])}function RD(n){return H(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function NA(n,e,t){return{name:jl(n,e),fields:t.value.mapValue.fields}}function wq(n,e){return{name:jl(n,e.key),fields:e.data.value.mapValue.fields,updateTime:jo(n,e.version.toTimestamp()),createTime:jo(n,e.createTime.toTimestamp())}}function kD(n,e,t){let r=Jn(n,e.name),i=He(e.updateTime),s=e.createTime?He(e.createTime):Y.min(),o=new _t({mapValue:{fields:e.fields}}),a=tt.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Tq(n,e){H(!!e.found),e.found.name,e.found.updateTime;let t=Jn(n,e.found.name),r=He(e.found.updateTime),i=e.found.createTime?He(e.found.createTime):Y.min(),s=new _t({mapValue:{fields:e.found.fields}});return tt.newFoundDocument(t,r,i,s)}function Aq(n,e){H(!!e.missing),H(!!e.readTime);let t=Jn(n,e.missing),r=He(e.readTime);return tt.newNoDocument(t,r)}function Iq(n,e){return"found"in e?Tq(n,e):"missing"in e?Aq(n,e):j()}function Dq(n,e){let t;if("targetChange"in e){e.targetChange;let r=Rq(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=bq(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&vq(o);t=new dh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Jn(n,r.document.name),s=He(r.document.updateTime),o=r.document.createTime?He(r.document.createTime):Y.min(),a=new _t({mapValue:{fields:r.document.fields}}),l=tt.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Po(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Jn(n,r.document),s=r.readTime?He(r.readTime):Y.min(),o=tt.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Po([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Jn(n,r.document),s=r.removedTargetIds||[];t=new Po([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Cv(i,s),a=r.targetId;t=new uh(a,o)}else return j();return t}function Rq(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:j()}function kq(n){if(!("targetChange"in n))return Y.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Y.min():He(e.readTime)}function $l(n,e){let t;if(e instanceof vi)t={update:NA(n,e.key,e.value)};else if(e instanceof _i)t={delete:jl(n,e.key)};else if(e instanceof Tn)t={update:NA(n,e.key,e.data),updateMask:cU(e.fieldMask)};else if(e instanceof Vl)t={verify:jl(n,e.key)};else return j();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>Pq(n,r))),e.precondition.isNone||(t.currentDocument=xq(n,e.precondition)),t}function xv(n,e){let t=e.currentDocument?Nq(e.currentDocument):ze.none(),r=e.updateTransforms?e.updateTransforms.map(i=>Fq(n,i)):[];if(e.update){e.update.name;let i=Jn(n,e.update.name),s=new _t({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=uU(e.updateMask);return new Tn(i,s,o,t,r)}else return new vi(i,s,t,r)}else if(e.delete){let i=Jn(n,e.delete);return new _i(i,t)}else if(e.verify){let i=Jn(n,e.verify);return new Vl(i,t)}else return j()}function xq(n,e){return e.updateTime!==void 0?{updateTime:Eq(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:j()}function Nq(n){return n.updateTime!==void 0?ze.updateTime(He(n.updateTime)):n.exists!==void 0?ze.exists(n.exists):ze.none()}function Oq(n,e){let t=n.updateTime?He(n.updateTime):He(e);return t.isEqual(Y.min())&&(t=He(e)),new bv(t,n.transformResults||[])}function Mq(n,e){return n&&n.length>0?(H(e!==void 0),n.map(t=>Oq(t,e))):[]}function Pq(n,e){let t=e.transform;if(t instanceof gi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof yr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof vr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof yi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw j()}function Fq(n,e){let t=null;if("setToServerValue"in e)H(e.setToServerValue==="REQUEST_TIME"),t=new gi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new yr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new vr(i)}else"increment"in e?t=new yi(n,e.increment):j();let r=Qe.fromServerFormat(e.fieldPath);return new as(r,t)}function xD(n,e){return{documents:[ID(n,e.path)]}}function Lq(n){let e=n.documents.length;H(e===1);let t=n.documents[0];return Rt(ia(DD(t)))}function ND(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ID(n,i);let s=zq(e.filters);s&&(t.structuredQuery.where=s);let o=jq(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Dv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=Wq(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Kq(e.endAt)),{queryTarget:t,parent:i}}function OD(n){let e=DD(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){H(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=Gq(t.where));let o=[];t.orderBy&&(o=$q(t.orderBy));let a=null;t.limit&&(a=_q(t.limit));let l=null;t.startAt&&(l=Hq(t.startAt));let c=null;return t.endAt&&(c=Qq(t.endAt)),oD(e,i,o,s,a,"F",l,c)}function Bq(n){return Rt(OD(n))}function Vq(n,e){let t=qq(e.purpose);return t==null?null:{"goog-listen-tags":t}}function qq(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}function Uq(n,e){let t,r=e.target;if(lh(r)?t={documents:xD(n,r)}:t={query:ND(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=TD(n,e.resumeToken);let i=Dv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(Y.min())>0){t.readTime=jo(n,e.snapshotVersion.toTimestamp());let i=Dv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function zq(n){if(n.length!==0)return PD(_e.create(n,"and"))}function Gq(n){let e=MD(n);return e instanceof _e&&oS(e)?e.getFilters():[e]}function MD(n){return n.unaryFilter!==void 0?oU(n):n.fieldFilter!==void 0?aU(n):n.compositeFilter!==void 0?lU(n):j()}function jq(n){if(n.length!==0)return n.map(e=>nU(e))}function $q(n){return n.map(e=>rU(e))}function Wq(n){return{before:n.inclusive,values:n.position}}function Kq(n){return{before:!n.inclusive,values:n.position}}function Hq(n){let e=!!n.before,t=n.values||[];return new Zn(t,e)}function Qq(n){let e=!n.before,t=n.values||[];return new Zn(t,e)}function Yq(n){return mq[n]}function Jq(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Xq(n){return gq[n]}function Zq(n){return yq[n]}function eU(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return j();default:return j()}}function tU(n){switch(n){case"AND":return"and";case"OR":return"or";default:return j()}}function Ro(n){return{fieldPath:n.canonicalString()}}function No(n){return Qe.fromServerFormat(n.fieldPath)}function nU(n){return{field:Ro(n.field),direction:Yq(n.dir)}}function rU(n){return new ss(No(n.field),Jq(n.direction))}function PD(n){return n instanceof oe?sU(n):n instanceof _e?iU(n):j()}function iU(n){let e=n.getFilters().map(t=>PD(t));return e.length===1?e[0]:{compositeFilter:{op:Zq(n.op),filters:e}}}function sU(n){if(n.op==="=="){if(bA(n.value))return{unaryFilter:{field:Ro(n.field),op:"IS_NAN"}};if(SA(n.value))return{unaryFilter:{field:Ro(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(bA(n.value))return{unaryFilter:{field:Ro(n.field),op:"IS_NOT_NAN"}};if(SA(n.value))return{unaryFilter:{field:Ro(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ro(n.field),op:Xq(n.op),value:n.value}}}function oU(n){switch(n.unaryFilter.op){case"IS_NAN":let e=No(n.unaryFilter.field);return oe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=No(n.unaryFilter.field);return oe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=No(n.unaryFilter.field);return oe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=No(n.unaryFilter.field);return oe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return j();default:return j()}}function aU(n){return oe.create(No(n.fieldFilter.field),eU(n.fieldFilter.op),n.fieldFilter.value)}function lU(n){return _e.create(n.compositeFilter.filters.map(e=>MD(e)),tU(n.compositeFilter.op))}function cU(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function uU(n){let e=n.fieldPaths||[];return new $t(e.map(t=>Qe.fromServerFormat(t)))}function FD(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var $o=class n{constructor(e,t,r,i,s=Y.min(),o=Y.min(),a=Ye.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var fh=class{constructor(e){this.remoteSerializer=e}};function dU(n,e){let t;if(e.document)t=kD(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=cs(e.noDocument.readTime);t=tt.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=U.fromSegments(e.unknownDocument.path),i=cs(e.unknownDocument.version);t=tt.newUnknownDocument(r,i)}else return j();return e.readTime&&t.setReadTime(hU(e.readTime)),t}function OA(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:tf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=wq(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ls(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:ls(e.version)};else return j();return r}function tf(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function hU(n){let e=new Ve(n[0],n[1]);return Y.fromTimestamp(e)}function ls(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function cs(n){let e=new Ve(n.seconds,n.nanoseconds);return Y.fromTimestamp(e)}function fU(n,e,t){let r=t.baseMutations.map(s=>$l(n.remoteSerializer,s)),i=t.mutations.map(s=>$l(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Hi(n,e){let t=(e.baseMutations||[]).map(s=>xv(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>xv(n.remoteSerializer,s)),i=Ve.fromMillis(e.localWriteTimeMs);return new ql(e.batchId,i,t,r)}function wl(n){let e=cs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?cs(n.lastLimboFreeSnapshotVersion):Y.min(),r;return pU(n.query)?r=Lq(n.query):r=Bq(n.query),new $o(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ye.fromBase64String(n.resumeToken))}function LD(n,e){let t=ls(e.snapshotVersion),r=ls(e.lastLimboFreeSnapshotVersion),i;lh(e.target)?i=xD(n.remoteSerializer,e.target):i=ND(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:os(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function pU(n){return n.documents!==void 0}function mU(n){return{id:n.bundleId,createTime:cs(n.createTime),version:n.version}}function gU(n){return{bundleId:n.id,createTime:ls(He(n.createTime)),version:n.version}}function yU(n){return{name:n.name,query:hS(n.bundledQuery),readTime:cs(n.readTime)}}function vU(n){return{name:n.name,readTime:ls(He(n.readTime)),bundledQuery:n.bundledQuery}}function hS(n){let e=OD({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ch(e,e.limit,"L"):e}function _U(n){return{name:n.name,query:hS(n.bundledQuery),readTime:He(n.readTime)}}function SU(n){return{id:n.id,version:n.version,createTime:He(n.createTime)}}function Fy(n,e){return new Ul(e.largestBatchId,xv(n.remoteSerializer,e.overlayMutation))}function bU(n,e,t){let[r,i,s]=BD(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:$l(n.remoteSerializer,t.mutation)}}function BD(n,e){let t=e.path.lastSegment(),r=Dt(e.path.popLast());return[n,r,t]}function EU(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function CU(n,e){let t=e?new xl(e.sequenceNumber,new cn(cs(e.readTime),new U(Qn(e.documentKey)),e.largestBatchId)):xl.empty(),r=n.fields.map(([i,s])=>new Oo(Qe.fromServerFormat(i),s));return new Xy(n.indexId,n.collectionGroup,r,t)}function MA(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ls(r.readTime),documentKey:Dt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Nv=class{getBundleMetadata(e,t){return PA(e).get(t).next(r=>{if(r)return mU(r)})}saveBundleMetadata(e,t){return PA(e).put(gU(t))}getNamedQuery(e,t){return FA(e).get(t).next(r=>{if(r)return yU(r)})}saveNamedQuery(e,t){return FA(e).put(vU(t))}};function PA(n){return st(n,Wh)}function FA(n){return st(n,Kh)}var ph=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return _l(e).get(BD(this.userId,t)).next(r=>r?Fy(this.serializer,r):null)}getOverlays(e,t){let r=Yn();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Ul(t,o);i.push(this.saveOverlay(e,a))}),C.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Dt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(_l(e).deleteAll(ov,a))}),C.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Yn(),s=Dt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return _l(e).loadAll(ov,o).next(a=>{for(let l of a){let c=Fy(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Yn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return _l(e).iterate({index:FI,range:a},(l,c,u)=>{let d=Fy(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return _l(e).put(bU(this.serializer,this.userId,t))}};function _l(n){return st(n,Yh)}var Ov=class{globalsStore(e){return st(e,eS)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?Ye.fromUint8Array(i):Ye.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var wU=5,TU=10,AU=13,Ly=15,IU=20,DU=25,RU=30,kU=37,xU=45,NU=50,OU=53,MU=55,PU=60,FU=2,mr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,wU);else if("booleanValue"in e)this.writeValueTypeLabel(t,TU),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Ly),t.writeNumber(Me(e.integerValue));else if("doubleValue"in e){let r=Me(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,AU):(this.writeValueTypeLabel(t,Ly),Pl(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,IU),typeof r=="string"&&(r=gr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,RU),t.writeBytes(fi(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,xU),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?QI(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):Xh(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):j()}writeIndexString(e,t){this.writeValueTypeLabel(t,DU),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,MU);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,OU);let o=Bo,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,Ly),t.writeNumber(Me(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,NU);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,kU),U.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,PU),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(FU)}};mr.INSTANCE=new mr;var LA="\uD800",BA="\uDBFF",Eo=0,VA=255,qA=1,Co=255,UA=255,zA=0,LU=64,BU=8,VU=1024;function qU(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function UU(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function zU(n){let e=0;for(let t=0;t<8;++t){let r=UU(n[t]&255);if(e+=r,r!==8)break}return e}function GA(n){let e=LU-zU(n);return Math.ceil(e/BU)}var Mv=class{constructor(){this.buffer=new Uint8Array(VU),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<LA||BA<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<LA||BA<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=GA(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=GA(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Co),this.writeEscapedByteAscending(UA)}writeInfinityDescending(){this.writeEscapedByteDescending(Co),this.writeEscapedByteDescending(UA)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=qU(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Eo?(this.writeEscapedByteAscending(Eo),this.writeEscapedByteAscending(VA)):t===Co?(this.writeEscapedByteAscending(Co),this.writeEscapedByteAscending(zA)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Eo?(this.writeEscapedByteDescending(Eo),this.writeEscapedByteDescending(VA)):t===Co?(this.writeEscapedByteDescending(Co),this.writeEscapedByteDescending(zA)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Eo),this.writeEscapedByteAscending(qA)}writeSeparatorDescending(){this.writeEscapedByteDescending(Eo),this.writeEscapedByteDescending(qA)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Pv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Fv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Qi=class{constructor(){this.orderedCode=new Mv,this.ascending=new Pv(this.orderedCode),this.descending=new Fv(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Yi=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ii(n,e){let t=n.indexId-e.indexId;return t!==0||(t=jA(n.arrayValue,e.arrayValue),t!==0)||(t=jA(n.directionalValue,e.directionalValue),t!==0)?t:U.comparator(n.documentKey,e.documentKey)}function jA(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var mh=class{constructor(e){this.inequalityFilters=new Ce((t,r)=>Qe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(H(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=Q_(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=ns(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Ce(Qe.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Oo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Oo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Oo(r.field,r.dir==="asc"?0:1)));return new Xy(Xy.UNKNOWN_ID,this.collectionId,t,xl.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function VD(n){var e,t;if(H(n instanceof oe||n instanceof _e),n instanceof oe)if(n instanceof ah){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>oe.create(n.field,"==",s)))||[];return _e.create(i,"or")}else return n;let r=n.filters.map(i=>VD(i));return _e.create(r,n.op)}function GU(n){if(n.getFilters().length===0)return[];let e=Lv(VD(n));return H(qD(e)),fS(e)||pS(e)?[e]:e.getFilters()}function fS(n){return n instanceof oe}function pS(n){return n instanceof _e&&oS(n)}function qD(n){return fS(n)||pS(n)||jU(n)}function jU(n){if(n instanceof _e&&dv(n)){for(let e of n.getFilters())if(!fS(e)&&!pS(e))return!1;return!0}return!1}function Lv(n){if(H(n instanceof oe||n instanceof _e),n instanceof oe)return n;if(n.filters.length===1)return Lv(n.filters[0]);let e=n.filters.map(r=>Lv(r)),t=_e.create(e,n.op);return t=gh(t),qD(t)?t:(H(t instanceof _e),H(qo(t)),H(t.filters.length>1),t.filters.reduce((r,i)=>mS(r,i)))}function mS(n,e){H(n instanceof oe||n instanceof _e),H(e instanceof oe||e instanceof _e);let t;return n instanceof oe?e instanceof oe?t=$U(n,e):t=$A(n,e):e instanceof oe?t=$A(e,n):t=WU(n,e),gh(t)}function $U(n,e){return _e.create([n,e],"and")}function WU(n,e){if(H(n.filters.length>0&&e.filters.length>0),qo(n)&&qo(e))return tD(n,e.getFilters());let t=dv(n)?n:e,r=dv(n)?e:n,i=t.filters.map(s=>mS(s,r));return _e.create(i,"or")}function $A(n,e){if(qo(e))return tD(e,n.getFilters());{let t=e.filters.map(r=>mS(n,r));return _e.create(t,"or")}}function gh(n){if(H(n instanceof oe||n instanceof _e),n instanceof oe)return n;let e=n.getFilters();if(e.length===1)return gh(e[0]);if(ZI(n))return n;let t=e.map(i=>gh(i)),r=[];return t.forEach(i=>{i instanceof oe?r.push(i):i instanceof _e&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:_e.create(r,n.op)}var Bv=class{constructor(){this.collectionParentIndex=new Wl}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(cn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(cn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Wl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ce(le.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ce(le.comparator)).toArray()}};var WA="IndexedDbIndexManager",Gd=new Uint8Array(0),Vv=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Wl,this.targetToDnfSubTargets=new er(r=>os(r),(r,i)=>ac(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Dt(i)};return KA(e).put(s)}return C.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[EI(t),""],!1,!0);return KA(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Qn(o.parent))}return r})}addFieldIndex(e,t){let r=Sl(e),i=EU(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=To(e);return s.next(a=>{o.put(MA(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Sl(e),i=To(e),s=wo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Sl(e),r=wo(e),i=To(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return C.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new mh(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=wo(e),i=!0,s=new Map;return C.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ne(),a=[];return C.forEach(s,(l,c)=>{P(WA,`Using index ${eB(l)} to execute ${os(t)}`);let u=TV(c,l),d=AV(c,l),f=IV(c,l),v=DV(c,l),w=this.encodeBound(l,c,f),A=this.encodeBound(l,c,v),T=this.encodeValues(l,c,d),F=this.generateIndexRanges(l.indexId,u,w,f.inclusive,A,v.inclusive,T);return C.forEach(F,R=>r.loadFirst(R,t.limit).next(L=>{L.forEach(B=>{let $=U.fromSegments(B.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}else return C.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=GU(_e.create(e.filters,"and")).map(i=>Sv(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):Gd,v=this.generateLowerBound(e,f,r[d%c],i),w=this.generateUpperBound(e,f,s[d%c],o),A=a.map(T=>this.generateLowerBound(e,f,T,!0));u.push(...this.createRange(v,w,A))}return u}generateLowerBound(e,t,r,i){let s=new Yi(e,U.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Yi(e,U.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new mh(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return C.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<RV(s)&&(r=1):r=0})).next(()=>kV(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Qi;for(let i of ns(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);mr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Qi;return mr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Qi;return mr.INSTANCE.writeIndexValue(is(this.databaseId,t),r.forKind(Z2(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Qi);let s=0;for(let o of ns(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Ll(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);mr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Qi;l.seed(a.encodedBytes()),mr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof oe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Sl(e),i=To(e);return(t?r.loadAll(sv,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return C.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(CU(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ee(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Sl(e),s=To(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(sv,IDBKeyRange.bound(t,t)).next(a=>C.forEach(a,l=>s.put(MA(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return C.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?C.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),C.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?C.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return wo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return wo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=wo(e),s=new Ce(ii);return i.iterate({index:PI,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Yi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Ce(ii),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=Q_(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ll(o))for(let a of o.arrayValue.values||[])r=r.add(new Yi(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Yi(t.indexId,e.key,Gd,i));return r}updateEntries(e,t,r,i,s){P(WA,"Updating index entries for document '%s'",t.key);let o=[];return VB(i,s,ii,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),C.waitFor(o)}getNextSequenceNumber(e){let t=1;return To(e).iterate({index:MI,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ii(o,a)).filter((o,a,l)=>!a||ii(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=ii(o,e),l=ii(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Gd,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Gd,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return ii(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(HA)}getMinOffset(e,t){return C.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||j())).next(HA)}};function KA(n){return st(n,Nl)}function wo(n){return st(n,Qh)}function Sl(n){return st(n,Z_)}function To(n){return st(n,Hh)}function HA(n){H(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Y_(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new cn(e.readTime,e.documentKey,t)}function UD(n,e,t){let r=n.store(En),i=n.store(ta),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,f)=>(a++,f.delete()));s.push(l.next(()=>{H(a===1)}));let c=[];for(let u of t.mutations){let d=xI(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return C.waitFor(s).next(()=>c)}function yh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw j();return JSON.stringify(e).length}var vh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){H(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return si(e).iterate({index:Ji,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ko(e),o=si(e);return o.add({}).next(a=>{H(typeof a=="number");let l=new ql(a,t,r,i),c=fU(this.serializer,this.userId,l),u=[],d=new Ce((f,v)=>ee(f.canonicalString(),v.canonicalString()));for(let f of i){let v=xI(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,lB))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),C.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return si(e).get(t).next(r=>r?(H(r.userId===this.userId),Hi(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?C.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return si(e).iterate({index:Ji,range:i},(o,a,l)=>{a.userId===this.userId&&(H(a.batchId>=r),s=Hi(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=ui;return si(e).iterate({index:Ji,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ui],[this.userId,Number.POSITIVE_INFINITY]);return si(e).loadAll(Ji,t).next(r=>r.map(i=>Hi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Kd(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ko(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,f=Qn(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return si(e).get(d).next(v=>{if(!v)throw j();H(v.userId===this.userId),s.push(Hi(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ee),i=[];return t.forEach(s=>{let o=Kd(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=ko(e).iterate({range:a},(c,u,d)=>{let[f,v,w]=c,A=Qn(v);if(f!==this.userId||!s.path.isEqual(A)){d.done();return}r=r.add(w)});i.push(l)}),C.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Kd(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ce(ee);return ko(e).iterate({range:o},(l,c,u)=>{let[d,f,v]=l,w=Qn(f);if(d!==this.userId||!r.isPrefixOf(w)){u.done();return}w.length===i&&(a=a.add(v))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(si(e).get(s).next(o=>{if(o===null)throw j();H(o.userId===this.userId),r.push(Hi(this.serializer,o))}))}),C.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return UD(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),C.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();let r=IDBKeyRange.lowerBound(aB(this.userId)),i=[];return ko(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=Qn(s[1]);i.push(c)}}).next(()=>{H(i.length===0)})})}containsKey(e,t){return zD(e,this.userId,t)}getMutationQueueMetadata(e){return GD(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ui,lastStreamToken:""})}};function zD(n,e,t){let r=Kd(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ko(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,f]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function KU(n,e){let t=!1;return GD(n).iterateSerial(r=>zD(n,r,e).next(i=>(i&&(t=!0),C.resolve(!i)))).next(()=>t)}function si(n){return st(n,En)}function ko(n){return st(n,ta)}function GD(n){return st(n,ic)}var By=2,Wo=class n{constructor(e){this.lastId=e}next(){return this.lastId+=By,this.lastId}static forTargetCache(){return new n(2-By)}static forSyncEngine(){return new n(1-By)}};var qv=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new Wo(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Y.fromTimestamp(new Ve(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ao(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(H(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ao(e).iterate((o,a)=>{let l=wl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>C.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ao(e).iterate((r,i)=>{let s=wl(i);t(s)})}retrieveMetadata(e){return QA(e).get(ih).next(t=>(H(t!==null),t))}saveMetadata(e,t){return QA(e).put(ih,t)}saveTargetData(e,t){return Ao(e).put(LD(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=os(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ao(e).iterate({range:i,index:OI},(o,a,l)=>{let c=wl(a);ac(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ai(e);return t.forEach(o=>{let a=Dt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),C.waitFor(i)}removeMatchingKeys(e,t,r){let i=ai(e);return C.forEach(t,s=>{let o=Dt(s.path);return C.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ai(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ai(e),s=ne();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=Qn(o[1]),u=new U(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Dt(t.path),i=IDBKeyRange.bound([r],[EI(r)],!1,!0),s=0;return ai(e).iterate({index:X_,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Ao(e).get(t).next(r=>r?wl(r):null)}};function Ao(n){return st(n,na)}function QA(n){return st(n,ms)}function ai(n){return st(n,ra)}var YA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},uc=-1,jD=40*1024*1024,an=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};an.DEFAULT_COLLECTION_PERCENTILE=10;an.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;an.DEFAULT=new an(jD,an.DEFAULT_COLLECTION_PERCENTILE,an.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);an.DISABLED=new an(uc,0,0);var JA="LruGarbageCollector",XA=1*1024*1024,HU=1*60*1e3,QU=5*60*1e3;function ZA([n,e],[t,r]){let i=ee(n,t);return i===0?ee(e,r):i}var Uv=class{constructor(e){this.maxElements=e,this.buffer=new Ce(ZA),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();ZA(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},zv=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==uc&&this.scheduleGC(HU)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){P(JA,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>E(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ci(t)?P(JA,"Ignoring IndexedDB error during garbage collection: ",t):yield Ei(t)}yield this.scheduleGC(QU)}))}},Gv=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(jt.INVALID);let r=new Uv(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===uc?(P("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(YA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),YA):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(P("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Io()<=kn.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;P("LruGarbageCollector",f)}return C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function YU(n,e){return new Gv(n,e)}var jv=class{constructor(e,t){this.db=e,this.garbageCollector=YU(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return jd(e,r)}removeReference(e,t,r){return jd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return jd(e,t)}isPinned(e,t){return KU(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,Y.min()),ai(e).delete(JU(l))))});s.push(u)}}).next(()=>C.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return jd(e,t)}forEachOrphanedDocument(e,t){let r=ai(e),i=jt.INVALID,s;return r.iterate({index:X_},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==jt.INVALID&&t(new U(Qn(s)),i),i=c,s=l):i=jt.INVALID}).next(()=>{i!==jt.INVALID&&t(new U(Qn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function JU(n){return[0,Dt(n.path)]}function XU(n,e){return{targetId:0,path:Dt(n.path),sequenceNumber:e}}function jd(n,e){return ai(n).put(XU(e,n.currentSequenceNumber))}var _h=class{constructor(){this.changes=new er(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var $v=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return $i(e).put(r)}removeEntry(e,t,r){return $i(e).delete(ZU(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=tt.newInvalidDocument(t);return $i(e).iterate({index:Hd,range:IDBKeyRange.only(bl(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:tt.newInvalidDocument(t)};return $i(e).iterate({index:Hd,range:IDBKeyRange.only(bl(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:yh(s)}}).next(()=>r)}getEntries(e,t){let r=Pt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Pt(),i=new ke(U.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,yh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return C.resolve();let i=new Ce(nI);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(bl(i.first()),bl(i.last())),o=i.getIterator(),a=o.getNext();return $i(e).iterate({index:Hd,range:s},(l,c,u)=>{let d=U.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&nI(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(bl(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),tf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $i(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Pt();for(let d of c){let f=this.maybeDecodeDocument(U.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(cc(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Pt(),o=tI(t,r),a=tI(t,cn.max());return $i(e).iterate({index:NI,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(U.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Wv(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return eI(e).get(iv).next(t=>(H(!!t),t))}setMetadata(e,t){return eI(e).put(iv,t)}maybeDecodeDocument(e,t){if(t){let r=dU(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Y.min())))return r}return tt.newInvalidDocument(e)}};function $D(n){return new $v(n)}var Wv=class extends _h{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new er(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ce((s,o)=>ee(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=OA(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=yh(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=OA(this.documentCache.serializer,o.convertToNoDocument(Y.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),C.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function eI(n){return st(n,sc)}function $i(n){return st(n,$h)}function bl(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ZU(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],tf(e),t[t.length-1]]}function tI(n,e){let t=e.documentKey.path.toArray();return[n,tf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function nI(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ee(t[s],r[s]),i)return i;return i=ee(t.length,r.length),i||(i=ee(t[t.length-2],r[r.length-2]),i)?i:ee(t[t.length-1],r[r.length-1])}var e3=17;var Kv=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Sh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Dl(r.mutation,i,$t.empty(),Ve.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ne()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ne()){let i=Yn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Cl();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Yn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ne()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Pt(),o=Bl(),a=$V();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Tn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Dl(u.mutation,c,u.mutation.getFieldMask(),Ve.now())):o.set(c.key,$t.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Kv(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Bl(),i=new ke((o,a)=>o-a),s=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||$t.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||ne()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=hD();u.forEach(f=>{if(!s.has(f)){let v=_D(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return C.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return MV(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve(Yn()),a=Fo,l=s;return o.next(c=>C.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?C.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,ne())).next(u=>({batchId:a,changes:dD(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=Cl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Cl();return this.indexManager.getCollectionParents(e,s).next(a=>C.forEach(a,l=>{let c=xV(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,tt.newInvalidDocument(u)))});let a=Cl();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Dl(u.mutation,c,$t.empty(),Ve.now()),cc(t,c)&&(a=a.insert(l,c))}),a})}};var Hv=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return C.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,SU(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,_U(t)),C.resolve()}};var Qv=class{constructor(){this.overlays=new ke(U.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Yn();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=Yn(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ke((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=Yn(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=Yn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return C.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ul(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ne(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Yv=class{constructor(){this.sessionToken=Ye.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Kl=class{constructor(){this.refsByKey=new Ce(et.compareByKey),this.refsByTarget=new Ce(et.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new et(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new et(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new U(new le([])),r=new et(t,e),i=new et(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new U(new le([])),r=new et(t,e),i=new et(t,e+1),s=ne();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new et(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},et=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return U.comparator(e.key,t.key)||ee(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ee(e.targetOrBatchId,t.targetOrBatchId)||U.comparator(e.key,t.key)}};var Jv=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Ce(et.compareByKey)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ql(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new et(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return C.resolve(o)}lookupMutationBatch(e,t){return C.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?ui:this.nextBatchId-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new et(t,0),i=new et(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(ee);return t.forEach(i=>{let s=new et(i,0),o=new et(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),C.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new et(new U(s),0),a=new Ce(ee);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),C.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");H(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return C.forEach(t.mutations,s=>{let o=new et(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new et(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function t3(){return new ke(U.comparator)}var Xv=class{constructor(e){this.sizer=e,this.docs=t3(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():tt.newInvalidDocument(t))}getEntries(e,t){let r=Pt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():tt.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Pt(),o=t.path,a=new U(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Y_(wI(u),r)<=0||!i.has(u.key)&&!cc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){j()}forEachDocumentKey(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Zv(this)}getSize(e){return C.resolve(this.size)}};function n3(n){return new Xv(n)}var Zv=class extends _h{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var e_=class{constructor(e){this.persistence=e,this.targets=new er(t=>os(t),ac),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Kl,this.targetCount=0,this.targetIdGenerator=Wo.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),C.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new Wo(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.saveTargetData(t),C.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.references.containsKey(t))}};var r3="MemoryPersistence",bh=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new jt(0),this._started=!1,this._started=!0,this.globalsCache=new Yv,this.referenceDelegate=e(this),this.targetCache=new e_(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Bv,this.remoteDocumentCache=n3(r),this.serializer=new fh(t),this.bundleCache=new Hv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Jv(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){P(r3,"Starting transaction:",e);let i=new t_(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return C.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},t_=class extends nh{constructor(e){super(),this.currentSequenceNumber=e}},Eh=class n{constructor(e){this.persistence=e,this.localViewReferences=new Kl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw j()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),C.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.orphanedDocuments,i=>{let s=U.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,Y.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return C.or([()=>C.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var n_=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new rh("createOrUpgrade",t);r<1&&i>=1&&(s3(e),o3(e),rI(e),l3(e));let o=C.resolve();return r<3&&i>=3&&(r!==0&&(d3(e),rI(e)),o=o.next(()=>f3(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>a3(e,s))),o=o.next(()=>{p3(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(u3(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{h3(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{m3(e),g3(e)})),r<12&&i>=12&&(o=o.next(()=>{v3(e)})),r<13&&i>=13&&(o=o.next(()=>c3(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Ki))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>y3(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(Hh).clear()}).next(()=>{t.objectStore(Qh).clear()})),r<17&&i>=17&&(o=o.next(()=>{_3(e)})),o}addDocumentGlobal(e){let t=0;return e.store(Ki).iterate((r,i)=>{t+=yh(i)}).next(()=>{let r={byteSize:t};return e.store(sc).put(iv,r)})}removeAcknowledgedMutations(e){let t=e.store(ic),r=e.store(En);return t.loadAll().next(i=>C.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,ui],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Ji,o).next(a=>C.forEach(a,l=>{H(l.userId===s.userId);let c=Hi(this.serializer,l);return UD(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(ra),r=e.store(Ki);return e.store(ms).get(ih).next(s=>{let o=l=>t.put({targetId:0,path:Dt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new le(l),d=i3(u);a.push(t.get(d).next(f=>f?C.resolve():o(u)))}).next(()=>C.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Nl,{keyPath:gB});let r=t.store(Nl),i=new Wl,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Dt(l)})}};return t.store(Ki).iterate({keysOnly:!0},(o,a)=>{let l=new le(o);return s(l.popLast())}).next(()=>t.store(ta).iterate({keysOnly:!0},([o,a,l],c)=>{let u=Qn(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(na);return t.iterate((r,i)=>{let s=wl(i),o=LD(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(Ki),i=[];return r.iterate((s,o)=>{let a=t.store($h),l=S3(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>C.waitFor(i))}runOverlayMigration(e,t){let r=t.store(En),i=$D(this.serializer),s=new bh(Eh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:ne();Hi(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),C.forEach(a,(l,c)=>{let u=new nt(c),d=ph.forUser(this.serializer,u),f=s.getIndexManager(u),v=vh.forUser(u,this.serializer,f,s.referenceDelegate);return new Sh(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Ol(t,jt.INVALID),l).next()})})}};function i3(n){return[0,Dt(n)]}function s3(n){n.createObjectStore(rc)}function o3(n){n.createObjectStore(ic,{keyPath:oB}),n.createObjectStore(En,{keyPath:RI,autoIncrement:!0}).createIndex(Ji,kI,{unique:!0}),n.createObjectStore(ta)}function a3(n,e){return e.store(En).loadAll().next(r=>{n.deleteObjectStore(En),n.createObjectStore(En,{keyPath:RI,autoIncrement:!0}).createIndex(Ji,kI,{unique:!0});let s=e.store(En),o=r.map(a=>s.put(a));return C.waitFor(o)})}function l3(n){n.createObjectStore(Ki)}function c3(n){let e=n.createObjectStore($h,{keyPath:cB});e.createIndex(Hd,uB),e.createIndex(NI,dB)}function u3(n){n.createObjectStore(sc)}function rI(n){n.createObjectStore(ra,{keyPath:pB}).createIndex(X_,mB,{unique:!0}),n.createObjectStore(na,{keyPath:hB}).createIndex(OI,fB,{unique:!0}),n.createObjectStore(ms)}function d3(n){n.deleteObjectStore(ra),n.deleteObjectStore(na),n.deleteObjectStore(ms)}function h3(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function f3(n){let e=n.store(ms),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Y.min().toTimestamp(),targetCount:0};return e.put(ih,t)}function p3(n){n.createObjectStore(Lo,{keyPath:yB})}function m3(n){n.createObjectStore(Wh,{keyPath:vB})}function g3(n){n.createObjectStore(Kh,{keyPath:_B})}function y3(n){n.createObjectStore(Z_,{keyPath:SB,autoIncrement:!0}).createIndex(sv,bB,{unique:!1}),n.createObjectStore(Hh,{keyPath:EB}).createIndex(MI,CB,{unique:!1}),n.createObjectStore(Qh,{keyPath:wB}).createIndex(PI,TB,{unique:!1})}function v3(n){let e=n.createObjectStore(Yh,{keyPath:AB});e.createIndex(ov,IB,{unique:!1}),e.createIndex(FI,DB,{unique:!1})}function _3(n){n.createObjectStore(eS,{keyPath:RB})}function S3(n){return n.document?new U(le.fromString(n.document.name).popFirst(5)):n.noDocument?U.fromSegments(n.noDocument.path):n.unknownDocument?U.fromSegments(n.unknownDocument.path):j()}var oi="IndexedDbPersistence",Vy=30*60*1e3,qy=5e3,b3=4e3,Uy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",E3="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",C3="firestore_zombie",WD="main",r_=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=e3){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new x(I.UNIMPLEMENTED,E3);this.referenceDelegate=new jv(this,i),this.dbName=t+WD,this.serializer=new fh(l),this.simpleDb=new hi(this.dbName,this.schemaVersion,new n_(this.serializer)),this.globalsCache=new Ov,this.targetCache=new qv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$D(this.serializer),this.bundleCache=new Nv,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Be(oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(I.FAILED_PRECONDITION,Uy);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new jt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>E(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>E(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>E(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>$d(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Ci(e))return P(oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return P(oi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return El(e).get(So).next(r=>C.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return $d(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return E(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Vy)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=st(t,Lo);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Vy),o=i.filter(a=>s.indexOf(a)===-1);return C.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",b3,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?C.resolve(!0):El(e).get(So).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,qy)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new x(I.FAILED_PRECONDITION,Uy);return!1}}return this.networkEnabled&&this.inForeground?!0:$d(e).loadAll().next(s=>this.filterActiveClients(s,qy).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&P(oi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return E(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[rc,Lo],e=>{let t=new Ol(e,jt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>$d(e).loadAll().next(t=>this.filterActiveClients(t,Vy).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return vh.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vv(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return ph.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){P(oi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=BB(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Ol(a,this.listenSequence?this.listenSequence.next():jt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new x(I.FAILED_PRECONDITION,TI);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return El(e).get(So).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,qy)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new x(I.FAILED_PRECONDITION,Uy)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return El(e).put(So,t)}static isAvailable(){return hi.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=El(e);return t.get(So).next(r=>this.isLocalClient(r)?(P(oi,"Releasing primary lease."),t.delete(So)):C.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Be(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Yf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return P(oi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Be(oi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Be("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${C3}_${this.persistenceKey}_${e}`}};function El(n){return st(n,rc)}function $d(n){return st(n,Lo)}function gS(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function w3(n){return E(this,null,function*(){if(!hi.isAvailable())return Promise.resolve();let e=n+WD;yield hi.delete(e)})}function T3(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var yS="LocalStore",A3=5*60*1e6,Hl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new ke(ee),this.targetIdByTarget=new er(s=>os(s),ac),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Sh(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function KD(n,e,t,r){return new Hl(n,e,t,r)}function HD(n,e){return E(this,null,function*(){let t=z(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=ne();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function I3(n,e){let t=z(n),r=Ve.now(),i=e.reduce((a,l)=>a.add(l.key),ne()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Pt(),c=ne();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let v=rq(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new Tn(f.key,v,JI(v.value.mapValue),ze.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:dD(s)}))}function D3(n,e){let t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return B3(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,R3(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function R3(n){let e=ne();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function k3(n,e){let t=z(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(H(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function x3(n){let e=z(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function QD(n){let e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function N3(n,e){let t=z(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(Ye.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),O3(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=Pt(),c=ne();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(YD(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(Y.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return C.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function YD(n,e,t){let r=ne(),i=ne();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Pt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Y.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):P(yS,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function O3(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=A3?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function M3(n,e){return E(this,null,function*(){let t=z(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>C.forEach(e,i=>C.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>C.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Ci(r))P(yS,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function P3(n,e){let t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ui),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function F3(n,e){let t=z(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function Ko(n,e){let t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new $o(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function L3(n,e,t){let r=z(n),i=r.targetIdByTarget.get(t);return i!==void 0?C.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Ho(n,e,t){return E(this,null,function*(){let r=z(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Ci(o))P(yS,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function nf(n,e,t){let r=z(n),i=Y.min(),s=ne();return r.persistence.runTransaction("Execute query","readwrite",o=>L3(r,o,Rt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:Y.min(),t?s:ne())).next(a=>(ZD(r,lD(e),a),{documents:a,remoteKeys:s})))}function B3(n,e,t,r){let i=t.batch,s=i.keys(),o=C.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);H(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function V3(n,e){let t=z(n),r=z(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):C.resolve(null)))}function q3(n,e){z(z(n,Hl).mutationQueue).removeCachedMutationKeys(e)}function U3(n){return z(z(n,Hl).persistence).getActiveClients()}function JD(n,e){let t=z(n),r=z(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function XD(n,e){let t=z(n),r=t.collectionGroupReadTime.get(e)||Y.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,CI(r,Fo),Number.MAX_SAFE_INTEGER)).then(i=>(ZD(t,e,i),i))}function ZD(n,e,t){let r=n.collectionGroupReadTime.get(e)||Y.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function z3(n){return Rt(ia(le.fromString(`__bundle__/docs/${n}`)))}function G3(n,e,t,r){return E(this,null,function*(){let i=z(n),s=ne(),o=Pt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield Ko(i,z3(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>YD(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function j3(n,e){let t=z(n),r=He(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function $3(n,e){let t=z(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function W3(n,e){let t=z(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function K3(r,i){return E(this,arguments,function*(n,e,t=ne()){let s=yield Ko(n,Rt(hS(e.bundledQuery))),o=z(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=He(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Ye.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var i_=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var H3=100;function Q3(){return Yf()?8:AI(ka())>0?6:4}var Ch=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=H3,this.relativeIndexReadCostPerDocument=Q3()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new i_;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Io()<=kn.DEBUG&&P("QueryEngine","SDK will not create cache indexes for query:",Do(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),C.resolve()):(Io()<=kn.DEBUG&&P("QueryEngine","Query:",Do(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Io()<=kn.DEBUG&&P("QueryEngine","The SDK decides to create cache indexes for query:",Do(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rt(t))):C.resolve())}performQueryUsingIndex(e,t){if(TA(t))return C.resolve(null);let r=Rt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ch(t,null,"F"),r=Rt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ne(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ch(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return TA(t)||i.isEqual(Y.min())?C.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?C.resolve(null):(Io()<=kn.DEBUG&&P("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Do(t)),this.appendRemainingResults(e,o,t,CI(i,Fo)).next(a=>a))})}applyQuery(e,t){let r=new Ce(cD(e));return t.forEach((i,s)=>{cc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Io()<=kn.DEBUG&&P("QueryEngine","Using full collection scan to execute query:",Do(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,cn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var e1="firestore_clients";function iI(n,e){return`${e1}_${n}_${e}`}var t1="firestore_mutations";function sI(n,e,t){let r=`${t1}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var n1="firestore_targets";function zy(n,e){return`${n1}_${n}_${e}`}var Y3="firestore_online_state";function J3(n){return`${Y3}_${n}`}var X3="firestore_bundle_loaded_v2";function Z3(n){return`${X3}_${n}`}var e4="firestore_sequence_number";function t4(n){return`${e4}_${n}`}var Hn="SharedClientState",wh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new x(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Be(Hn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Rl=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new x(r.error.code,r.error.message))),i?new n(e,r.state,s):(Be(Hn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Th=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=cS();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=WI(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Be(Hn,`Failed to parse client data for instance '${e}': ${t}`),null)}},s_=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Be(Hn,`Failed to parse online state: ${e}`),null)}},Ql=class{constructor(){this.activeTargetIds=cS()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},kl=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new ke(ee),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=iI(this.persistenceKey,this.localClientId),this.sequenceNumberKey=t4(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Ql),this.clientStateKeyRe=new RegExp(`^${e1}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${t1}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${n1}_${o}_(\\d+)$`),this.onlineStateKey=J3(this.persistenceKey),this.bundleLoadedKey=Z3(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return E(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(iI(this.persistenceKey,r));if(i){let s=Th.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(zy(this.persistenceKey,e));if(r){let i=Rl.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(zy(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return P(Hn,"READ",e,t),t}setItem(e,t){P(Hn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){P(Hn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(P(Hn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Be("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>E(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=n4(t.newValue);r!==jt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new wh(this.currentUser,e,t,r),s=sI(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=sI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=zy(this.persistenceKey,e),s=new Rl(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Th.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return wh.fromWebStorageEntry(new nt(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Rl.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return s_.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return E(this,null,function*(){if(e.user.uid!==this.currentUser.uid){P(Hn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=cS();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function n4(n){let e=jt.INVALID;if(n!=null)try{let t=JSON.parse(n);H(typeof t=="number"),e=t}catch(t){Be(Hn,"Failed to read sequence number from WebStorage",t)}return e}var Ah=class{constructor(){this.localState=new Ql,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Ql,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var o_=class{addCallback(e){}shutdown(){}};var a_=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Wd=null;function r4(){return 268435456+Math.round(2147483648*Math.random())}function Gy(){return Wd===null?Wd=r4():Wd++,"0x"+Wd.toString(16)}function i4(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var s4="1.9.1",It="GrpcConnection",o4=`gl-node/${process.versions.node} fire/${ea} grpc/${s4}`;function jy(n,e,t,r){H(e===null||e.type==="OAuth");let i=new es.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",o4),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var l_=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){P(It,"Creating Firestore stub.");let e=this.databaseInfo.ssl?es.credentials.createSsl():es.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Gy(),a=this.ensureActiveStub(),l=jy(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return i4(u=>(P(It,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(P(It,`RPC '${e}' ${o} failed with error:`,d),u(new x(Jd(d.code),d.message))):(P(It,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Gy(),l=[],c=new Ke;P(It,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=jy(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),w=!1;return v.on("data",A=>{P(It,`RPC ${e} ${a} received result:`,A),l.push(A),o!==void 0&&l.length===o&&(w=!0,c.resolve(l))}),v.on("end",()=>{P(It,`RPC '${e}' ${a} completed.`),w||(w=!0,c.resolve(l))}),v.on("error",A=>{P(It,`RPC '${e}' ${a} failed with error:`,A);let T=Jd(A.code);c.reject(new x(T,A.message))}),c.promise}openStream(e,t,r){let i=Gy(),s=this.ensureActiveStub(),o=jy(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new a_({sendFn:f=>{if(l)P(It,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{P(It,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw Be("Failure sending:",f),Be("Error:",v),v}}},closeFn:()=>{P(It,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(P(It,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{P(It,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){ln(It,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=Jd(f.code);c(new x(v,f.message))}}),P(It,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},r1={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},a4={nested:r1},l4=Object.freeze({__proto__:null,nested:r1,default:a4});var c4={longs:String,enums:String,defaults:!0,oneofs:!1};function u4(){let n=SI.fromJSON(l4,c4);return es.loadPackageDefinition(n)}function d4(n){let e=u4();return new l_(e,n)}function h4(){return new o_}function i1(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function f4(){return null}function dc(n){return new Iv(n,!1)}var p4="ExponentialBackoff",m4=1e3,g4=1.5,y4=60*1e3,Yl=class{constructor(e,t,r=m4,i=g4,s=y4){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&P(p4,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var oI="PersistentStream",v4=60*1e3,_4=10*1e3,Ih=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Yl(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return E(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,v4,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return E(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return E(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===I.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new x(I.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,_4,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>E(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return P(oI,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(P(oI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},c_=class extends Ih{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=Dq(this.serializer,e),r=kq(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=kv(this.serializer),t.addTarget=Uq(this.serializer,e);let r=Vq(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=kv(this.serializer),t.removeTarget=e,this.sendRequest(t)}},u_=class extends Ih{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return H(!!e.streamToken),this.lastStreamToken=e.streamToken,H(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=Mq(e.writeResults,e.commitTime),r=He(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=kv(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>$l(this.serializer,r))};this.sendRequest(t)}};var d_=class{},h_=class extends d_{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new x(I.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,Rv(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(I.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,Rv(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(I.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function S4(n,e,t,r){return new h_(n,e,t,r)}function b4(n,e){return E(this,null,function*(){let t=z(n),r={writes:e.map(i=>$l(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,le.emptyPath(),r)})}function E4(n,e){return E(this,null,function*(){let t=z(n),r={documents:e.map(a=>jl(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,le.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=Iq(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());H(!!l),o.push(l)}),o})}function C4(n,e,t){let r=z(n);return r.verifyInitialized(),new u_(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function w4(n,e,t){let r=z(n);return r.verifyInitialized(),new c_(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var T4="OnlineStateTracker",aI=1,lI=10*1e3,f_=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",lI,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${lI/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=aI&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${aI} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Be(t),this.shouldWarnClientIsOffline=!1):P(T4,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var us="RemoteStore",A4=10,p_=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>E(this,null,function*(){wi(this)&&(P(us,"Restarting streams for network reachability change."),yield j4(this))}))}),this.onlineStateTracker=new f_(r,i)}};function I4(n,e,t,r,i){return new p_(n,e,t,r,i)}function D4(n){let e=z(n);return e.offlineCauses.delete(0),hc(e)}function hc(n){return E(this,null,function*(){if(wi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function R4(n){return E(this,null,function*(){let e=z(n);e.offlineCauses.add(0),yield sa(e),e.onlineStateTracker.set("Offline")})}function sa(n){return E(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function k4(n){return E(this,null,function*(){let e=z(n);P(us,"RemoteStore shutting down."),e.offlineCauses.add(5),yield sa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function rf(n,e){let t=z(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),SS(t)?_S(t):la(t).isOpen()&&vS(t,e))}function oa(n,e){let t=z(n),r=la(t);t.listenTargets.delete(e),r.isOpen()&&s1(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():wi(t)&&t.onlineStateTracker.set("Unknown"))}function vS(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}la(n).watch(e)}function s1(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),la(n).unwatch(e)}function _S(n){n.watchChangeAggregator=new Av({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),la(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function SS(n){return wi(n)&&!la(n).isStarted()&&n.listenTargets.size>0}function wi(n){return z(n).offlineCauses.size===0}function o1(n){n.watchChangeAggregator=void 0}function x4(n){return E(this,null,function*(){n.onlineStateTracker.set("Online")})}function N4(n){return E(this,null,function*(){n.listenTargets.forEach((e,t)=>{vS(n,e)})})}function O4(n,e){return E(this,null,function*(){o1(n),SS(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),_S(n)):n.onlineStateTracker.set("Unknown")})}function M4(n,e,t){return E(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof dh&&e.state===2&&e.cause){try{yield F4(n,e)}catch(r){P(us,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Dh(n,r)}return}if(e instanceof Po?n.watchChangeAggregator.handleDocumentChange(e):e instanceof uh?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Y.min()))try{let r=yield QD(n.localStore);t.compareTo(r)>=0&&(yield P4(n,t))}catch(r){P(us,"Failed to raise snapshot:",r),yield Dh(n,r)}})}function Dh(n,e,t){return E(this,null,function*(){if(Ci(e))n.offlineCauses.add(1),yield sa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>QD(n.localStore)),n.asyncQueue.enqueueRetryable(()=>E(this,null,function*(){P(us,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield hc(n)}));else throw e})}function a1(n,e){return e().catch(t=>Dh(n,t,e))}function P4(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Ye.EMPTY_BYTE_STRING,s.snapshotVersion)),s1(n,r);let o=new $o(s.target,r,i,s.sequenceNumber);vS(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function F4(n,e){return E(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function aa(n){return E(this,null,function*(){let e=z(n),t=Ti(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:ui;for(;L4(e);)try{let i=yield P3(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,B4(e,i)}catch(i){yield Dh(e,i)}l1(e)&&c1(e)})}function L4(n){return wi(n)&&n.writePipeline.length<A4}function B4(n,e){n.writePipeline.push(e);let t=Ti(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function l1(n){return wi(n)&&!Ti(n).isStarted()&&n.writePipeline.length>0}function c1(n){Ti(n).start()}function V4(n){return E(this,null,function*(){Ti(n).writeHandshake()})}function q4(n){return E(this,null,function*(){let e=Ti(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function U4(n,e,t){return E(this,null,function*(){let r=n.writePipeline.shift(),i=Ev.from(r,e,t);yield a1(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield aa(n)})}function z4(n,e){return E(this,null,function*(){e&&Ti(n).handshakeComplete&&(yield G4(n,e)),l1(n)&&c1(n)})}function G4(n,e){return E(this,null,function*(){if(uq(e.code)){let t=n.writePipeline.shift();Ti(n).inhibitBackoff(),yield a1(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield aa(n)}})}function j4(n){return E(this,null,function*(){let e=z(n);e.offlineCauses.add(4),yield sa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield hc(e)})}function cI(n,e){return E(this,null,function*(){let t=z(n);t.asyncQueue.verifyOperationInProgress(),P(us,"RemoteStore received new credentials");let r=wi(t);t.offlineCauses.add(3),yield sa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield hc(t)})}function m_(n,e){return E(this,null,function*(){let t=z(n);e?(t.offlineCauses.delete(2),yield hc(t)):e||(t.offlineCauses.add(2),yield sa(t),t.onlineStateTracker.set("Unknown"))})}function la(n){return n.watchStream||(n.watchStream=w4(n.datastore,n.asyncQueue,{onConnected:x4.bind(null,n),onOpen:N4.bind(null,n),onClose:O4.bind(null,n),onWatchChange:M4.bind(null,n)}),n.onNetworkStatusChange.push(e=>E(this,null,function*(){e?(n.watchStream.inhibitBackoff(),SS(n)?_S(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),o1(n))}))),n.watchStream}function Ti(n){return n.writeStream||(n.writeStream=C4(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:V4.bind(null,n),onClose:z4.bind(null,n),onHandshakeComplete:q4.bind(null,n),onMutationResult:U4.bind(null,n)}),n.onNetworkStatusChange.push(e=>E(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield aa(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(P(us,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var $4="AsyncQueue",g_=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ca(n,e){if(Be($4,`${e}: ${n}`),Ci(n))return new x(I.UNAVAILABLE,`${e}: ${n}`);throw n}var Rh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||U.comparator(t.key,r.key):this.comparator=(t,r)=>U.comparator(t.key,r.key),this.keyedMap=Cl(),this.sortedSet=new ke(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var kh=class{constructor(){this.changeMap=new ke(U.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):j()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Qo=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Rh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!lc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var y_=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function W4(){return new v_}var v_=class{constructor(){this.queries=u1(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){X4(this,new x(I.ABORTED,"Firestore shutting down"))}};function u1(){return new er(n=>aD(n),lc)}function bS(n,e){return E(this,null,function*(){let t=z(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new y_,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=ca(o,`Initialization of query '${Do(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&CS(t)})}function ES(n,e){return E(this,null,function*(){let t=z(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function K4(n,e){let t=z(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&CS(t)}function H4(n,e,t){let r=z(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function Q4(n,e){let t=z(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&CS(t)}function Y4(n,e){z(n).snapshotsInSyncListeners.add(e),e.next()}function J4(n,e){z(n).snapshotsInSyncListeners.delete(e)}function X4(n,e){let t=z(n),r=t.queries;t.queries=u1(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function CS(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var d1=function(n){return n.Default="default",n.Cache="cache",n}(d1||{}),Jl=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Qo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Qo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==d1.Cache}};var __=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ne(),i=ne();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var xh=class{constructor(e){this.serializer=e}toDocumentKey(e){return Jn(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?kD(this.serializer,e.document,!1):tt.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return He(e)}},S_=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=h1(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=le.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new xh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ne()).add(s);t.set(o,a)}}return t}complete(){return E(this,null,function*(){let e=yield G3(this.localStore,new xh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield K3(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function h1(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function Z4(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Nh=class{constructor(e){this.key=e}},Oh=class{constructor(e){this.key=e}},Mh=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ne(),this.mutatedKeys=ne(),this.docComparator=cD(e),this.documentSet=new Rh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new kh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=cc(this.query,d)?d:null,w=f?this.mutatedKeys.has(f.key):!1,A=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,T=!1;f&&v?f.data.isEqual(v.data)?w!==A&&(r.track({type:3,doc:v}),T=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),T=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),T=!0):f&&!v&&(r.track({type:1,doc:f}),T=!0,(l||c)&&(a=!0)),T&&(v?(o=o.add(v),A?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>ez(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Qo(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new kh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ne(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Oh(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Nh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ne();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Qo.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function ez(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return j()}};return t(n)-t(e)}var Ai="SyncEngine",b_=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},E_=class{constructor(e){this.key=e,this.receivedDocument=!1}},C_=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new er(a=>aD(a),lc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ke(U.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Kl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Wo.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function tz(n,e,t,r,i,s,o){let a=new C_(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function nz(n,e,t=!0){return E(this,null,function*(){let r=sf(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield f1(r,e,t,!0),i})}function rz(n,e){return E(this,null,function*(){let t=sf(n);yield f1(t,e,!0,!1)})}function f1(n,e,t,r){return E(this,null,function*(){let i=yield Ko(n.localStore,Rt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield wS(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&rf(n.remoteStore,i),a})}function wS(n,e,t,r,i){return E(this,null,function*(){n.applyDocChanges=(d,f,v)=>pz(n,d,f,v);let s=yield nf(n.localStore,e,!0),o=new Mh(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Gl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);IS(n,t,c.limboChanges);let u=new b_(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function iz(n,e,t){return E(this,null,function*(){let r=z(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!lc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ho(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&oa(r.remoteStore,i.targetId),Yo(r,i.targetId)}).catch(Ei))):(Yo(r,i.targetId),yield Ho(r.localStore,i.targetId,!0))})}function sz(n,e){return E(this,null,function*(){let t=z(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),oa(t.remoteStore,r.targetId))})}function oz(n,e,t){return E(this,null,function*(){let r=RS(n);try{let i=yield I3(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),hz(r,i.batchId,t),yield Er(r,i.changes),yield aa(r.remoteStore)}catch(i){let s=ca(i,"Failed to persist write");t.reject(s)}})}function p1(n,e){return E(this,null,function*(){let t=z(n);try{let r=yield N3(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?H(o.receivedDocument):i.removedDocuments.size>0&&(H(o.receivedDocument),o.receivedDocument=!1))}),yield Er(t,r,e)}catch(r){yield Ei(r)}})}function uI(n,e,t){let r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),Q4(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function az(n,e,t){return E(this,null,function*(){let r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new ke(U.comparator);o=o.insert(s,tt.newNoDocument(s,Y.min()));let a=ne().add(s),l=new zl(Y.min(),new Map,new ke(ee),o,a);yield p1(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),DS(r)}else yield Ho(r.localStore,e,!1).then(()=>Yo(r,e,t)).catch(Ei)})}function lz(n,e){return E(this,null,function*(){let t=z(n),r=e.batch.batchId;try{let i=yield D3(t.localStore,e);AS(t,r,null),TS(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Er(t,i)}catch(i){yield Ei(i)}})}function cz(n,e,t){return E(this,null,function*(){let r=z(n);try{let i=yield k3(r.localStore,e);AS(r,e,t),TS(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Er(r,i)}catch(i){yield Ei(i)}})}function uz(n,e){return E(this,null,function*(){let t=z(n);wi(t.remoteStore)||P(Ai,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield x3(t.localStore);if(r===ui){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=ca(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function TS(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function dz(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new x(I.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function hz(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new ke(ee)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function AS(n,e,t){let r=z(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Yo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||m1(n,i)})}function m1(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(oa(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),DS(n))}function IS(n,e,t){for(let r of t)r instanceof Nh?(n.limboDocumentRefs.addReference(r.key,e),fz(n,r)):r instanceof Oh?(P(Ai,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||m1(n,r.key)):j()}function fz(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(P(Ai,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),DS(n))}function DS(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new U(le.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new E_(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),rf(n.remoteStore,new $o(Rt(ia(t.path)),r,"TargetPurposeLimboResolution",jt.INVALID))}}function Er(n,e,t){return E(this,null,function*(){let r=z(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=__.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield M3(r.localStore,s))})}function pz(n,e,t,r){return E(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield nf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return IS(n,e.targetId,a.limboChanges),a.snapshot})}function mz(n,e){return E(this,null,function*(){let t=z(n);if(!t.currentUser.isEqual(e)){P(Ai,"User change. New user:",e.toKey());let i=yield HD(t.localStore,e);t.currentUser=e,dz(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Er(t,i.affectedDocuments)}})}function gz(n,e){let t=z(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ne().add(r.key);{let i=ne(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function yz(n,e){return E(this,null,function*(){let t=z(n),r=yield nf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&IS(t,e.targetId,i.limboChanges),i})}function vz(n,e){return E(this,null,function*(){let t=z(n);return XD(t.localStore,e).then(r=>Er(t,r))})}function _z(n,e,t,r){return E(this,null,function*(){let i=z(n),s=yield V3(i.localStore,e);if(s===null){P(Ai,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield aa(i.remoteStore):t==="acknowledged"||t==="rejected"?(AS(i,e,r||null),TS(i,e),q3(i.localStore,e)):j(),yield Er(i,s)})}function Sz(n,e){return E(this,null,function*(){let t=z(n);if(sf(t),RS(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield dI(t,r.toArray());t._isPrimaryClient=!0,yield m_(t.remoteStore,!0);for(let s of i)rf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Yo(t,o),Ho(t.localStore,o,!0))),oa(t.remoteStore,o)}),yield i,yield dI(t,r),bz(t),t._isPrimaryClient=!1,yield m_(t.remoteStore,!1)}})}function bz(n){let e=z(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{oa(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new ke(U.comparator)}function dI(n,e,t){return E(this,null,function*(){let r=z(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield Ko(r.localStore,Rt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield yz(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield JD(r.localStore,o);a=yield Ko(r.localStore,c),yield wS(r,g1(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function g1(n){return oD(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Ez(n){let e=z(n);return U3(e.localStore)}function Cz(n,e,t,r){return E(this,null,function*(){let i=z(n);if(i._isPrimaryClient){P(Ai,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield XD(i.localStore,lD(s[0])),a=zl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ye.EMPTY_BYTE_STRING);yield Er(i,o,a);break}case"rejected":{yield Ho(i.localStore,e,!0),Yo(i,e,r);break}default:j()}})}function wz(n,e,t){return E(this,null,function*(){let r=sf(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){P(Ai,"Adding an already active target "+i);continue}let o=yield JD(r.localStore,i),a=yield Ko(r.localStore,o);yield wS(r,g1(o),a.targetId,!1,a.resumeToken),rf(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield Ho(r.localStore,i,!1).then(()=>{oa(r.remoteStore,i),Yo(r,i)}).catch(Ei))}})}function sf(n){let e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=p1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gz.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=az.bind(null,e),e.syncEngineListener.onWatchChange=K4.bind(null,e.eventManager),e.syncEngineListener.onWatchError=H4.bind(null,e.eventManager),e}function RS(n){let e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=lz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cz.bind(null,e),e}function Tz(n,e,t){let r=z(n);Az(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function Az(n,e,t){return E(this,null,function*(){try{let r=yield e.getMetadata();if(yield j3(n.localStore,r))return yield e.close(),t._completeWith(Z4(r)),Promise.resolve(new Set);t._updateProgress(h1(r));let s=new S_(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Er(n,a.changedDocs,void 0),yield $3(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return ln(Ai,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var Xl=class{constructor(){this.synchronizeTabs=!1}initialize(e){return E(this,null,function*(){this.serializer=dc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return KD(this.persistence,new Ch,e.initialUser,this.serializer)}createPersistence(e){return new bh(Eh.factory,this.serializer)}createSharedClientState(e){return new Ah}terminate(){return E(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Ph=class n extends Xl{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return E(this,null,function*(){yield Vf(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield RS(this.onlineComponentProvider.syncEngine),yield aa(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return KD(this.persistence,new Ch,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new zv(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new nv(t,this.persistence);return new tv(e.asyncQueue,r)}createPersistence(e){let t=gS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?an.withCacheSize(this.cacheSizeBytes):an.DEFAULT;return new r_(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,i1(),f4(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ah}},w_=class n extends Ph{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return E(this,null,function*(){yield Vf(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof kl&&(this.sharedClientState.syncEngine={applyBatchState:_z.bind(null,t),applyTargetState:Cz.bind(null,t),applyActiveTargetsChange:wz.bind(null,t),getActiveClients:Ez.bind(null,t),synchronizeWithChangedDocuments:vz.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>E(this,null,function*(){yield Sz(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=i1();if(!kl.isAvailable(t))throw new x(I.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=gS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new kl(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Zl=class{initialize(e,t){return E(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>uI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=mz.bind(null,this.syncEngine),yield m_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return W4()}createDatastore(e){let t=dc(e.databaseInfo.databaseId),r=d4(e.databaseInfo);return S4(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return I4(this.localStore,this.datastore,e.asyncQueue,t=>uI(this.syncEngine,t,0),h4())}createSyncEngine(e,t){return tz(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return E(this,null,function*(){var e,t;yield k4(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};var Iz=10240;function Dz(n,e=Iz){let t=0;return{read(){return E(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return E(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function kS(n,e,t){if(!t)throw new x(I.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function xS(n,e,t,r){if(e===!0&&r===!0)throw new x(I.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function hI(n){if(!U.isDocumentKey(n))throw new x(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function fI(n){if(U.isDocumentKey(n))throw new x(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rz(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function fc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=kz(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":j()}function kz(n){return n.constructor?n.constructor.name:null}function ce(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=fc(n);throw new x(I.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function y1(n,e){if(e<=0)throw new x(I.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function xz(n,e){if(!(n instanceof Uint8Array))throw new x(I.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${fc(n)}`);return Dz(n,e)}var Jo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var T_=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var A_=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new Ke,this.buffer=new Uint8Array,this.textDecoder=dq(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return E(this,null,function*(){return this.metadata.promise})}nextElement(){return E(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return E(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new T_(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return E(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return E(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return E(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function Nz(n,e){return new A_(n,e)}var I_=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return E(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield E4(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new _i(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return E(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new Vl(i,this.precondition(i)))}),yield b4(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Y.min();else throw j();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new x(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Y.min())?ze.exists(!1):ze.updateTime(t):ze.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Y.min()))throw new x(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ze.updateTime(t)}else return ze.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var D_=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Yl(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>E(this,null,function*(){let e=new I_(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return oc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!CD(t)}return!1}};var Si="FirestoreClient",Oz=100,Mz=11,Pz=20,Fz=22,R_=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=nt.UNAUTHENTICATED,this.clientId=eh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>E(this,null,function*(){P(Si,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(P(Si,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:Oz}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(I.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>E(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ca(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Xd(n,e){return E(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),P(Si,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>E(this,null,function*(){r.isEqual(i)||(yield HD(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function k_(n,e){return E(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield NS(n);P(Si,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>cI(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>cI(e.remoteStore,i)),n._onlineComponents=e})}function v1(n){return n.name==="FirebaseError"?n.code===I.FAILED_PRECONDITION||n.code===I.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===Fz||n.code===Pz||n.code===Mz:!0}function NS(n){return E(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){P(Si,"Using user provided OfflineComponentProvider");try{yield Xd(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!v1(t))throw t;ln("Error using user provided cache. Falling back to memory cache: "+t),yield Xd(n,new Xl)}}else P(Si,"Using default OfflineComponentProvider"),yield Xd(n,new Xl);return n._offlineComponents})}function of(n){return E(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(P(Si,"Using user provided OnlineComponentProvider"),yield k_(n,n._uninitializedComponentsProvider._online)):(P(Si,"Using default OnlineComponentProvider"),yield k_(n,new Zl))),n._onlineComponents})}function _1(n){return NS(n).then(e=>e.persistence)}function OS(n){return NS(n).then(e=>e.localStore)}function S1(n){return of(n).then(e=>e.remoteStore)}function MS(n){return of(n).then(e=>e.syncEngine)}function Lz(n){return of(n).then(e=>e.datastore)}function Xo(n){return E(this,null,function*(){let e=yield of(n),t=e.eventManager;return t.onListen=nz.bind(null,e.syncEngine),t.onUnlisten=iz.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rz.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=sz.bind(null,e.syncEngine),t})}function Bz(n){return n.asyncQueue.enqueue(()=>E(this,null,function*(){let e=yield _1(n),t=yield S1(n);return e.setNetworkEnabled(!0),D4(t)}))}function Vz(n){return n.asyncQueue.enqueue(()=>E(this,null,function*(){let e=yield _1(n),t=yield S1(n);return e.setNetworkEnabled(!1),R4(t)}))}function qz(n){let e=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let t=yield MS(n);return uz(t,e)})),e.promise}function Uz(n,e,t,r){let i=new Jo(r),s=new Jl(e,i,t);return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let o=yield Xo(n);return bS(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let o=yield Xo(n);return ES(o,s)}))}}function zz(n,e){let t=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let r=yield OS(n);return Kz(r,e,t)})),t.promise}function b1(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let i=yield Xo(n);return Hz(i,n.asyncQueue,e,t,r)})),r.promise}function Gz(n,e){let t=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let r=yield OS(n);return Qz(r,e,t)})),t.promise}function E1(n,e,t={}){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let i=yield Xo(n);return Yz(i,n.asyncQueue,e,t,r)})),r.promise}function jz(n,e){let t=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let r=yield MS(n);return oz(r,e,t)})),t.promise}function $z(n,e){let t=new Jo(e);return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let r=yield Xo(n);return Y4(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let r=yield Xo(n);return J4(r,t)}))}}function Wz(n,e,t){let r=new Ke;return n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){let i=yield Lz(n);new D_(n.asyncQueue,i,t,e,r).run()})),r.promise}function Kz(n,e,t){return E(this,null,function*(){try{let r=yield F3(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new x(I.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=ca(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function Hz(n,e,t,r,i){let s=new Jo({next:a=>{e.enqueueAndForget(()=>ES(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new x(I.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new x(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Jl(ia(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return bS(n,o)}function Qz(n,e,t){return E(this,null,function*(){try{let r=yield nf(n,e,!0),i=new Mh(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=ca(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function Yz(n,e,t,r,i){let s=new Jo({next:a=>{e.enqueueAndForget(()=>ES(n,o)),a.fromCache&&r.source==="server"?i.reject(new x(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Jl(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return bS(n,o)}function Jz(n,e,t,r){let i=Zz(t,dc(e));n.asyncQueue.enqueueAndForget(()=>E(this,null,function*(){Tz(yield MS(n),i,r)}))}function Xz(n,e){return n.asyncQueue.enqueue(()=>E(this,null,function*(){return W3(yield OS(n),e)}))}function Zz(n,e){let t;return typeof n=="string"?t=wD().encode(n):t=n,Nz(xz(t),e)}function e6(n,e){return n.timeoutSeconds===e.timeoutSeconds}function C1(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var t6="ComponentProvider",pI=new Map;function n6(n){let e=pI.get(n);e&&(P(t6,"Removing Datastore"),pI.delete(n),e.terminate())}function r6(n,e,t,r){return new lv(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,C1(r.experimentalLongPollingOptions),r.useFetchStreams)}var w1="firestore.googleapis.com",mI=!0,gI=5,yI=30,i6=!0,Fh=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=w1,this.ssl=mI}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:mI;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=jD;else{if(e.cacheSizeBytes!==uc&&e.cacheSizeBytes<XA)throw new x(I.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${XA}`);this.cacheSizeBytes=e.cacheSizeBytes}xS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=i6:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=C1((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),s6(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&e6(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function s6(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<gI)throw new x(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${gI})`);if(n.timeoutSeconds>yI)throw new x(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${yI})`)}}var ds=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new x(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fh(e),e.credentials!==void 0&&(this._authCredentials=Q2(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return n6(this),Promise.resolve()}};function af(n,e,t,r={}){var i;n=ce(n,ds);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==w1&&s.host!==o&&ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=nt.MOCK_USER;else{a=fb(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new x(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new nt(c)}n._authCredentials=new Wy(new Zd(a,l))}}var ht=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ie=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Xn=class n extends ht{constructor(e,t,r){super(e,t,ia(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ie(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function lf(n,e,...t){if(n=Le(n),kS("collection","path",e),n instanceof ds){let r=le.fromString(e,...t);return fI(r),new Xn(n,null,r)}else{if(!(n instanceof Ie)&&!(n instanceof Xn))throw new x(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(le.fromString(e,...t));return fI(r),new Xn(n.firestore,null,r)}}function PS(n,e){if(n=ce(n,ds),kS("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(I.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ht(n,null,OV(e))}function ua(n,e,...t){if(n=Le(n),arguments.length===1&&(e=eh.newId()),kS("doc","path",e),n instanceof ds){let r=le.fromString(e,...t);return hI(r),new Ie(n,null,new U(r))}else{if(!(n instanceof Ie)&&!(n instanceof Xn))throw new x(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(le.fromString(e,...t));return hI(r),new Ie(n.firestore,n instanceof Xn?n.converter:null,new U(r))}}function cf(n,e){return n=Le(n),e=Le(e),(n instanceof Ie||n instanceof Xn)&&(e instanceof Ie||e instanceof Xn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function uf(n,e){return n=Le(n),e=Le(e),n instanceof ht&&e instanceof ht?n.firestore===e.firestore&&lc(n._query,e._query)&&n.converter===e.converter:!1}var o6="AsyncQueue",x_=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Yl(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Ke;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return E(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Ci(e))P(o6,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=l6(r);throw Be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=g_.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&j()}verifyOperationInProgress(){}drain(){return E(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function a6(){return new x_}function l6(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var N_=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ke,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var T1=uc,Pe=class extends ds{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=a6(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||I1(this),this._firestoreClient.terminate()}};function A1(n,e){let t=typeof n=="object"?n:Na(),r=typeof n=="string"?n:e||cv,i=Xf(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=hb("firestore");s&&af(i,...s)}return i}function ot(n){return n._firestoreClient||I1(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function I1(n){var e,t,r;let i=n._freezeSettings(),s=r6(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new R_(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function FS(n,e){n=ce(n,Pe),R1(n);let t=ot(n);if(t._uninitializedComponentsProvider)throw new x(I.FAILED_PRECONDITION,"SDK cache is already specified.");ln("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Zl,s=new Ph(i,r.cacheSizeBytes,e?.forceOwnership);return D1(t,i,s)}function LS(n){n=ce(n,Pe),R1(n);let e=ot(n);if(e._uninitializedComponentsProvider)throw new x(I.FAILED_PRECONDITION,"SDK cache is already specified.");ln("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Zl,i=new w_(r,t.cacheSizeBytes);return D1(e,r,i)}function D1(n,e,t){let r=new Ke;return n.asyncQueue.enqueue(()=>E(this,null,function*(){try{yield Xd(n,t),yield k_(n,e),r.resolve()}catch(i){let s=i;if(!v1(s))throw s;ln("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function BS(n){if(n._initialized&&!n._terminated)throw new x(I.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ke;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>E(this,null,function*(){try{yield w3(gS(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function VS(n){n=ce(n,Pe);let e=ot(n);return qz(e)}function qS(n){n=ce(n,Pe);let e=ot(n);return Bz(e)}function US(n){n=ce(n,Pe);let e=ot(n);return Vz(e)}function zS(n,e){n=ce(n,Pe);let t=ot(n),r=new N_;return Jz(t,n._databaseId,e,r),r}function GS(n,e){n=ce(n,Pe);let t=ot(n);return Xz(t,e).then(r=>r?new ht(n,null,r.query):null)}function R1(n){if(n._initialized||n._terminated)throw new x(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function c6(n,e=!0){K2(gb),xa(new Ni("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Pe(new Ky(t.getProvider("auth-internal")),new Jy(t.getProvider("app-check-internal")),WB(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Et(dA,hA,n),Et(dA,hA,"esm2017")}var tr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ye.fromBase64String(e))}catch(t){throw new x(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ye.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var An=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var _r=class{constructor(e){this._methodName=e}};var hs=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}};var ec=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return T3(this._values,e._values)}};var u6=/^__.*__$/,O_=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Tn(e,this.data,this.fieldMask,t,this.fieldTransforms):new vi(e,this.data,t,this.fieldTransforms)}},Lh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Tn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function k1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var Bh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Vh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(k1(this.dataSource)&&u6.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},M_=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||dc(e)}createContext(e,t,r,i=!1){return new Bh({dataSource:e,methodName:t,targetDoc:r,path:Qe.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ys(n){let e=n._freezeSettings(),t=dc(n._databaseId);return new M_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function df(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);WS("Data must be an object, but it was:",o,r);let a=O1(r,o),l,c;if(s.merge)l=new $t(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=V_(e,d,t);if(!o.contains(f))throw new x(I.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);P1(u,f)||u.push(f)}l=new $t(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new O_(new _t(a),l,c)}var tc=class n extends _r{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function x1(n,e,t){return new Bh({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var P_=class n extends _r{_toFieldTransform(e){return new as(e.path,new gi)}isEqual(e){return e instanceof n}},F_=class n extends _r{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=x1(this,e,!0),r=this._elements.map(s=>vs(s,t)),i=new yr(r);return new as(e.path,i)}isEqual(e){return e instanceof n&&Jf(this._elements,e._elements)}},L_=class n extends _r{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=x1(this,e,!0),r=this._elements.map(s=>vs(s,t)),i=new vr(r);return new as(e.path,i)}isEqual(e){return e instanceof n&&Jf(this._elements,e._elements)}},B_=class n extends _r{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new yi(e.serializer,pD(e.serializer,this._operand));return new as(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function jS(n,e,t,r){let i=n.createContext(1,e,t);WS("Data must be an object, but it was:",i,r);let s=[],o=_t.empty();gs(r,(l,c)=>{let u=KS(e,l,t);c=Le(c);let d=i.childContextForFieldPath(u);if(c instanceof tc)s.push(u);else{let f=vs(c,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new $t(s);return new Lh(o,a,i.fieldTransforms)}function $S(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[V_(e,r,t)],l=[i];if(s.length%2!==0)throw new x(I.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(V_(e,s[f])),l.push(s[f+1]);let c=[],u=_t.empty();for(let f=a.length-1;f>=0;--f)if(!P1(c,a[f])){let v=a[f],w=l[f];w=Le(w);let A=o.childContextForFieldPath(v);if(w instanceof tc)c.push(v);else{let T=vs(w,A);T!=null&&(c.push(v),u.set(v,T))}}let d=new $t(c);return new Lh(u,d,o.fieldTransforms)}function N1(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return vs(t,i)}function vs(n,e){if(n=Le(n),M1(n))return WS("Unsupported field value:",e,n),O1(n,e);if(n instanceof _r)return h6(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return d6(n,e)}else return f6(n,e)}function O1(n,e){let t={};return qI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gs(n,(r,i)=>{let s=vs(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function d6(n,e){let t=[],r=0;for(let i of n){let s=vs(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function h6(n,e){if(!k1(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function f6(n,e){if(n=Le(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return pD(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ve.fromDate(n);return{timestampValue:jo(e.serializer,t)}}else if(n instanceof Ve){let t=new Ve(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:jo(e.serializer,t)}}else{if(n instanceof hs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tr)return{bytesValue:TD(e.serializer,n._byteString)};if(n instanceof Ie){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:dS(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof ec)return p6(n,e);throw e.createError(`Unsupported field value: ${fc(n)}`)}}}function p6(n,e){return{mapValue:{fields:{[rS]:{stringValue:iS},[Bo]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return uS(e.serializer,r)})}}}}}}function M1(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ve)&&!(n instanceof hs)&&!(n instanceof tr)&&!(n instanceof Ie)&&!(n instanceof _r)&&!(n instanceof ec)}function WS(n,e,t){if(!M1(t)||!Rz(t)){let r=fc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function V_(n,e,t){if(e=Le(e),e instanceof An)return e._internalPath;if(typeof e=="string")return KS(n,e);throw Vh("Field path arguments must be of type string or ",n,!1,void 0,t)}var m6=new RegExp("[~\\*/\\[\\]]");function KS(n,e,t){if(e.search(m6)>=0)throw Vh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new An(...e.split("."))._internalPath}catch{throw Vh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Vh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new x(I.INVALID_ARGUMENT,a+n+l)}function P1(n,e){return n.some(t=>t.isEqual(e))}var fs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new q_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(hf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},q_=class extends fs{data(){return super.data()}};function hf(n,e){return typeof e=="string"?KS(n,e):e instanceof An?e._internalPath:e._delegate._internalPath}function F1(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var nc=class{},ps=class extends nc{};function nr(n,e,...t){let r=[];e instanceof nc&&r.push(e),r=r.concat(t),C6(r);for(let i of r)n=i._apply(n);return n}var qh=class n extends ps{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return B1(e._query,t),new ht(e.firestore,e.converter,lS(e._query,t))}_parse(e){let t=ys(e.firestore);return g6(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function HS(n,e,t){let r=e,i=hf("where",n);return qh._create(i,r,t)}var U_=class n extends nc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:_e.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(b6(e._query,t),new ht(e.firestore,e.converter,lS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var z_=class n extends ps{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=y6(e._query,this._field,this._direction);return new ht(e.firestore,e.converter,FV(e._query,t))}};function QS(n,e="asc"){let t=e,r=hf("orderBy",n);return z_._create(r,t)}var Uh=class n extends ps{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new ht(e.firestore,e.converter,ch(e._query,this._limit,this._limitType))}};function YS(n){return y1("limit",n),Uh._create("limit",n,"F")}function JS(n){return y1("limitToLast",n),Uh._create("limitToLast",n,"L")}var zh=class n extends ps{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=L1(e,this.type,this._docOrFields,this._inclusive);return new ht(e.firestore,e.converter,LV(e._query,t))}};function XS(...n){return zh._create("startAt",n,!0)}function ZS(...n){return zh._create("startAfter",n,!1)}var Gh=class n extends ps{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=L1(e,this.type,this._docOrFields,this._inclusive);return new ht(e.firestore,e.converter,BV(e._query,t))}};function e0(...n){return Gh._create("endBefore",n,!1)}function t0(...n){return Gh._create("endAt",n,!0)}function L1(n,e,t,r){if(t[0]=Le(t[0]),t[0]instanceof fs)return v6(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=ys(n.firestore);return _6(n._query,n.firestore._databaseId,i,e,t,r)}}function g6(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new x(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){_I(o,s);let c=[];for(let u of o)c.push(vI(r,n,u));a={arrayValue:{values:c}}}else a=vI(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&_I(o,s),a=N1(t,e,o,s==="in"||s==="not-in");return oe.create(i,s,a)}function y6(n,e,t){if(n.startAt!==null)throw new x(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new x(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ss(e,t)}function v6(n,e,t,r,i){if(!r)throw new x(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Uo(n))if(o.field.isKeyField())s.push(is(e,r.key));else{let a=r.data.field(o.field);if(Jh(a))throw new x(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new x(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Zn(s,i)}function _6(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new x(I.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new x(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!aS(n)&&c.indexOf("/")!==-1)throw new x(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(le.fromString(c));if(!U.isDocumentKey(d))throw new x(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new U(d);a.push(is(e,f))}else{let d=N1(t,r,c);a.push(d)}}return new Zn(a,s)}function vI(n,e,t){if(t=Le(t),typeof t=="string"){if(t==="")throw new x(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aS(e)&&t.indexOf("/")!==-1)throw new x(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(le.fromString(t));if(!U.isDocumentKey(r))throw new x(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return is(n,new U(r))}else{if(t instanceof Ie)return is(n,t._key);throw new x(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fc(t)}.`)}}function _I(n,e){if(!Array.isArray(n)||n.length===0)throw new x(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function S6(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function B1(n,e){let t=E6(n.filters,S6(e.op));if(t!==null)throw t===e.op?new x(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function b6(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)B1(t,i),t=lS(t,i)}function E6(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function C6(n){let e=n.filter(r=>r instanceof U_).length,t=n.filter(r=>r instanceof qh).length;if(e>1||e>0&&t>0)throw new x(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Zo=class{convertValue(e,t="none"){switch(rs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Me(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return gs(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Bo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Me(o.doubleValue));return new ec(s)}convertGeoPoint(e){return new hs(Me(e.latitude),Me(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=nS(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ml(e));default:return null}}convertTimestamp(e){let t=gr(e);return new Ve(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=le.fromString(e);H(FD(r));let i=new pi(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ff(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var G_=class extends Zo{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}};function j_(n){return w6(n,["next","error","complete"])}function w6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Sr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},un=class extends fs{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new bi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(hf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},bi=class extends un{data(e={}){return super.data(e)}},In=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Sr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bi(this._firestore,this._userDataWriter,r.key,r,new Sr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=T6(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function T6(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new bi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Sr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new bi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Sr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:A6(r.type),doc:i,oldIndex:s,newIndex:o}})}}function A6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function pf(n,e){return n instanceof un&&e instanceof un?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof In&&e instanceof In?n._firestore===e._firestore&&uf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function n0(n){n=ce(n,Ie);let e=ce(n.firestore,Pe),t=ot(e);return b1(t,n._key).then(r=>d0(e,n,r))}var br=class extends Zo{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}};function r0(n){n=ce(n,Ie);let e=ce(n.firestore,Pe),t=ot(e),r=new br(e);return zz(t,n._key).then(i=>new un(e,r,n._key,i,new Sr(i!==null&&i.hasLocalMutations,!0),n.converter))}function i0(n){n=ce(n,Ie);let e=ce(n.firestore,Pe),t=ot(e);return b1(t,n._key,{source:"server"}).then(r=>d0(e,n,r))}function s0(n){n=ce(n,ht);let e=ce(n.firestore,Pe),t=ot(e),r=new br(e);return F1(n._query),E1(t,n._query).then(i=>new In(e,r,n,i))}function o0(n){n=ce(n,ht);let e=ce(n.firestore,Pe),t=ot(e),r=new br(e);return Gz(t,n._query).then(i=>new In(e,r,n,i))}function a0(n){n=ce(n,ht);let e=ce(n.firestore,Pe),t=ot(e),r=new br(e);return E1(t,n._query,{source:"server"}).then(i=>new In(e,r,n,i))}function mf(n,e,t){n=ce(n,Ie);let r=ce(n.firestore,Pe),i=ff(n.converter,e,t),s=ys(r),a=df(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ze.none());return da(r,[a])}function gf(n,e,t,...r){n=ce(n,Ie);let i=ce(n.firestore,Pe),s=ys(i);e=Le(e);let o;typeof e=="string"||e instanceof An?o=$S(s,"updateDoc",n._key,e,t,r):o=jS(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,ze.exists(!0));return da(i,[a])}function l0(n){let e=ce(n.firestore,Pe),t=[new _i(n._key,ze.none())];return da(e,t)}function c0(n,e){let t=ce(n.firestore,Pe),r=ua(n),i=ff(n.converter,e),s=ys(n.firestore),a=df(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ze.exists(!1));return da(t,[a]).then(()=>r)}function yf(n,...e){var t,r,i;n=Le(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!j_(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(j_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof Ie)c=ce(n.firestore,Pe),u=ia(n._key.path),l={next:f=>{e[o]&&e[o](d0(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=ce(n,ht);c=ce(f.firestore,Pe),u=f._query;let v=new br(c);l={next:w=>{e[o]&&e[o](new In(c,v,f,w))},error:e[o+1],complete:e[o+2]},F1(n._query)}let d=ot(c);return Uz(d,u,a,l)}function u0(n,e){n=ce(n,Pe);let t=ot(n),r=j_(e)?e:{next:e};return $z(t,r)}function da(n,e){let t=ot(n);return jz(t,e)}function d0(n,e,t){let r=t.docs.get(e._key),i=new br(n);return new un(n,i,e._key,r,new Sr(t.hasPendingWrites,t.fromCache),e.converter)}var I6={maxAttempts:5};function D6(n){if(n.maxAttempts<1)throw new x(I.INVALID_ARGUMENT,"Max attempts must be at least 1")}var jh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ys(e)}set(e,t,r){this._verifyNotCommitted();let i=ci(e,this._firestore),s=ff(i.converter,t,r),o=df(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,ze.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=ci(e,this._firestore);t=Le(t);let o;return typeof t=="string"||t instanceof An?o=$S(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=jS(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ze.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ci(e,this._firestore);return this._mutations=this._mutations.concat(new _i(t._key,ze.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ci(n,e){if(n=Le(n),n.firestore!==e)throw new x(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var $_=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ys(e)}get(e){let t=ci(e,this._firestore),r=new G_(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return j();let s=i[0];if(s.isFoundDocument())return new fs(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new fs(this._firestore,r,t._key,null,t.converter);throw j()})}set(e,t,r){let i=ci(e,this._firestore),s=ff(i.converter,t,r),o=df(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=ci(e,this._firestore);t=Le(t);let o;return typeof t=="string"||t instanceof An?o=$S(this._dataReader,"Transaction.update",s._key,t,r,i):o=jS(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=ci(e,this._firestore);return this._transaction.delete(t._key),this}};var W_=class extends $_{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ci(e,this._firestore),r=new br(this._firestore);return super.get(e).then(i=>new un(this._firestore,r,t._key,i._document,new Sr(!1,!1),t.converter))}};function h0(n,e,t){n=ce(n,Pe);let r=Object.assign(Object.assign({},I6),t);D6(r);let i=ot(n);return Wz(i,s=>e(new W_(n,s)),r)}function f0(){return new tc("deleteField")}function p0(){return new P_("serverTimestamp")}function m0(...n){return new F_("arrayUnion",n)}function g0(...n){return new L_("arrayRemove",n)}function y0(n){return new B_("increment",n)}c6("node");var R6="@firebase/firestore-compat",k6="0.3.36";function C0(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new x("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function V1(){if(typeof Uint8Array>"u")throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function q1(){if(!UI())throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}var vf=class n{constructor(e){this._delegate=e}static fromBase64String(e){return q1(),new n(tr.fromBase64String(e))}static fromUint8Array(e){return V1(),new n(tr.fromUint8Array(e))}toBase64(){return q1(),this._delegate.toBase64()}toUint8Array(){return V1(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function v0(n){return x6(n,["next","error","complete"])}function x6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var _0=class{enableIndexedDbPersistence(e,t){return FS(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return LS(e._delegate)}clearIndexedDbPersistence(e){return BS(e._delegate)}},_f=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof pi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ln("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){af(this._delegate,e,t,r)}enableNetwork(){return qS(this._delegate)}disableNetwork(){return US(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,xS("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return VS(this._delegate)}onSnapshotsInSync(e){return u0(this._delegate,e)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new pa(this,lf(this._delegate,e))}catch(t){throw kt(t,"collection()","Firestore.collection()")}}doc(e){try{return new rr(this,ua(this._delegate,e))}catch(t){throw kt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Es(this,PS(this._delegate,e))}catch(t){throw kt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return h0(this._delegate,t=>e(new Sf(this,t)))}batch(){return ot(this._delegate),new bf(new jh(this._delegate,e=>da(this._delegate,e)))}loadBundle(e){return zS(this._delegate,e)}namedQuery(e){return GS(this._delegate,e).then(t=>t?new Es(this,t):null)}},ha=class extends Zo{constructor(e){super(),this.firestore=e}convertBytes(e){return new vf(new tr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return rr.forKey(t,this.firestore,null)}};function N6(n){K_(n)}var Sf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}get(e){let t=_s(e);return this._delegate.get(t).then(r=>new Ss(this._firestore,new un(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=_s(e);return r?(C0("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=_s(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=_s(e);return this._delegate.delete(t),this}},bf=class{constructor(e){this._delegate=e}set(e,t,r){let i=_s(e);return r?(C0("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=_s(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=_s(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},fa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new bi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new bs(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ha(e),t),i.set(t,s)),s}};fa.INSTANCES=new WeakMap;var rr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}static forPath(e,t,r){if(e.length%2!==0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Ie(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new Ie(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new pa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new pa(this.firestore,lf(this._delegate,e))}catch(t){throw kt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Le(e),e instanceof Ie?cf(this._delegate,e):!1}set(e,t){t=C0("DocumentReference.set",t);try{return t?mf(this._delegate,e,t):mf(this._delegate,e)}catch(r){throw kt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?gf(this._delegate,e):gf(this._delegate,e,t,...r)}catch(i){throw kt(i,"updateDoc()","DocumentReference.update()")}}delete(){return l0(this._delegate)}onSnapshot(...e){let t=U1(e),r=z1(e,i=>new Ss(this.firestore,new un(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return yf(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=r0(this._delegate):e?.source==="server"?t=i0(this._delegate):t=n0(this._delegate),t.then(r=>new Ss(this.firestore,new un(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function kt(n,e,t){return n.message=n.message.replace(e,t),n}function U1(n){for(let e of n)if(typeof e=="object"&&!v0(e))return e;return{}}function z1(n,e){var t,r;let i;return v0(n[0])?i=n[0]:v0(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Ss=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new rr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return pf(this._delegate,e._delegate)}},bs=class extends Ss{data(e){let t=this._delegate.data(e);return this._delegate._converter||bI(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Es=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ha(e)}where(e,t,r){try{return new n(this.firestore,nr(this._delegate,HS(e,t,r)))}catch(i){throw kt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,nr(this._delegate,QS(e,t)))}catch(r){throw kt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,nr(this._delegate,YS(e)))}catch(t){throw kt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,nr(this._delegate,JS(e)))}catch(t){throw kt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,nr(this._delegate,XS(...e)))}catch(t){throw kt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,nr(this._delegate,ZS(...e)))}catch(t){throw kt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,nr(this._delegate,e0(...e)))}catch(t){throw kt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,nr(this._delegate,t0(...e)))}catch(t){throw kt(t,"endAt()","Query.endAt()")}}isEqual(e){return uf(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=o0(this._delegate):e?.source==="server"?t=a0(this._delegate):t=s0(this._delegate),t.then(r=>new pc(this.firestore,new In(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=U1(e),r=z1(e,i=>new pc(this.firestore,new In(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return yf(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},S0=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new bs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},pc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Es(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new bs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new S0(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new bs(this._firestore,r))})}isEqual(e){return pf(this._delegate,e._delegate)}},pa=class n extends Es{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new rr(this.firestore,e):null}doc(e){try{return e===void 0?new rr(this.firestore,ua(this._delegate)):new rr(this.firestore,ua(this._delegate,e))}catch(t){throw kt(t,"doc()","CollectionReference.doc()")}}add(e){return c0(this._delegate,e).then(t=>new rr(this.firestore,t))}isEqual(e){return cf(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(fa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function _s(n){return ce(n,Ie)}var b0=class n{constructor(...e){this._delegate=new An(...e)}static documentId(){return new n(Qe.keyField().canonicalString())}isEqual(e){return e=Le(e),e instanceof An?this._delegate._internalPath.isEqual(e._internalPath):!1}};var E0=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=p0();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=f0();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=m0(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=g0(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=y0(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var O6={Firestore:_f,GeoPoint:hs,Timestamp:Ve,Blob:vf,Transaction:Sf,WriteBatch:bf,DocumentReference:rr,DocumentSnapshot:Ss,Query:Es,QueryDocumentSnapshot:bs,QuerySnapshot:pc,CollectionReference:pa,FieldPath:b0,FieldValue:E0,setLogLevel:N6,CACHE_SIZE_UNLIMITED:T1};function M6(n,e){n.INTERNAL.registerComponent(new Ni("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},O6)))}function P6(n){M6(n,(e,t)=>new _f(e,t,new _0)),n.registerVersion(R6,k6,"node")}P6(Ct);function F6(n,e=Tc){return new wr(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function G1(n,e){return F6(n,e)}function L6(n,e){return G1(n,e).pipe(Dc(void 0),Ac(),Ne(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function A0(n,e){return G1(n,e).pipe(Ne(t=>({payload:t,type:"query"})))}var Ef=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=W1(r,t);return new wf(i,s,this.afs)}snapshotChanges(){return L6(this.ref,this.afs.schedulers.outsideAngular).pipe(wt)}valueChanges(e={}){return this.snapshotChanges().pipe(Ne(({payload:t})=>e.idField?Lt(pt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Dn(this.ref.get(e)).pipe(wt)}};function Cf(n,e){return A0(n,e).pipe(Dc(void 0),Ac(),Ne(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function j1(n,e,t){return Cf(n,t).pipe(Ic((r,i)=>B6(r,i.map(s=>s.payload),e),[]),j0(),Ne(r=>r.map(i=>({type:i.type,payload:i}))))}function B6(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=V6(n,r))}),n}function w0(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function V6(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return w0(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return w0(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return w0(n,e.oldIndex,1);break}return n}function $1(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var wf=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Cf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ne(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Dc(void 0),Ac(),Ea(([r,i])=>i.length>0||!r),Ne(([,r])=>r),wt)}auditTrail(e){return this.stateChanges(e).pipe(Ic((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=$1(e);return j1(this.query,t,this.afs.schedulers.outsideAngular).pipe(wt)}valueChanges(e={}){return A0(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(t=>t.payload.docs.map(r=>e.idField?Lt(pt({},r.data()),{[e.idField]:r.id}):r.data())),wt)}get(e){return Dn(this.query.get(e)).pipe(wt)}add(e){return this.ref.add(e)}doc(e){return new Ef(this.ref.doc(e),this.afs)}},T0=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Cf(this.query,this.afs.schedulers.outsideAngular).pipe(wt):Cf(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ea(t=>t.length>0),wt)}auditTrail(e){return this.stateChanges(e).pipe(Ic((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=$1(e);return j1(this.query,t,this.afs.schedulers.outsideAngular).pipe(wt)}valueChanges(e={}){return A0(this.query,this.afs.schedulers.outsideAngular).pipe(Ne(r=>r.payload.docs.map(i=>e.idField?pt({[e.idField]:i.id},i.data()):i.data())),wt)}get(e){return Dn(this.query.get(e)).pipe(wt)}},q6=new De("angularfire2.enableFirestorePersistence"),U6=new De("angularfire2.firestore.persistenceSettings"),z6=new De("angularfire2.firestore.settings"),G6=new De("angularfire2.firestore.use-emulator");function W1(n,e=t=>t){return{query:e(n),ref:n}}var ma=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,f,v,w,A,T,F,R){this.schedulers=l;let L=La(t,a,r),B=u;d&&mp(L,a,f,w,A,T,v,F),[this.firestore,this.persistenceEnabled$]=Hc(`${L.name}.firestore`,"AngularFirestore",L.name,()=>{let $=a.runOutsideAngular(()=>L.firestore());if(s&&$.settings(s),B&&$.useEmulator(...B),i&&!Vc(o)){let X=()=>{try{return Dn($.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(S){return typeof console<"u"&&console.warn(S),Bt(!1)}};return[$,a.runOutsideAngular(X)]}else return[$,Bt(!1)]},[s,B,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=W1(i,r),a=this.schedulers.ngZone.run(()=>s);return new wf(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new T0(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ef(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ie(xs),ie(Ns,8),ie(q6,8),ie(z6,8),ie(Ar),ie(Kt),ie(sr),ie(U6,8),ie(G6,8),ie(Fb,8),ie(cp,8),ie(up,8),ie(dp,8),ie(hp,8),ie(fp,8),ie(pp,8),ie(xn,8))};static \u0275prov=Vt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var K1=(()=>{let e=class e{constructor(r){this.afs=r}loadData(){return this.afs.collection("Blog-categories").snapshotChanges().pipe(Ne(r=>r.map(i=>{let s=i.payload.doc.data();return{id:i.payload.doc.id,data:s}})))}};e.\u0275fac=function(i){return new(i||e)(ie(ma))},e.\u0275prov=Vt({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var $6=(n,e)=>["/category",n,e];function W6(n,e){if(n&1&&(N(0,"ul",3)(1,"li",4)(2,"a",5),V(3),D()()()),n&2){let t=e.$implicit;te(2),he("routerLink",Z0(2,$6,t.data.category,t.id)),te(),dn(t.data.category)}}var H1=(()=>{let e=class e{constructor(r){this.categoryService=r,this.categoryArray=[]}ngOnInit(){this.categoryService.loadData().subscribe(r=>{this.categoryArray=r})}};e.\u0275fac=function(i){return new(i||e)(ge(K1))},e.\u0275cmp=be({type:e,selectors:[["app-category-navbar"]],standalone:!0,features:[Ee],decls:3,vars:1,consts:[[1,"navbar","navbar-expand-lg","fixed-top"],[1,"collapse","navbar-collapse","justify-content-center"],["class","navbar-nav",4,"ngFor","ngForOf"],[1,"navbar-nav"],[1,"nav-item","ml-3"],[1,"nav-link",3,"routerLink"]],template:function(i,s){i&1&&(N(0,"nav",0)(1,"div",1),rt(2,W6,4,5,"ul",2),D()()),i&2&&(te(2),he("ngForOf",s.categoryArray))},dependencies:[Ht,Dr,Rs],styles:["nav[_ngcontent-%COMP%]{margin-top:100px;height:50px;background-color:var(--navbar-footer-color)}.nav-link[_ngcontent-%COMP%]{text-transform:uppercase}"]});let n=e;return n})();var Q1=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-footer"]],standalone:!0,features:[Ee],decls:22,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-md-12","text-center"],[1,"site-logo"],[1,"nav","justify-content-center"],[1,"nav-item"],["href","",1,"nav-link"],[1,"mb-2","mt-2"]],template:function(i,s){i&1&&(N(0,"footer")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),V(5,"AberRange Innovate"),D(),N(6,"div")(7,"ul",4)(8,"li",5)(9,"a",6),V(10,"Home"),D()(),N(11,"li",5)(12,"a",6),V(13,"About Us"),D()(),N(14,"li",5)(15,"a",6),V(16,"Terms and conditions"),D()(),N(17,"li",5)(18,"a",6),V(19,"Contact"),D()()()(),N(20,"p",7),V(21,"Copyright \xA9 2021 AberRange Solutions"),D()()()()())},styles:["footer[_ngcontent-%COMP%]{height:130px;padding:15px;background-color:var(--navbar-footer-color)}.site-logo[_ngcontent-%COMP%]{font-size:1.2em}"]});let n=e;return n})();var K6=n=>["/post",n];function H6(n,e){n&1&&(N(0,"small",9),V(1,"Featured"),D())}function Q6(n,e){if(n&1&&(N(0,"div",1),ye(1,"img",2),N(2,"div",3)(3,"small",4),V(4),D(),rt(5,H6,2,0,"small",5),N(6,"small",6),V(7),D(),N(8,"h3",7),V(9),D(),N(10,"p"),V(11),D(),N(12,"small",8),V(13),Mc(14,"date"),D()()()),n&2){let t=Ts();he("routerLink",Da(10,K6,t.postData.id)),te(),Oc("src",t.postData.data.postImgPath,Nc),te(3),dn(t.postData.data.category.category),te(),he("ngIf",t.postData.data.isFeatured),te(2),As("Views - ",t.postData.data.views,""),te(2),dn(t.postData.data.title),te(2),dn(t.postData.data.excerpt),te(2),As("Last Updated - ",Pc(14,8,t.postData.data.createdAt.toMillis()),"")}}var ga=(()=>{let e=class e{constructor(){}ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-post-card"]],inputs:{postData:"postData"},standalone:!0,features:[Ee],decls:1,vars:1,consts:[["class","card shadow-effect",3,"routerLink",4,"ngIf"],[1,"card","shadow-effect",3,"routerLink"],["alt","post-image",1,"card-img-top",3,"src"],[1,"card-body"],[1,"bg-light","text-danger","text-center"],["class","bg-light text-success text-center ml-3",4,"ngIf"],[1,"bg-light","text-info","text-center","ml-3"],[1,"mt-1"],[1,"bg-light","text-warning","text-center","ml-3"],[1,"bg-light","text-success","text-center","ml-3"]],template:function(i,s){i&1&&rt(0,Q6,15,12,"div",0),i&2&&he("ngIf",s.postData)},dependencies:[Ht,Ds,Bc,Rs],styles:[".card[_ngcontent-%COMP%]{max-width:400px;min-height:550px}"]});let n=e;return n})();var iR=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(ge(jf),ge(Gf))},e.\u0275dir=Wt({type:e});let n=e;return n})(),Y6=(()=>{let e=class e extends iR{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=xc(e)))(s||e)}})(),e.\u0275dir=Wt({type:e,features:[ir]});let n=e;return n})(),sR=new De("");var J6={provide:sR,useExisting:ws(()=>Nf),multi:!0};function X6(){let n=Hf()?Hf().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Z6=new De(""),Nf=(()=>{let e=class e extends iR{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!X6())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(ge(jf),ge(Gf),ge(Z6,8))},e.\u0275dir=Wt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Ia("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[Is([J6]),ir]});let n=e;return n})();function oR(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}var Of=new De(""),aR=new De(""),eG=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function tG(n){return oR(n.value)?{required:!0}:null}function nG(n){return oR(n.value)||eG.test(n.value)?null:{email:!0}}function Y1(n){return null}function lR(n){return n!=null}function cR(n){return eb(n)?Dn(n):n}function uR(n){let e={};return n.forEach(t=>{e=t!=null?pt(pt({},e),t):e}),Object.keys(e).length===0?null:e}function dR(n,e){return e.map(t=>t(n))}function rG(n){return!n.validate}function hR(n){return n.map(e=>rG(e)?e:t=>e.validate(t))}function iG(n){if(!n)return null;let e=n.filter(lR);return e.length==0?null:function(t){return uR(dR(t,e))}}function R0(n){return n!=null?iG(hR(n)):null}function sG(n){if(!n)return null;let e=n.filter(lR);return e.length==0?null:function(t){let r=dR(t,e).map(cR);return z0(r).pipe(Ne(uR))}}function k0(n){return n!=null?sG(hR(n)):null}function J1(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function oG(n){return n._rawValidators}function aG(n){return n._rawAsyncValidators}function D0(n){return n?Array.isArray(n)?n:[n]:[]}function Af(n,e){return Array.isArray(n)?n.includes(e):n===e}function X1(n,e){let t=D0(e);return D0(n).forEach(i=>{Af(t,i)||t.push(i)}),t}function Z1(n,e){return D0(e).filter(t=>!Af(n,t))}var If=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=R0(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=k0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},_a=class extends If{get formDirective(){return null}get path(){return null}},bc=class extends If{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Df=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},lG={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},_K=Lt(pt({},lG),{"[class.ng-submitted]":"isSubmitted"}),fR=(()=>{let e=class e extends Df{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(ge(bc,2))},e.\u0275dir=Wt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&$f("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[ir]});let n=e;return n})(),pR=(()=>{let e=class e extends Df{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(ge(_a,10))},e.\u0275dir=Wt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&$f("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[ir]});let n=e;return n})();var gc="VALID",Tf="INVALID",ya="PENDING",yc="DISABLED",Sa=class{},Rf=class extends Sa{constructor(e,t){super(),this.value=e,this.source=t}},_c=class extends Sa{constructor(e,t){super(),this.pristine=e,this.source=t}},Sc=class extends Sa{constructor(e,t){super(),this.touched=e,this.source=t}},va=class extends Sa{constructor(e,t){super(),this.status=e,this.source=t}};function mR(n){return(Mf(n)?n.validators:n)||null}function cG(n){return Array.isArray(n)?R0(n):n||null}function gR(n,e){return(Mf(e)?e.asyncValidators:n)||null}function uG(n){return Array.isArray(n)?k0(n):n||null}function Mf(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function dG(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Rc(1e3,"");if(!r[t])throw new Rc(1001,"")}function hG(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Rc(1002,"")})}var kf=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Ra(()=>this.statusReactive()),this.statusReactive=Aa(void 0),this._pristine=Ra(()=>this.pristineReactive()),this.pristineReactive=Aa(!0),this._touched=Ra(()=>this.touchedReactive()),this.touchedReactive=Aa(!1),this._events=new wc,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Ir(this.statusReactive)}set status(e){Ir(()=>this.statusReactive.set(e))}get valid(){return this.status===gc}get invalid(){return this.status===Tf}get pending(){return this.status==ya}get disabled(){return this.status===yc}get enabled(){return this.status!==yc}get pristine(){return Ir(this.pristineReactive)}set pristine(e){Ir(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Ir(this.touchedReactive)}set touched(e){Ir(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(X1(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(X1(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Z1(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Z1(e,this._rawAsyncValidators))}hasValidator(e){return Af(this._rawValidators,e)}hasAsyncValidator(e){return Af(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Lt(pt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Sc(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Sc(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Lt(pt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new _c(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new _c(!0,r))}markAsPending(e={}){this.status=ya;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new va(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Lt(pt({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=yc,this.errors=null,this._forEachChild(i=>{i.disable(Lt(pt({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Rf(this.value,r)),this._events.next(new va(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Lt(pt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=gc,this._forEachChild(r=>{r.enable(Lt(pt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Lt(pt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===gc||this.status===ya)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Rf(this.value,t)),this._events.next(new va(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Lt(pt({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?yc:gc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=ya,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=cR(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new va(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new Ta,this.statusChanges=new Ta}_calculateStatus(){return this._allControlsDisabled()?yc:this.errors?Tf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ya)?ya:this._anyControlsHaveStatus(Tf)?Tf:gc}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new _c(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Sc(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Mf(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=cG(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=uG(this._rawAsyncValidators)}},xf=class extends kf{constructor(e,t,r){super(mR(t),gR(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){hG(this,!0,e),Object.keys(e).forEach(r=>{dG(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var x0=new De("CallSetDisabledState",{providedIn:"root",factory:()=>N0}),N0="always";function fG(n,e){return[...e.path,n]}function yR(n,e,t=N0){vR(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),mG(n,e),yG(n,e),gG(n,e),pG(n,e)}function eR(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function pG(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function vR(n,e){let t=oG(n);e.validator!==null?n.setValidators(J1(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=aG(n);e.asyncValidator!==null?n.setAsyncValidators(J1(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();eR(e._rawValidators,i),eR(e._rawAsyncValidators,i)}function mG(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&_R(n,e)})}function gG(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&_R(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function _R(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function yG(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function vG(n,e){n==null,vR(n,e)}function _G(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function SG(n){return Object.getPrototypeOf(n.constructor)===Y6}function bG(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function EG(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Nf?t=s:SG(s)?r=s:i=s}),i||r||t||null}var CG={provide:_a,useExisting:ws(()=>O0)},vc=Promise.resolve(),O0=(()=>{let e=class e extends _a{get submitted(){return Ir(this.submittedReactive)}constructor(r,i,s){super(),this.callSetDisabledState=s,this._submitted=Ra(()=>this.submittedReactive()),this.submittedReactive=Aa(!1),this._directives=new Set,this.ngSubmit=new Ta,this.form=new xf({},R0(r),k0(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){vc.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),yR(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){vc.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){vc.then(()=>{let i=this._findContainer(r.path),s=new xf({});vG(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){vc.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){vc.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submittedReactive.set(!0),bG(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(ge(Of,10),ge(aR,10),ge(x0,8))},e.\u0275dir=Wt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Ia("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Is([CG]),ir]});let n=e;return n})();function tR(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function nR(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var wG=class extends kf{constructor(e=null,t,r){super(mR(t),gR(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Mf(t)&&(t.nonNullable||t.initialValueIsDefault)&&(nR(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){tR(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){tR(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){nR(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var TG={provide:bc,useExisting:ws(()=>M0)},rR=Promise.resolve(),M0=(()=>{let e=class e extends bc{constructor(r,i,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new wG,this._registered=!1,this.name="",this.update=new Ta,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=EG(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),_G(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){yR(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){rR.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Lc(i);rR.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?fG(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(ge(_a,9),ge(Of,10),ge(aR,10),ge(sR,10),ge(nb,8),ge(x0,8))},e.\u0275dir=Wt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Is([TG]),ir,zf]});let n=e;return n})(),SR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Wt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var bR=(()=>{let e=class e{constructor(){this._validator=Y1}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Y1,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Wt({type:e,features:[zf]});let n=e;return n})();var AG={provide:Of,useExisting:ws(()=>P0),multi:!0};var P0=(()=>{let e=class e extends bR{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Lc,this.createValidator=r=>tG}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=xc(e)))(s||e)}})(),e.\u0275dir=Wt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&J0("required",s._enabled?"":null)},inputs:{required:"required"},features:[Is([AG]),ir]});let n=e;return n})();var IG={provide:Of,useExisting:ws(()=>F0),multi:!0},F0=(()=>{let e=class e extends bR{constructor(){super(...arguments),this.inputName="email",this.normalizeInput=Lc,this.createValidator=r=>nG}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=xc(e)))(s||e)}})(),e.\u0275dir=Wt({type:e,selectors:[["","email","","formControlName",""],["","email","","formControl",""],["","email","","ngModel",""]],inputs:{email:"email"},features:[Is([IG]),ir]});let n=e;return n})();var DG=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ki({type:e}),e.\u0275inj=Ri({});let n=e;return n})();var Pf=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:x0,useValue:r.callSetDisabledState??N0}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ki({type:e}),e.\u0275inj=Ri({imports:[DG]});let n=e;return n})();var ER=(()=>{let e=class e{constructor(r){this.afs=r}addSubs(r){this.afs.collection("subscribers").add(r).then(()=>{})}checkSubs(r){return this.afs.collection("subscribers",i=>i.where("email","==",r)).get()}};e.\u0275fac=function(i){return new(i||e)(ie(ma))},e.\u0275prov=Vt({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var CR=n=>({"is-invalid":n});function xG(n,e){n&1&&(N(0,"div",10),V(1," You are already a subscriber! Stay tuned for updates. "),D())}function NG(n,e){n&1&&(N(0,"div",11),V(1," Thank you for subscribing! Stay tuned for timely updates!. "),D())}function OG(n,e){n&1&&(N(0,"div"),V(1,"Name is Required"),D())}function MG(n,e){if(n&1&&(N(0,"div",20),rt(1,OG,2,0,"div",21),D()),n&2){Ts();let t=xi(5);te(),he("ngIf",t.errors==null?null:t.errors.required)}}function PG(n,e){n&1&&(N(0,"div"),V(1,"Email is Required"),D())}function FG(n,e){n&1&&(N(0,"div"),V(1,"Please enter a valid email address"),D())}function LG(n,e){if(n&1&&(N(0,"div",20),rt(1,PG,2,0,"div",21)(2,FG,2,0,"div",21),D()),n&2){Ts();let t=xi(9);te(),he("ngIf",t.errors==null?null:t.errors.required),te(),he("ngIf",t.errors==null?null:t.errors.email)}}function BG(n,e){if(n&1){let t=X0();N(0,"form",12,0),Ia("ngSubmit",function(){H0(t);let i=xi(1),s=Ts();return Q0(s.onSubmit(i.value))}),N(2,"div",13)(3,"div",14),ye(4,"input",15,1),rt(6,MG,2,1,"div",16),D(),N(7,"div",14),ye(8,"input",17,2),rt(10,LG,3,2,"div",16),D(),N(11,"div",18)(12,"button",19),V(13," Subscribe "),D()()()()}if(n&2){let t=xi(1),r=xi(5),i=xi(9);te(4),he("ngClass",Da(5,CR,r.touched&&r.invalid)),te(2),he("ngIf",r.touched&&r.invalid),te(2),he("ngClass",Da(7,CR,i.touched&&i.invalid)),te(2),he("ngIf",i.touched&&i.invalid),te(2),he("disabled",t.invalid)}}var wR=(()=>{let e=class e{constructor(r){this.subService=r,this.isEmailError=!1,this.isSubscribed=!1}onSubmit(r){let i={name:r.name,email:r.email};this.subService.checkSubs(i.email).subscribe(s=>{s.empty?(this.subService.addSubs(i),this.isSubscribed=!0):this.isEmailError=!0})}};e.\u0275fac=function(i){return new(i||e)(ge(ER))},e.\u0275cmp=be({type:e,selectors:[["app-subscription-form"]],standalone:!0,features:[Ee],decls:10,vars:3,consts:[["subForm","ngForm"],["Name","ngModel"],["Email","ngModel"],[1,"card","shadow-effect"],[1,"card-body"],[1,"text-center","mt-3","mb-5"],[1,"m-auto","subs-text"],["class","alert alert-danger mt-3",4,"ngIf"],["class","alert alert-success mt-3",4,"ngIf"],["class","form-inline mb-5 mt-5",3,"ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mt-3"],[1,"alert","alert-success","mt-3"],[1,"form-inline","mb-5","mt-5",3,"ngSubmit"],[1,"row"],[1,"form-group","col-md-5"],["type","text","placeholder","Your name","name","name","ngModel","","required","",1,"form-control","shadow-effect",3,"ngClass"],["class","text-danger",4,"ngIf"],["type","email","placeholder","Email Address","name","email","ngModel","","required","","email","",1,"form-control","shadow-effect",3,"ngClass"],[1,"col-md-2"],["type","submit",1,"btn","btn-info","btn-block","btn-theme",3,"disabled"],[1,"text-danger"],[4,"ngIf"]],template:function(i,s){i&1&&(N(0,"div",3)(1,"div",4)(2,"div",5)(3,"h3"),V(4,"Subscription Form"),D(),N(5,"p",6),V(6," Subscribe to our newsletter and never miss out on the latest articles, tips, and exclusive content from AberRange Innovate. Join our community and get insights delivered straight to your inbox! "),D(),rt(7,xG,2,0,"div",7)(8,NG,2,0,"div",8)(9,BG,14,9,"form",9),D()()()),i&2&&(te(7),he("ngIf",s.isEmailError),te(),he("ngIf",s.isSubscribed),te(),he("ngIf",!s.isSubscribed))},dependencies:[Pf,SR,Nf,fR,pR,P0,F0,M0,O0,Ht,ib,Ds],styles:[".card[_ngcontent-%COMP%]{background-color:var(--secondary-color)}input[_ngcontent-%COMP%]   [type=text][_ngcontent-%COMP%], input[_ngcontent-%COMP%]   [type=email][_ngcontent-%COMP%]{width:100%}.subs-text[_ngcontent-%COMP%]{width:500px}"]});let n=e;return n})();var ba=(()=>{let e=class e{constructor(r){this.afs=r}loadFeaturedData(){return this.afs.collection("posts",r=>r.where("isFeatured","==",!0).limit(4)).snapshotChanges().pipe(Ne(r=>r.map(i=>{let s=i.payload.doc.data();return{id:i.payload.doc.id,data:s}})),Ca(r=>(console.error("Error loading posts:",r),Bt([]))))}loadLatest(){return this.afs.collection("posts",r=>r.orderBy("createdAt")).snapshotChanges().pipe(Ne(r=>r.map(i=>{let s=i.payload.doc.data();return{id:i.payload.doc.id,data:s}})),Ca(r=>(console.error("Error loading posts:",r),Bt([]))))}loadCategoryPosts(r){return this.afs.collection("posts",i=>i.where("category.categoryId","==",r).limit(4)).snapshotChanges().pipe(Ne(i=>i.map(s=>{let o=s.payload.doc.data();return{id:s.payload.doc.id,data:o}})),Ca(i=>(console.error("Error loading posts:",i),Bt([]))))}loadSinglePost(r){return this.afs.doc(`posts/${r}`).valueChanges()}loadSimilarPosts(r){return this.afs.collection("posts",i=>i.where("category.categoryId","==",r).limit(4)).snapshotChanges().pipe(Ne(i=>i.map(s=>{let o=s.payload.doc.data();return{id:s.payload.doc.id,data:o}})),Ca(i=>(console.error("Error loading posts:",i),Bt([]))))}countViews(r){let i={views:Ct.firestore.FieldValue.increment(1)};this.afs.doc(`posts/${r}`).update(i).then(()=>{})}};e.\u0275fac=function(i){return new(i||e)(ie(ma))},e.\u0275prov=Vt({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function VG(n,e){if(n&1&&(N(0,"div",9),ye(1,"app-post-card",10),D()),n&2){let t=e.$implicit;te(),he("postData",t)}}function qG(n,e){if(n&1&&(N(0,"div",11),ye(1,"app-post-card",10),D()),n&2){let t=e.$implicit;te(),he("postData",t)}}var TR=(()=>{let e=class e{constructor(r){this.postService=r,this.featuredPostsArray=[],this.latestPostArray=[],this.postService.loadFeaturedData().subscribe(i=>{this.featuredPostsArray=i}),this.postService.loadLatest().subscribe(i=>{this.latestPostArray=i})}ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)(ge(ba))},e.\u0275cmp=be({type:e,selectors:[["app-home"]],standalone:!0,features:[Ee],decls:18,vars:2,consts:[[1,"featured-section"],[1,"container-fluid"],[1,"row"],[1,"col-md-12","text-center","mt-5"],[1,"text-white"],["class","col-lg-3",4,"ngFor","ngForOf"],[1,"container","mt-5"],[1,"col-md-12","text-center"],["class","col-md-4 mt-3",4,"ngFor","ngForOf"],[1,"col-lg-3"],[3,"postData"],[1,"col-md-4","mt-3"]],template:function(i,s){i&1&&(N(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),V(5,"Featured Posts"),D(),N(6,"p",4),V(7," Unlock the secrets to building a strong social media presence with our comprehensive guide. "),D()()(),N(8,"div",2),rt(9,VG,2,1,"div",5),D()()(),N(10,"section",6)(11,"div",7)(12,"h2"),V(13,"Latest Posts"),D(),N(14,"p"),V(15,"Capturing Life's Special Moments: Event Photography Essentials"),D()(),N(16,"div",2),rt(17,qG,2,1,"div",8),D()()),i&2&&(te(9),he("ngForOf",s.featuredPostsArray),te(8),he("ngForOf",s.latestPostArray))},dependencies:[ga,Ht,Dr],styles:[".featured-section[_ngcontent-%COMP%]{padding-left:130px;padding-right:130px;padding-bottom:130px;background-color:var(--primary-color)}.card[_ngcontent-%COMP%]{max-width:400px;min-height:550px}"]});let n=e;return n})();var AR=(()=>{let e=class e{constructor(){this.title="aberrange-innovate"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-root"]],standalone:!0,features:[Ee],decls:8,vars:0,consts:[[1,"app-body"],[1,"container","mt-5","mb-5"],[1,"row","justify-content-center"]],template:function(i,s){i&1&&(ye(0,"app-header")(1,"app-category-navbar"),N(2,"div",0),ye(3,"router-outlet"),D(),N(4,"div",1)(5,"div",2),ye(6,"app-subscription-form"),D()(),ye(7,"app-footer"))},dependencies:[cb,vb,H1,Q1,wR],styles:[".app-body[_ngcontent-%COMP%]{min-height:55vh;margin-top:150px}"]});let n=e;return n})();function zG(n,e){if(n&1&&(N(0,"div",5),ye(1,"app-post-card",6),D()),n&2){let t=e.$implicit;te(),he("postData",t)}}var IR=(()=>{let e=class e{constructor(r,i){this.route=r,this.postService=i,this.postsArray=[]}ngOnInit(){this.route.params.subscribe(r=>{this.categoryObject=r,this.postService.loadCategoryPosts(r.id).subscribe(i=>{this.postsArray=i})})}};e.\u0275fac=function(i){return new(i||e)(ge(qc),ge(ba))},e.\u0275cmp=be({type:e,selectors:[["app-single-category"]],standalone:!0,features:[Ee],decls:9,vars:2,consts:[[1,"bg-theme","text-white"],[1,"container"],[1,"container","mt-5","mb-5"],[1,"row"],["class","col-md-4 mb-3",4,"ngFor","ngForOf"],[1,"col-md-4","mb-3"],[3,"postData"]],template:function(i,s){i&1&&(N(0,"div",0)(1,"div",1)(2,"h1"),V(3),D(),N(4,"p"),V(5," Creating promotional content that resonates with your audience is key to any successful marketing strategy. "),D()()(),N(6,"div",2)(7,"div",3),rt(8,zG,2,1,"div",4),D()()),i&2&&(te(3),dn(s.categoryObject.category),te(5),he("ngForOf",s.postsArray))},dependencies:[ga,Ht,Dr]});let n=e;return n})();var DR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-comment-form"]],standalone:!0,features:[Ee],decls:17,vars:0,consts:[[1,"card","mt-5","shadow-effect"],[1,"card-body"],[1,"form-group"],["for",""],["type","text","placeholder","Enter your name here",1,"form-control","shadow-effect"],["cols","30","rows","10","placeholder","Add your comment here",1,"form-control","shadow-effect"],[1,"btn","btn-info","btn-theme","mt-3"]],template:function(i,s){i&1&&(N(0,"div",0)(1,"div",1)(2,"h4"),V(3,"Leave a Comment"),D(),N(4,"p"),V(5,"please leave your comment and share your insights"),D(),N(6,"form")(7,"div",2)(8,"label",3),V(9,"Name"),D(),ye(10,"input",4),D(),N(11,"div",2)(12,"label",3),V(13,"Comment"),D(),ye(14,"textarea",5),D(),N(15,"button",6),V(16,"Add Comment"),D()()()())}});let n=e;return n})();var RR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-comment-list"]],standalone:!0,features:[Ee],decls:40,vars:0,consts:[[1,"card","mb-5","mt","5","pb","5","shadow-effect"],[1,"card-body"],[1,"mt-3","mb-3"],[1,"comment-box","mt-3"],[1,"mb-0"],[1,"text-danger"],["href","#",1,"mt-1"],["href","#",1,"mt-1","ml-3"]],template:function(i,s){i&1&&(N(0,"div",0)(1,"div",1)(2,"h4",2),V(3,"Comments (15,500)"),D(),N(4,"div",3)(5,"h6",4),V(6,"Melvin Joseph"),D(),N(7,"small",5),V(8,"Last Updated - July 14, 2024"),D(),N(9,"div",2),V(10," Great read! I particularly enjoyed the section on event photography. The tips on lighting and composition were really helpful. Looking forward to more posts like this. "),D(),N(11,"a",6),V(12,"Reply"),D(),N(13,"a",7),V(14,"View Reply"),D(),ye(15,"hr"),D(),N(16,"div",3)(17,"h6",4),V(18,"Melvin Joseph"),D(),N(19,"small",5),V(20,"Last Updated - July 14, 2024"),D(),N(21,"div",2),V(22," Great read! I particularly enjoyed the section on event photography. The tips on lighting and composition were really helpful. Looking forward to more posts like this. "),D(),N(23,"a",6),V(24,"Reply"),D(),N(25,"a",7),V(26,"View Reply"),D(),ye(27,"hr"),D(),N(28,"div",3)(29,"h6",4),V(30,"Melvin Joseph"),D(),N(31,"small",5),V(32,"Last Updated - July 14, 2024"),D(),N(33,"div",2),V(34," Great read! I particularly enjoyed the section on event photography. The tips on lighting and composition were really helpful. Looking forward to more posts like this. "),D(),N(35,"a",6),V(36,"Reply"),D(),N(37,"a",7),V(38,"View Reply"),D(),ye(39,"hr"),D()()())},styles:[".comment-box[_ngcontent-%COMP%]{padding:15px 35px;background-color:#f0f0f0}"]});let n=e;return n})();function GG(n,e){n&1&&(N(0,"small",14),V(1,"Featured"),D())}function jG(n,e){if(n&1&&(N(0,"div"),ye(1,"app-post-card",15),D()),n&2){let t=e.$implicit;te(),he("postData",t)}}var kR=(()=>{let e=class e{constructor(r,i){this.route=r,this.postService=i,this.similarPostArray=[]}ngOnInit(){this.route.params.subscribe(r=>{this.postService.countViews(r.id),this.postService.loadSinglePost(r.id).subscribe(i=>{this.postData=i,this.loadSimilarPost(this.postData.category.categoryId)})})}loadSimilarPost(r){this.postService.loadSimilarPosts(r).subscribe(i=>{this.similarPostArray=i})}};e.\u0275fac=function(i){return new(i||e)(ge(qc),ge(ba))},e.\u0275cmp=be({type:e,selectors:[["app-single-post"]],standalone:!0,features:[Ee],decls:21,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-9"],[1,"card","shadow-effect"],["alt","",1,"card-img-top","img-fluid",3,"src"],[1,"card-body"],[1,"bg-light","text-danger","text-center"],["class","bg-light text-success text-center ml-2",4,"ngIf"],[1,"bg-light","text-info","text-center","ml-2"],[1,"bg-light","text-warning","text-center","ml-2"],[1,"mt-3","mb-3"],[3,"innerHtml"],[1,"col-md-3"],[4,"ngFor","ngForOf"],[1,"bg-light","text-success","text-center","ml-2"],[3,"postData"]],template:function(i,s){i&1&&(N(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),ye(4,"img",4),N(5,"div",5)(6,"small",6),V(7),D(),rt(8,GG,2,0,"small",7),N(9,"small",8),V(10),D(),N(11,"small",9),V(12),Mc(13,"date"),D(),N(14,"h1",10),V(15),D(),ye(16,"p",11),D()(),ye(17,"app-comment-form")(18,"app-comment-list"),D(),N(19,"div",12),rt(20,jG,2,1,"div",13),D()()()),i&2&&(te(4),Oc("src",s.postData.postImgPath,Nc),te(3),dn(s.postData.category.category),te(),he("ngIf",s.postData.isFeatured),te(2),As("Views-",s.postData.views,""),te(2),As("Last Updated - ",Pc(13,8,s.postData.createdAt.toMillis()),""),te(3),dn(s.postData.title),te(),he("innerHtml",s.postData.content,Y0),te(4),he("ngForOf",s.similarPostArray))},dependencies:[ga,DR,RR,Ht,Dr,Ds,Bc]});let n=e;return n})();var xR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-about-us"]],standalone:!0,features:[Ee],decls:32,vars:0,consts:[[1,"mt-5"],[1,"container","mt-5","mb-5","p-5","bg-theme"],[1,"text-white","text-center"],[1,"p-5","mt-4","bg-secondary-theme","text-theme-primary"],[1,"text-center"],[1,"btn","btn-info","btn-sm","btn-theme","mt-4"]],template:function(i,s){i&1&&(N(0,"section",0)(1,"div",1)(2,"h1",2),V(3,"About Us"),D(),N(4,"div",3)(5,"p"),V(6,"Welcome to AberRange Media, where creativity meets innovation. Our mission is to help you capture and celebrate the most significant moments of your life through our comprehensive range of media services. We are passionate about storytelling and committed to delivering high-quality content that resonates with your audience."),D(),N(7,"p")(8,"b"),V(9,"Our Story"),D(),V(10," Founded in 2024, AberRange Media started as a small team of enthusiastic photographers and videographers. Over the years, we've grown into a full-fledged media company, offering a wide array of services to cater to your every need. From capturing the magic of weddings and birthdays to creating impactful promotional content and managing your social media presence, we are dedicated to making your vision a reality."),D(),N(11,"p")(12,"b"),V(13,"Our Team"),D(),V(14," Our team of skilled professionals brings a wealth of experience and creativity to every project. We work collaboratively with our clients to understand their vision and deliver results that exceed expectations. Our passion for storytelling and attention to detail set us apart in the industry."),D(),N(15,"p")(16,"b"),V(17,"Why Choose Us?"),D(),ye(18,"br"),N(19,"li"),V(20,"Expertise: Years of experience in the media industry with a proven track record of successful projects."),D(),N(21,"li"),V(22,"Quality: Commitment to high standards of quality in every piece of content we create."),D(),N(23,"li"),V(24,"Innovation: Utilization of the latest technology and creative techniques to deliver outstanding results."),D(),N(25,"li"),V(26,"Customer-Centric Approach: We prioritize our clients' needs and work closely with them to achieve their goals."),D()(),N(27,"p"),V(28,"Thank you for considering AberRange Media for your media needs. We look forward to partnering with you to create beautiful, memorable, and impactful content."),D(),N(29,"div",4)(30,"button",5),V(31,"Back top"),D()()()()())}});let n=e;return n})();var NR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-terms-and-conditions"]],standalone:!0,features:[Ee],decls:20,vars:0,consts:[[1,"mt-5"],[1,"container","mt-5","mb-5","p-5","bg-theme"],[1,"text-white","text-center"],[1,"p-5","mt-4","bg-secondary-theme","text-theme-primary"],[1,"text-center"],[1,"btn","btn-info","btn-sm","btn-theme","mt-4"]],template:function(i,s){i&1&&(N(0,"section",0)(1,"div",1)(2,"h1",2),V(3,"Terms and Conditions"),D(),N(4,"div",3)(5,"p"),V(6,"Welcome to AberRange Media, where creativity meets innovation. Our mission is to help you capture and celebrate the most significant moments of your life through our comprehensive range of media services. We are passionate about storytelling and committed to delivering high-quality content that resonates with your audience."),D(),N(7,"p")(8,"b"),V(9,"Our Story"),D(),V(10," Founded in 2024, AberRange Media started as a small team of enthusiastic photographers and videographers. Over the years, we've grown into a full-fledged media company, offering a wide array of services to cater to your every need. From capturing the magic of weddings and birthdays to creating impactful promotional content and managing your social media presence, we are dedicated to making your vision a reality."),D(),N(11,"p")(12,"b"),V(13,"Our Team"),D(),V(14," Our team of skilled professionals brings a wealth of experience and creativity to every project. We work collaboratively with our clients to understand their vision and deliver results that exceed expectations. Our passion for storytelling and attention to detail set us apart in the industry."),D(),N(15,"p"),V(16,"Thank you for considering AberRange Media for your media needs. We look forward to partnering with you to create beautiful, memorable, and impactful content."),D(),N(17,"div",4)(18,"button",5),V(19,"Back top"),D()()()()())}});let n=e;return n})();var OR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=be({type:e,selectors:[["app-contact-us"]],standalone:!0,features:[Ee],decls:2,vars:0,template:function(i,s){i&1&&(N(0,"p"),V(1,"contact-us works!"),D())}});let n=e;return n})();var MR=[{path:"",component:TR},{path:"category/:category/:id",component:IR},{path:"post/:id",component:kR},{path:"about",component:xR},{path:"term-conditions",component:NR},{path:"contact",component:OR}];var BH=Bf(qR(),1);var $9="auth";var Ff=class{constructor(){return Oa($9)}};var Ec=class{constructor(e){return e}},PR="firestore",B0=class{constructor(){return Oa(PR)}};var V0=new De("angularfire2.firestore-instances");function W9(n,e){let t=ep(PR,n,e);return t&&new Ec(t)}function K9(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Ec(r)}}var H9={provide:B0,deps:[[new Rn,V0]]},Q9={provide:Ec,useFactory:W9,deps:[[new Rn,V0],Mi]};function FR(n,...e){return Et("angularfire",hn.full,"fst"),kc([Q9,H9,{provide:V0,useFactory:K9(n),multi:!0,deps:[Kt,wa,sr,Pa,[new Rn,Ff],[new Rn,xn],...e]}])}var LR=Ma(A1,!0);var q0={apiKey:"AIzaSyCa2gfcSj6hZ5csUS6Zoh-_Xuvuv0bho34",authDomain:"range-blogs.firebaseapp.com",projectId:"range-blogs",storageBucket:"range-blogs.appspot.com",messagingSenderId:"249262928048",appId:"1:249262928048:web:273920d3c79be929900b75"};var BR={providers:[K0(Pf,lp.initializeApp(q0),lp,ab),tb({eventCoalescing:!0}),ub(MR),ob(),Sb(()=>bb(q0)),FR(()=>LR())]};var Y9={providers:[lb()]},VR=rb(BR,Y9);var J9=()=>sb(AR,VR),Q8=J9;export{Q8 as a};
